

Started GET "/" for 127.0.0.1 at 2014-10-21 10:55:21 -0400

ActiveRecord::PendingMigrationError (

Migrations are pending. To resolve this issue, run:

	bin/rake db:migrate RAILS_ENV=development

):
  activerecord (4.1.6) lib/active_record/migration.rb:389:in `check_pending!'
  activerecord (4.1.6) lib/active_record/migration.rb:377:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/callbacks.rb:29:in `block in call'
  activesupport (4.1.6) lib/active_support/callbacks.rb:82:in `run_callbacks'
  actionpack (4.1.6) lib/action_dispatch/middleware/callbacks.rb:27:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/reloader.rb:73:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/remote_ip.rb:76:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/debug_exceptions.rb:17:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/show_exceptions.rb:30:in `call'
  railties (4.1.6) lib/rails/rack/logger.rb:38:in `call_app'
  railties (4.1.6) lib/rails/rack/logger.rb:20:in `block in call'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:68:in `block in tagged'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:26:in `tagged'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:68:in `tagged'
  railties (4.1.6) lib/rails/rack/logger.rb:20:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/request_id.rb:21:in `call'
  rack (1.5.2) lib/rack/methodoverride.rb:21:in `call'
  rack (1.5.2) lib/rack/runtime.rb:17:in `call'
  activesupport (4.1.6) lib/active_support/cache/strategy/local_cache_middleware.rb:26:in `call'
  rack (1.5.2) lib/rack/lock.rb:17:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/static.rb:64:in `call'
  rack (1.5.2) lib/rack/sendfile.rb:112:in `call'
  railties (4.1.6) lib/rails/engine.rb:514:in `call'
  railties (4.1.6) lib/rails/application.rb:144:in `call'
  rack (1.5.2) lib/rack/lock.rb:17:in `call'
  rack (1.5.2) lib/rack/content_length.rb:14:in `call'
  rack (1.5.2) lib/rack/handler/webrick.rb:60:in `service'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/httpserver.rb:138:in `service'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/httpserver.rb:94:in `run'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/server.rb:191:in `block in start_thread'


  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_source.erb (0.6ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (1.0ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.0ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/diagnostics.erb within rescues/layout (65.2ms)
  [1m[36m (1.0ms)[0m  [1mCREATE TABLE "payola_affiliates" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "code" varchar(255), "email" varchar(255), "percent" integer, "created_at" datetime, "updated_at" datetime) [0m
  [1m[35m (0.9ms)[0m  CREATE TABLE "payola_coupons" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "code" varchar(255), "percent_off" integer, "created_at" datetime, "updated_at" datetime) 
  [1m[36m (1.0ms)[0m  [1mCREATE TABLE "payola_sales" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar(255), "guid" varchar(255), "product_id" integer, "product_type" varchar(255), "created_at" datetime, "updated_at" datetime, "state" varchar(255), "stripe_id" varchar(255), "stripe_token" varchar(255), "card_last4" varchar(255), "card_expiration" date, "card_type" varchar(255), "error" text, "amount" integer, "fee_amount" integer, "coupon_id" integer, "opt_in" boolean, "download_count" integer, "affiliate_id" integer, "customer_address" text, "business_address" text, "stripe_customer_id" varchar(255), "currency" varchar(255)) [0m
  [1m[35m (0.8ms)[0m  select sqlite_version(*)
  [1m[36m (1.0ms)[0m  [1mCREATE  INDEX "index_payola_sales_on_coupon_id" ON "payola_sales" ("coupon_id")[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'

  [1m[36m (0.9ms)[0m  [1mCREATE  INDEX "index_payola_sales_on_email" ON "payola_sales" ("email")[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_email' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  CREATE  INDEX "index_payola_sales_on_guid" ON "payola_sales" ("guid")
  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_guid' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_guid' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_email' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  CREATE  INDEX "index_payola_sales_on_product" ON "payola_sales" ("product_id", "product_type")
  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_product' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_product' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_guid' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_guid' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_email' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'

  [1m[36m (0.9ms)[0m  [1mCREATE  INDEX "index_payola_sales_on_stripe_customer_id" ON "payola_sales" ("stripe_customer_id")[0m
  [1m[35m (1.0ms)[0m  CREATE TABLE "payola_stripe_webhooks" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "stripe_id" varchar(255), "created_at" datetime, "updated_at" datetime) 
  [1m[36m (0.6ms)[0m  [1mCREATE TABLE "products" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar(255), "permalink" varchar(255), "price" integer, "created_at" datetime, "updated_at" datetime) [0m
  [1m[35m (1.1ms)[0m  CREATE TABLE "schema_migrations" ("version" varchar(255) NOT NULL) 
  [1m[36m (0.9ms)[0m  [1mCREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")[0m
  [1m[35m (0.1ms)[0m  SELECT version FROM "schema_migrations"
  [1m[36m (0.9ms)[0m  [1mINSERT INTO "schema_migrations" (version) VALUES ('20141017233304')[0m
  [1m[35m (0.8ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20141001230848')
  [1m[36m (0.6ms)[0m  [1mINSERT INTO "schema_migrations" (version) VALUES ('20141001170138')[0m
  [1m[35m (0.7ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20141001203541')
  [1m[36m (0.7ms)[0m  [1mINSERT INTO "schema_migrations" (version) VALUES ('20141002013618')[0m
  [1m[35m (0.7ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20141002013701')
  [1m[36m (0.7ms)[0m  [1mINSERT INTO "schema_migrations" (version) VALUES ('20141002203725')[0m
  [1m[36m (1.7ms)[0m  [1mCREATE TABLE "payola_affiliates" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "code" varchar(255), "email" varchar(255), "percent" integer, "created_at" datetime, "updated_at" datetime) [0m
  [1m[35m (1.2ms)[0m  CREATE TABLE "payola_coupons" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "code" varchar(255), "percent_off" integer, "created_at" datetime, "updated_at" datetime) 
  [1m[36m (1.0ms)[0m  [1mCREATE TABLE "payola_sales" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar(255), "guid" varchar(255), "product_id" integer, "product_type" varchar(255), "created_at" datetime, "updated_at" datetime, "state" varchar(255), "stripe_id" varchar(255), "stripe_token" varchar(255), "card_last4" varchar(255), "card_expiration" date, "card_type" varchar(255), "error" text, "amount" integer, "fee_amount" integer, "coupon_id" integer, "opt_in" boolean, "download_count" integer, "affiliate_id" integer, "customer_address" text, "business_address" text, "stripe_customer_id" varchar(255), "currency" varchar(255)) [0m
  [1m[35m (0.2ms)[0m  select sqlite_version(*)
  [1m[36m (1.0ms)[0m  [1mCREATE  INDEX "index_payola_sales_on_coupon_id" ON "payola_sales" ("coupon_id")[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'

  [1m[36m (0.7ms)[0m  [1mCREATE  INDEX "index_payola_sales_on_email" ON "payola_sales" ("email")[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_email' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  CREATE  INDEX "index_payola_sales_on_guid" ON "payola_sales" ("guid")
  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_guid' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_guid' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_email' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  CREATE  INDEX "index_payola_sales_on_product" ON "payola_sales" ("product_id", "product_type")
  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_product' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_product' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_guid' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_guid' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_email' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'

  [1m[36m (0.7ms)[0m  [1mCREATE  INDEX "index_payola_sales_on_stripe_customer_id" ON "payola_sales" ("stripe_customer_id")[0m
  [1m[35m (0.7ms)[0m  CREATE TABLE "payola_stripe_webhooks" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "stripe_id" varchar(255), "created_at" datetime, "updated_at" datetime) 
  [1m[36m (0.8ms)[0m  [1mCREATE TABLE "products" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar(255), "permalink" varchar(255), "price" integer, "created_at" datetime, "updated_at" datetime) [0m
  [1m[35m (1.0ms)[0m  CREATE TABLE "schema_migrations" ("version" varchar(255) NOT NULL) 
  [1m[36m (1.0ms)[0m  [1mCREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")[0m
  [1m[35m (0.1ms)[0m  SELECT version FROM "schema_migrations"
  [1m[36m (0.9ms)[0m  [1mINSERT INTO "schema_migrations" (version) VALUES ('20141017233304')[0m
  [1m[35m (0.7ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20141001230848')
  [1m[36m (0.6ms)[0m  [1mINSERT INTO "schema_migrations" (version) VALUES ('20141001170138')[0m
  [1m[35m (0.6ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20141001203541')
  [1m[36m (0.8ms)[0m  [1mINSERT INTO "schema_migrations" (version) VALUES ('20141002013618')[0m
  [1m[35m (0.7ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20141002013701')
  [1m[36m (0.7ms)[0m  [1mINSERT INTO "schema_migrations" (version) VALUES ('20141002203725')[0m


Started GET "/" for 127.0.0.1 at 2014-10-24 15:48:53 -0400

ActiveRecord::PendingMigrationError (

Migrations are pending. To resolve this issue, run:

	bin/rake db:migrate RAILS_ENV=development

):
  activerecord (4.1.6) lib/active_record/migration.rb:389:in `check_pending!'
  activerecord (4.1.6) lib/active_record/migration.rb:377:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/callbacks.rb:29:in `block in call'
  activesupport (4.1.6) lib/active_support/callbacks.rb:82:in `run_callbacks'
  actionpack (4.1.6) lib/action_dispatch/middleware/callbacks.rb:27:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/reloader.rb:73:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/remote_ip.rb:76:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/debug_exceptions.rb:17:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/show_exceptions.rb:30:in `call'
  railties (4.1.6) lib/rails/rack/logger.rb:38:in `call_app'
  railties (4.1.6) lib/rails/rack/logger.rb:20:in `block in call'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:68:in `block in tagged'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:26:in `tagged'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:68:in `tagged'
  railties (4.1.6) lib/rails/rack/logger.rb:20:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/request_id.rb:21:in `call'
  rack (1.5.2) lib/rack/methodoverride.rb:21:in `call'
  rack (1.5.2) lib/rack/runtime.rb:17:in `call'
  activesupport (4.1.6) lib/active_support/cache/strategy/local_cache_middleware.rb:26:in `call'
  rack (1.5.2) lib/rack/lock.rb:17:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/static.rb:64:in `call'
  rack (1.5.2) lib/rack/sendfile.rb:112:in `call'
  railties (4.1.6) lib/rails/engine.rb:514:in `call'
  railties (4.1.6) lib/rails/application.rb:144:in `call'
  rack (1.5.2) lib/rack/lock.rb:17:in `call'
  rack (1.5.2) lib/rack/content_length.rb:14:in `call'
  rack (1.5.2) lib/rack/handler/webrick.rb:60:in `service'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/httpserver.rb:138:in `service'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/httpserver.rb:94:in `run'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/server.rb:191:in `block in start_thread'


  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_source.erb (1.1ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (1.6ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.0ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/diagnostics.erb within rescues/layout (21.8ms)


Started GET "/" for 127.0.0.1 at 2014-10-24 15:48:54 -0400

ActiveRecord::PendingMigrationError (

Migrations are pending. To resolve this issue, run:

	bin/rake db:migrate RAILS_ENV=development

):
  activerecord (4.1.6) lib/active_record/migration.rb:389:in `check_pending!'
  activerecord (4.1.6) lib/active_record/migration.rb:377:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/callbacks.rb:29:in `block in call'
  activesupport (4.1.6) lib/active_support/callbacks.rb:82:in `run_callbacks'
  actionpack (4.1.6) lib/action_dispatch/middleware/callbacks.rb:27:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/reloader.rb:73:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/remote_ip.rb:76:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/debug_exceptions.rb:17:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/show_exceptions.rb:30:in `call'
  railties (4.1.6) lib/rails/rack/logger.rb:38:in `call_app'
  railties (4.1.6) lib/rails/rack/logger.rb:20:in `block in call'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:68:in `block in tagged'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:26:in `tagged'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:68:in `tagged'
  railties (4.1.6) lib/rails/rack/logger.rb:20:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/request_id.rb:21:in `call'
  rack (1.5.2) lib/rack/methodoverride.rb:21:in `call'
  rack (1.5.2) lib/rack/runtime.rb:17:in `call'
  activesupport (4.1.6) lib/active_support/cache/strategy/local_cache_middleware.rb:26:in `call'
  rack (1.5.2) lib/rack/lock.rb:17:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/static.rb:64:in `call'
  rack (1.5.2) lib/rack/sendfile.rb:112:in `call'
  railties (4.1.6) lib/rails/engine.rb:514:in `call'
  railties (4.1.6) lib/rails/application.rb:144:in `call'
  rack (1.5.2) lib/rack/lock.rb:17:in `call'
  rack (1.5.2) lib/rack/content_length.rb:14:in `call'
  rack (1.5.2) lib/rack/handler/webrick.rb:60:in `service'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/httpserver.rb:138:in `service'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/httpserver.rb:94:in `run'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/server.rb:191:in `block in start_thread'


  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_source.erb (0.6ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (0.9ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (0.9ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/diagnostics.erb within rescues/layout (62.8ms)


Started GET "/buy" for 127.0.0.1 at 2014-10-24 15:48:56 -0400

ActiveRecord::PendingMigrationError (

Migrations are pending. To resolve this issue, run:

	bin/rake db:migrate RAILS_ENV=development

):
  activerecord (4.1.6) lib/active_record/migration.rb:389:in `check_pending!'
  activerecord (4.1.6) lib/active_record/migration.rb:377:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/callbacks.rb:29:in `block in call'
  activesupport (4.1.6) lib/active_support/callbacks.rb:82:in `run_callbacks'
  actionpack (4.1.6) lib/action_dispatch/middleware/callbacks.rb:27:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/reloader.rb:73:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/remote_ip.rb:76:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/debug_exceptions.rb:17:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/show_exceptions.rb:30:in `call'
  railties (4.1.6) lib/rails/rack/logger.rb:38:in `call_app'
  railties (4.1.6) lib/rails/rack/logger.rb:20:in `block in call'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:68:in `block in tagged'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:26:in `tagged'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:68:in `tagged'
  railties (4.1.6) lib/rails/rack/logger.rb:20:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/request_id.rb:21:in `call'
  rack (1.5.2) lib/rack/methodoverride.rb:21:in `call'
  rack (1.5.2) lib/rack/runtime.rb:17:in `call'
  activesupport (4.1.6) lib/active_support/cache/strategy/local_cache_middleware.rb:26:in `call'
  rack (1.5.2) lib/rack/lock.rb:17:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/static.rb:64:in `call'
  rack (1.5.2) lib/rack/sendfile.rb:112:in `call'
  railties (4.1.6) lib/rails/engine.rb:514:in `call'
  railties (4.1.6) lib/rails/application.rb:144:in `call'
  rack (1.5.2) lib/rack/lock.rb:17:in `call'
  rack (1.5.2) lib/rack/content_length.rb:14:in `call'
  rack (1.5.2) lib/rack/handler/webrick.rb:60:in `service'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/httpserver.rb:138:in `service'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/httpserver.rb:94:in `run'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/server.rb:191:in `block in start_thread'


  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_source.erb (0.9ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (1.0ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (0.9ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/diagnostics.erb within rescues/layout (60.6ms)
  [1m[36m (4.4ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" varchar(255) NOT NULL) [0m
  [1m[35m (0.1ms)[0m  select sqlite_version(*)
  [1m[36m (0.8ms)[0m  [1mCREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.1ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
Migrating to CreateProducts (20141001230848)
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.5ms)[0m  CREATE TABLE "products" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar(255), "permalink" varchar(255), "price" integer, "created_at" datetime, "updated_at" datetime) 
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "schema_migrations" ("version") VALUES (?)[0m  [["version", "20141001230848"]]
  [1m[35m (0.8ms)[0m  commit transaction
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m


Started GET "/buy" for 127.0.0.1 at 2014-10-24 15:49:19 -0400
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Processing by BuyController#index as HTML
  [1m[35mProduct Load (0.2ms)[0m  SELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1
Completed 500 Internal Server Error in 82ms

ActiveRecord::StatementInvalid (Could not find table 'payola_sales'):
  app/controllers/buy_controller.rb:5:in `index'


  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_source.erb (0.8ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (1.0ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (23.9ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/diagnostics.erb within rescues/layout (79.8ms)
  [1m[36m (2.5ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" varchar(255) NOT NULL) [0m
  [1m[35m (0.1ms)[0m  select sqlite_version(*)
  [1m[36m (0.9ms)[0m  [1mCREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.1ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
Migrating to CreateProducts (20141001230848)
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.3ms)[0m  CREATE TABLE "products" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar(255), "permalink" varchar(255), "price" integer, "created_at" datetime, "updated_at" datetime) 
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "schema_migrations" ("version") VALUES (?)[0m  [["version", "20141001230848"]]
  [1m[35m (0.9ms)[0m  commit transaction
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m


Started GET "/" for 127.0.0.1 at 2014-10-24 15:55:10 -0400
  [1m[36mActiveRecord::SchemaMigration Load (0.8ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Processing by Rails::WelcomeController#index as HTML
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/railties-4.1.6/lib/rails/templates/rails/welcome/index.html.erb (2.7ms)
Completed 200 OK in 12ms (Views: 11.4ms | ActiveRecord: 0.0ms)


Started GET "/buy" for 127.0.0.1 at 2014-10-24 15:55:11 -0400
Processing by BuyController#index as HTML
  [1m[35mProduct Load (1.7ms)[0m  SELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1
Completed 500 Internal Server Error in 70ms

ActiveRecord::StatementInvalid (Could not find table 'payola_sales'):
  app/controllers/buy_controller.rb:5:in `index'


  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_source.erb (0.7ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (1.9ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (28.7ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/diagnostics.erb within rescues/layout (80.8ms)


Started GET "/buy" for 127.0.0.1 at 2014-10-24 15:56:04 -0400
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Processing by BuyController#index as HTML
  [1m[35mProduct Load (0.1ms)[0m  SELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_checkout.html.erb (11.2ms)
  Rendered buy/index.html.erb within layouts/application (18.9ms)
Completed 500 Internal Server Error in 130ms

ActionView::Template::Error (undefined local variable or method `sellable' for #<#<Class:0x007fb5ef4c5e30>:0x007fb5ef4c52a0>):
    2:   button_class = local_assigns.fetch :button_class, "stripe-button-el"
    3:   button_inner_style = local_assigns.fetch :button_inner_style, 'min-height: 30px'
    4:   button_text = local_assigns.fetch :button_text, "Pay Now"
    5:   description = local_assigns.fetch :description, "#{sellable.name} (#{formatted_price(sellable.price)})"
    6:   name = local_assigns.fetch :name, sellable.name
    7:   product_image_path = local_assigns.fetch :product_image_path , ''
    8:   panel_label = local_assigns.fetch :panel_label, ''
  app/views/buy/index.html.erb:1:in `_app_views_buy_index_html_erb___4496669879835320137_70209668683900'


  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (1.0ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (22.9ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout (76.9ms)


Started GET "/buy" for 127.0.0.1 at 2014-10-24 15:57:02 -0400
Processing by BuyController#index as HTML
  [1m[36mProduct Load (0.1ms)[0m  [1mSELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1[0m
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_checkout.html.erb (1.7ms)
  Rendered buy/index.html.erb within layouts/application (3.0ms)
Completed 500 Internal Server Error in 35ms

ActionView::Template::Error (undefined method `name' for nil:NilClass):
    2:   button_class = local_assigns.fetch :button_class, "stripe-button-el"
    3:   button_inner_style = local_assigns.fetch :button_inner_style, 'min-height: 30px'
    4:   button_text = local_assigns.fetch :button_text, "Pay Now"
    5:   description = local_assigns.fetch :description, "#{sellable.name} (#{formatted_price(sellable.price)})"
    6:   name = local_assigns.fetch :name, sellable.name
    7:   product_image_path = local_assigns.fetch :product_image_path , ''
    8:   panel_label = local_assigns.fetch :panel_label, ''
  app/views/buy/index.html.erb:1:in `_app_views_buy_index_html_erb___4496669879835320137_70209692536660'


  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (1.3ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (43.2ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout (58.1ms)
  [1m[36mProduct Load (0.4ms)[0m  [1mSELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mProduct Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "products"  WHERE "products"."permalink" = 'foo' LIMIT 1[0m
  [1m[35mSQL (1.0ms)[0m  INSERT INTO "products" ("created_at", "name", "permalink", "price", "updated_at") VALUES (?, ?, ?, ?, ?)  [["created_at", "2014-10-24 20:00:30.113720"], ["name", "foo"], ["permalink", "foo"], ["price", 100], ["updated_at", "2014-10-24 20:00:30.113720"]]
  [1m[36m (1.0ms)[0m  [1mcommit transaction[0m


Started GET "/buy" for 127.0.0.1 at 2014-10-24 16:00:39 -0400
Processing by BuyController#index as HTML
  [1m[35mProduct Load (3.9ms)[0m  SELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_checkout.html.erb (46.6ms)
  Rendered buy/index.html.erb within layouts/application (49.1ms)
Completed 200 OK in 205ms (Views: 191.9ms | ActiveRecord: 4.5ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-10-24 16:00:39 -0400


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-10-24 16:00:39 -0400


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-10-24 16:00:39 -0400


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-10-24 16:00:39 -0400


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-10-24 16:00:39 -0400


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-10-24 16:00:39 -0400


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-10-24 16:00:39 -0400


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-10-24 16:00:39 -0400


Started GET "/buy" for 127.0.0.1 at 2014-10-24 16:00:53 -0400
Processing by BuyController#index as HTML
  [1m[36mProduct Load (0.2ms)[0m  [1mSELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1[0m
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_checkout.html.erb (3.3ms)
  Rendered buy/index.html.erb within layouts/application (11.5ms)
Completed 200 OK in 97ms (Views: 95.6ms | ActiveRecord: 0.2ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-10-24 16:00:53 -0400


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-10-24 16:00:53 -0400


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-10-24 16:00:53 -0400


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-10-24 16:00:53 -0400


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-10-24 16:00:53 -0400


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-10-24 16:00:53 -0400


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-10-24 16:00:53 -0400


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-10-24 16:00:53 -0400


Started GET "/buy" for 127.0.0.1 at 2014-10-24 16:01:31 -0400
Processing by BuyController#index as HTML
  [1m[35mProduct Load (0.2ms)[0m  SELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_checkout.html.erb (2.7ms)
  Rendered buy/index.html.erb within layouts/application (4.4ms)
Completed 200 OK in 145ms (Views: 144.1ms | ActiveRecord: 0.2ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-10-24 16:01:31 -0400


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-10-24 16:01:31 -0400


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-10-24 16:01:31 -0400


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-10-24 16:01:31 -0400


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-10-24 16:01:31 -0400


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-10-24 16:01:32 -0400


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-10-24 16:01:32 -0400


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-10-24 16:01:32 -0400


Started POST "/" for 127.0.0.1 at 2014-10-24 16:01:55 -0400

ActionController::RoutingError (No route matches [POST] "/"):
  actionpack (4.1.6) lib/action_dispatch/middleware/debug_exceptions.rb:21:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/show_exceptions.rb:30:in `call'
  railties (4.1.6) lib/rails/rack/logger.rb:38:in `call_app'
  railties (4.1.6) lib/rails/rack/logger.rb:20:in `block in call'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:68:in `block in tagged'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:26:in `tagged'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:68:in `tagged'
  railties (4.1.6) lib/rails/rack/logger.rb:20:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/request_id.rb:21:in `call'
  rack (1.5.2) lib/rack/methodoverride.rb:21:in `call'
  rack (1.5.2) lib/rack/runtime.rb:17:in `call'
  activesupport (4.1.6) lib/active_support/cache/strategy/local_cache_middleware.rb:26:in `call'
  rack (1.5.2) lib/rack/lock.rb:17:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/static.rb:64:in `call'
  rack (1.5.2) lib/rack/sendfile.rb:112:in `call'
  railties (4.1.6) lib/rails/engine.rb:514:in `call'
  railties (4.1.6) lib/rails/application.rb:144:in `call'
  rack (1.5.2) lib/rack/lock.rb:17:in `call'
  rack (1.5.2) lib/rack/content_length.rb:14:in `call'
  rack (1.5.2) lib/rack/handler/webrick.rb:60:in `service'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/httpserver.rb:138:in `service'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/httpserver.rb:94:in `run'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/server.rb:191:in `block in start_thread'


  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (1.4ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/routes/_route.html.erb (1.3ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/routes/_route.html.erb (0.2ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/routes/_route.html.erb (0.3ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/routes/_table.html.erb (10.5ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/routing_error.html.erb within rescues/layout (98.9ms)


Started POST "/" for 127.0.0.1 at 2014-10-24 16:02:19 -0400

ActionController::RoutingError (No route matches [POST] "/"):
  actionpack (4.1.6) lib/action_dispatch/middleware/debug_exceptions.rb:21:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/show_exceptions.rb:30:in `call'
  railties (4.1.6) lib/rails/rack/logger.rb:38:in `call_app'
  railties (4.1.6) lib/rails/rack/logger.rb:20:in `block in call'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:68:in `block in tagged'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:26:in `tagged'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:68:in `tagged'
  railties (4.1.6) lib/rails/rack/logger.rb:20:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/request_id.rb:21:in `call'
  rack (1.5.2) lib/rack/methodoverride.rb:21:in `call'
  rack (1.5.2) lib/rack/runtime.rb:17:in `call'
  activesupport (4.1.6) lib/active_support/cache/strategy/local_cache_middleware.rb:26:in `call'
  rack (1.5.2) lib/rack/lock.rb:17:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/static.rb:64:in `call'
  rack (1.5.2) lib/rack/sendfile.rb:112:in `call'
  railties (4.1.6) lib/rails/engine.rb:514:in `call'
  railties (4.1.6) lib/rails/application.rb:144:in `call'
  rack (1.5.2) lib/rack/lock.rb:17:in `call'
  rack (1.5.2) lib/rack/content_length.rb:14:in `call'
  rack (1.5.2) lib/rack/handler/webrick.rb:60:in `service'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/httpserver.rb:138:in `service'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/httpserver.rb:94:in `run'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/server.rb:191:in `block in start_thread'


  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (1.7ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/routes/_route.html.erb (1.9ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/routes/_route.html.erb (0.2ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/routes/_route.html.erb (0.5ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/routes/_table.html.erb (1.7ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/routing_error.html.erb within rescues/layout (143.0ms)


Started GET "/buy" for 127.0.0.1 at 2014-10-24 16:02:23 -0400
Processing by BuyController#index as HTML
  [1m[36mProduct Load (0.2ms)[0m  [1mSELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1[0m
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_checkout.html.erb (3.4ms)
  Rendered buy/index.html.erb within layouts/application (5.8ms)
Completed 200 OK in 196ms (Views: 194.6ms | ActiveRecord: 0.2ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-10-24 16:02:23 -0400


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-10-24 16:02:23 -0400


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-10-24 16:02:23 -0400


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-10-24 16:02:23 -0400


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-10-24 16:02:23 -0400


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-10-24 16:02:23 -0400


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-10-24 16:02:23 -0400


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-10-24 16:02:23 -0400


Started GET "/buy" for 127.0.0.1 at 2014-10-24 16:03:38 -0400
Processing by BuyController#index as HTML
  [1m[35mProduct Load (0.2ms)[0m  SELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_checkout.html.erb (2.2ms)
  Rendered buy/index.html.erb within layouts/application (4.1ms)
Completed 200 OK in 172ms (Views: 170.4ms | ActiveRecord: 0.2ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-10-24 16:03:39 -0400


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-10-24 16:03:39 -0400


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-10-24 16:03:39 -0400


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-10-24 16:03:39 -0400


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-10-24 16:03:39 -0400


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-10-24 16:03:39 -0400


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-10-24 16:03:39 -0400


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-10-24 16:03:39 -0400


Started GET "/buy" for 127.0.0.1 at 2014-10-24 16:03:41 -0400
Processing by BuyController#index as HTML
  [1m[36mProduct Load (0.2ms)[0m  [1mSELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1[0m
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_checkout.html.erb (2.3ms)
  Rendered buy/index.html.erb within layouts/application (3.5ms)
Completed 200 OK in 73ms (Views: 71.7ms | ActiveRecord: 0.2ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-10-24 16:03:41 -0400


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-10-24 16:03:41 -0400


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-10-24 16:03:41 -0400


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-10-24 16:03:41 -0400


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-10-24 16:03:41 -0400


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-10-24 16:03:41 -0400


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-10-24 16:03:41 -0400


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-10-24 16:03:42 -0400


Started GET "/buy" for 127.0.0.1 at 2014-10-24 16:03:49 -0400
Processing by BuyController#index as HTML
  [1m[35mProduct Load (0.4ms)[0m  SELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_checkout.html.erb (2.5ms)
  Rendered buy/index.html.erb within layouts/application (4.6ms)
Completed 200 OK in 54ms (Views: 49.7ms | ActiveRecord: 0.4ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-10-24 16:03:49 -0400


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-10-24 16:03:49 -0400


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-10-24 16:03:49 -0400


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-10-24 16:03:49 -0400


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-10-24 16:03:49 -0400


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-10-24 16:03:49 -0400


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-10-24 16:03:49 -0400


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-10-24 16:03:49 -0400


Started POST "/" for 127.0.0.1 at 2014-10-24 16:04:11 -0400

ActionController::RoutingError (No route matches [POST] "/"):
  actionpack (4.1.6) lib/action_dispatch/middleware/debug_exceptions.rb:21:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/show_exceptions.rb:30:in `call'
  railties (4.1.6) lib/rails/rack/logger.rb:38:in `call_app'
  railties (4.1.6) lib/rails/rack/logger.rb:20:in `block in call'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:68:in `block in tagged'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:26:in `tagged'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:68:in `tagged'
  railties (4.1.6) lib/rails/rack/logger.rb:20:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/request_id.rb:21:in `call'
  rack (1.5.2) lib/rack/methodoverride.rb:21:in `call'
  rack (1.5.2) lib/rack/runtime.rb:17:in `call'
  activesupport (4.1.6) lib/active_support/cache/strategy/local_cache_middleware.rb:26:in `call'
  rack (1.5.2) lib/rack/lock.rb:17:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/static.rb:64:in `call'
  rack (1.5.2) lib/rack/sendfile.rb:112:in `call'
  railties (4.1.6) lib/rails/engine.rb:514:in `call'
  railties (4.1.6) lib/rails/application.rb:144:in `call'
  rack (1.5.2) lib/rack/lock.rb:17:in `call'
  rack (1.5.2) lib/rack/content_length.rb:14:in `call'
  rack (1.5.2) lib/rack/handler/webrick.rb:60:in `service'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/httpserver.rb:138:in `service'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/httpserver.rb:94:in `run'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/server.rb:191:in `block in start_thread'


  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (1.1ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/routes/_route.html.erb (1.4ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/routes/_route.html.erb (0.2ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/routes/_route.html.erb (0.3ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/routes/_table.html.erb (1.4ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/routing_error.html.erb within rescues/layout (162.5ms)


Started POST "/" for 127.0.0.1 at 2014-10-24 16:04:20 -0400

ActionController::RoutingError (No route matches [POST] "/"):
  actionpack (4.1.6) lib/action_dispatch/middleware/debug_exceptions.rb:21:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/show_exceptions.rb:30:in `call'
  railties (4.1.6) lib/rails/rack/logger.rb:38:in `call_app'
  railties (4.1.6) lib/rails/rack/logger.rb:20:in `block in call'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:68:in `block in tagged'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:26:in `tagged'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:68:in `tagged'
  railties (4.1.6) lib/rails/rack/logger.rb:20:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/request_id.rb:21:in `call'
  rack (1.5.2) lib/rack/methodoverride.rb:21:in `call'
  rack (1.5.2) lib/rack/runtime.rb:17:in `call'
  activesupport (4.1.6) lib/active_support/cache/strategy/local_cache_middleware.rb:26:in `call'
  rack (1.5.2) lib/rack/lock.rb:17:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/static.rb:64:in `call'
  rack (1.5.2) lib/rack/sendfile.rb:112:in `call'
  railties (4.1.6) lib/rails/engine.rb:514:in `call'
  railties (4.1.6) lib/rails/application.rb:144:in `call'
  rack (1.5.2) lib/rack/lock.rb:17:in `call'
  rack (1.5.2) lib/rack/content_length.rb:14:in `call'
  rack (1.5.2) lib/rack/handler/webrick.rb:60:in `service'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/httpserver.rb:138:in `service'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/httpserver.rb:94:in `run'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/server.rb:191:in `block in start_thread'


  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (1.1ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/routes/_route.html.erb (2.0ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/routes/_route.html.erb (0.2ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/routes/_route.html.erb (0.3ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/routes/_table.html.erb (1.6ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/routing_error.html.erb within rescues/layout (104.2ms)


Started GET "/buy" for 127.0.0.1 at 2014-10-24 16:04:25 -0400
Processing by BuyController#index as HTML
  [1m[36mProduct Load (0.2ms)[0m  [1mSELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1[0m
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_checkout.html.erb (3.4ms)
  Rendered buy/index.html.erb within layouts/application (5.9ms)
Completed 200 OK in 80ms (Views: 78.4ms | ActiveRecord: 0.2ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-10-24 16:04:26 -0400


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-10-24 16:04:26 -0400


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-10-24 16:04:26 -0400


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-10-24 16:04:26 -0400


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-10-24 16:04:26 -0400


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-10-24 16:04:26 -0400


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-10-24 16:04:26 -0400


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-10-24 16:04:26 -0400


Started POST "/" for 127.0.0.1 at 2014-10-24 16:04:43 -0400

ActionController::RoutingError (No route matches [POST] "/"):
  actionpack (4.1.6) lib/action_dispatch/middleware/debug_exceptions.rb:21:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/show_exceptions.rb:30:in `call'
  railties (4.1.6) lib/rails/rack/logger.rb:38:in `call_app'
  railties (4.1.6) lib/rails/rack/logger.rb:20:in `block in call'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:68:in `block in tagged'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:26:in `tagged'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:68:in `tagged'
  railties (4.1.6) lib/rails/rack/logger.rb:20:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/request_id.rb:21:in `call'
  rack (1.5.2) lib/rack/methodoverride.rb:21:in `call'
  rack (1.5.2) lib/rack/runtime.rb:17:in `call'
  activesupport (4.1.6) lib/active_support/cache/strategy/local_cache_middleware.rb:26:in `call'
  rack (1.5.2) lib/rack/lock.rb:17:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/static.rb:64:in `call'
  rack (1.5.2) lib/rack/sendfile.rb:112:in `call'
  railties (4.1.6) lib/rails/engine.rb:514:in `call'
  railties (4.1.6) lib/rails/application.rb:144:in `call'
  rack (1.5.2) lib/rack/lock.rb:17:in `call'
  rack (1.5.2) lib/rack/content_length.rb:14:in `call'
  rack (1.5.2) lib/rack/handler/webrick.rb:60:in `service'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/httpserver.rb:138:in `service'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/httpserver.rb:94:in `run'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/server.rb:191:in `block in start_thread'


  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (1.7ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/routes/_route.html.erb (1.5ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/routes/_route.html.erb (0.2ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/routes/_route.html.erb (0.3ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/routes/_table.html.erb (1.3ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/routing_error.html.erb within rescues/layout (107.6ms)


Started GET "/buy" for 127.0.0.1 at 2014-10-24 16:06:05 -0400
Processing by BuyController#index as HTML
  [1m[35mProduct Load (0.2ms)[0m  SELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_checkout.html.erb (3.2ms)
  Rendered buy/index.html.erb within layouts/application (6.9ms)
Completed 200 OK in 172ms (Views: 171.1ms | ActiveRecord: 0.2ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-10-24 16:06:06 -0400


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-10-24 16:06:06 -0400


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-10-24 16:06:06 -0400


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-10-24 16:06:06 -0400


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-10-24 16:06:06 -0400


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-10-24 16:06:06 -0400


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-10-24 16:06:06 -0400


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-10-24 16:06:06 -0400


Started POST "/" for 127.0.0.1 at 2014-10-24 16:06:27 -0400

ActionController::RoutingError (No route matches [POST] "/"):
  actionpack (4.1.6) lib/action_dispatch/middleware/debug_exceptions.rb:21:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/show_exceptions.rb:30:in `call'
  railties (4.1.6) lib/rails/rack/logger.rb:38:in `call_app'
  railties (4.1.6) lib/rails/rack/logger.rb:20:in `block in call'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:68:in `block in tagged'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:26:in `tagged'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:68:in `tagged'
  railties (4.1.6) lib/rails/rack/logger.rb:20:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/request_id.rb:21:in `call'
  rack (1.5.2) lib/rack/methodoverride.rb:21:in `call'
  rack (1.5.2) lib/rack/runtime.rb:17:in `call'
  activesupport (4.1.6) lib/active_support/cache/strategy/local_cache_middleware.rb:26:in `call'
  rack (1.5.2) lib/rack/lock.rb:17:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/static.rb:64:in `call'
  rack (1.5.2) lib/rack/sendfile.rb:112:in `call'
  railties (4.1.6) lib/rails/engine.rb:514:in `call'
  railties (4.1.6) lib/rails/application.rb:144:in `call'
  rack (1.5.2) lib/rack/lock.rb:17:in `call'
  rack (1.5.2) lib/rack/content_length.rb:14:in `call'
  rack (1.5.2) lib/rack/handler/webrick.rb:60:in `service'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/httpserver.rb:138:in `service'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/httpserver.rb:94:in `run'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/server.rb:191:in `block in start_thread'


  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (1.5ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/routes/_route.html.erb (1.3ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/routes/_route.html.erb (0.2ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/routes/_route.html.erb (0.4ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/routes/_table.html.erb (1.1ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/routing_error.html.erb within rescues/layout (153.4ms)


Started GET "/buy" for 127.0.0.1 at 2014-10-24 16:06:33 -0400
Processing by BuyController#index as HTML
  [1m[36mProduct Load (0.2ms)[0m  [1mSELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1[0m
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_checkout.html.erb (3.7ms)
  Rendered buy/index.html.erb within layouts/application (5.9ms)
Completed 200 OK in 127ms (Views: 125.0ms | ActiveRecord: 0.2ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-10-24 16:06:33 -0400


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-10-24 16:06:33 -0400


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-10-24 16:06:33 -0400


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-10-24 16:06:33 -0400


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-10-24 16:06:33 -0400


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-10-24 16:06:33 -0400


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-10-24 16:06:33 -0400


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-10-24 16:06:33 -0400


Started POST "/" for 127.0.0.1 at 2014-10-24 16:06:51 -0400

ActionController::RoutingError (No route matches [POST] "/"):
  actionpack (4.1.6) lib/action_dispatch/middleware/debug_exceptions.rb:21:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/show_exceptions.rb:30:in `call'
  railties (4.1.6) lib/rails/rack/logger.rb:38:in `call_app'
  railties (4.1.6) lib/rails/rack/logger.rb:20:in `block in call'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:68:in `block in tagged'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:26:in `tagged'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:68:in `tagged'
  railties (4.1.6) lib/rails/rack/logger.rb:20:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/request_id.rb:21:in `call'
  rack (1.5.2) lib/rack/methodoverride.rb:21:in `call'
  rack (1.5.2) lib/rack/runtime.rb:17:in `call'
  activesupport (4.1.6) lib/active_support/cache/strategy/local_cache_middleware.rb:26:in `call'
  rack (1.5.2) lib/rack/lock.rb:17:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/static.rb:64:in `call'
  rack (1.5.2) lib/rack/sendfile.rb:112:in `call'
  railties (4.1.6) lib/rails/engine.rb:514:in `call'
  railties (4.1.6) lib/rails/application.rb:144:in `call'
  rack (1.5.2) lib/rack/lock.rb:17:in `call'
  rack (1.5.2) lib/rack/content_length.rb:14:in `call'
  rack (1.5.2) lib/rack/handler/webrick.rb:60:in `service'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/httpserver.rb:138:in `service'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/httpserver.rb:94:in `run'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/server.rb:191:in `block in start_thread'


  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (0.9ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/routes/_route.html.erb (1.0ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/routes/_route.html.erb (0.2ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/routes/_route.html.erb (0.3ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/routes/_table.html.erb (1.1ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/routing_error.html.erb within rescues/layout (136.7ms)


Started GET "/buy" for 127.0.0.1 at 2014-10-24 16:09:14 -0400
Processing by BuyController#index as HTML
  [1m[35mProduct Load (0.3ms)[0m  SELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_checkout.html.erb (1.9ms)
  Rendered buy/index.html.erb within layouts/application (3.0ms)
Completed 200 OK in 104ms (Views: 101.7ms | ActiveRecord: 0.3ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-10-24 16:09:14 -0400


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-10-24 16:09:14 -0400


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-10-24 16:09:14 -0400


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-10-24 16:09:14 -0400


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-10-24 16:09:14 -0400


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-10-24 16:09:14 -0400


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-10-24 16:09:14 -0400


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-10-24 16:09:14 -0400


Started POST "/" for 127.0.0.1 at 2014-10-24 16:09:51 -0400

ActionController::RoutingError (No route matches [POST] "/"):
  actionpack (4.1.6) lib/action_dispatch/middleware/debug_exceptions.rb:21:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/show_exceptions.rb:30:in `call'
  railties (4.1.6) lib/rails/rack/logger.rb:38:in `call_app'
  railties (4.1.6) lib/rails/rack/logger.rb:20:in `block in call'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:68:in `block in tagged'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:26:in `tagged'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:68:in `tagged'
  railties (4.1.6) lib/rails/rack/logger.rb:20:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/request_id.rb:21:in `call'
  rack (1.5.2) lib/rack/methodoverride.rb:21:in `call'
  rack (1.5.2) lib/rack/runtime.rb:17:in `call'
  activesupport (4.1.6) lib/active_support/cache/strategy/local_cache_middleware.rb:26:in `call'
  rack (1.5.2) lib/rack/lock.rb:17:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/static.rb:64:in `call'
  rack (1.5.2) lib/rack/sendfile.rb:112:in `call'
  railties (4.1.6) lib/rails/engine.rb:514:in `call'
  railties (4.1.6) lib/rails/application.rb:144:in `call'
  rack (1.5.2) lib/rack/lock.rb:17:in `call'
  rack (1.5.2) lib/rack/content_length.rb:14:in `call'
  rack (1.5.2) lib/rack/handler/webrick.rb:60:in `service'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/httpserver.rb:138:in `service'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/httpserver.rb:94:in `run'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/server.rb:191:in `block in start_thread'


  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (1.2ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/routes/_route.html.erb (1.0ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/routes/_route.html.erb (0.1ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/routes/_route.html.erb (0.3ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/routes/_table.html.erb (1.1ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/routing_error.html.erb within rescues/layout (130.8ms)


Started GET "/buy" for 127.0.0.1 at 2014-10-24 16:18:39 -0400
Processing by BuyController#index as HTML
  [1m[36mProduct Load (0.2ms)[0m  [1mSELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1[0m
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_checkout.html.erb (2.5ms)
  Rendered buy/index.html.erb within layouts/application (4.0ms)
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_stripe_header.html.erb (0.4ms)
Completed 200 OK in 155ms (Views: 153.4ms | ActiveRecord: 0.2ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-10-24 16:18:40 -0400


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-10-24 16:18:40 -0400


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-10-24 16:18:40 -0400


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-10-24 16:18:40 -0400


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-10-24 16:18:40 -0400


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-10-24 16:18:40 -0400


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-10-24 16:18:40 -0400


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-10-24 16:18:40 -0400


Started GET "/buy" for 127.0.0.1 at 2014-10-24 16:19:57 -0400
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Processing by BuyController#index as HTML
  [1m[35mProduct Load (0.2ms)[0m  SELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_checkout.html.erb (142.7ms)
  Rendered buy/index.html.erb within layouts/application (194.0ms)
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_stripe_header.html.erb (0.5ms)
Completed 200 OK in 275ms (Views: 261.4ms | ActiveRecord: 1.0ms)


Started GET "/buy" for 127.0.0.1 at 2014-10-24 16:20:02 -0400
Processing by BuyController#index as HTML
  [1m[36mProduct Load (0.2ms)[0m  [1mSELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1[0m
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_checkout.html.erb (2.8ms)
  Rendered buy/index.html.erb within layouts/application (4.2ms)
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_stripe_header.html.erb (0.0ms)
Completed 200 OK in 83ms (Views: 82.0ms | ActiveRecord: 0.2ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-10-24 16:20:02 -0400


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-10-24 16:20:02 -0400


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-10-24 16:20:02 -0400


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-10-24 16:20:02 -0400


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-10-24 16:20:02 -0400


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-10-24 16:20:02 -0400


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-10-24 16:20:02 -0400


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-10-24 16:20:02 -0400


Started GET "/buy" for 127.0.0.1 at 2014-10-24 16:20:34 -0400
Processing by BuyController#index as HTML
  [1m[35mProduct Load (0.2ms)[0m  SELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_checkout.html.erb (2.6ms)
  Rendered buy/index.html.erb within layouts/application (3.9ms)
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_stripe_header.html.erb (0.1ms)
Completed 200 OK in 93ms (Views: 91.6ms | ActiveRecord: 0.2ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-10-24 16:20:34 -0400


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-10-24 16:20:34 -0400


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-10-24 16:20:34 -0400


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-10-24 16:20:34 -0400


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-10-24 16:20:35 -0400


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-10-24 16:20:35 -0400


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-10-24 16:20:35 -0400


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-10-24 16:20:35 -0400


Started GET "/buy" for 127.0.0.1 at 2014-10-24 16:21:13 -0400
Processing by BuyController#index as HTML
  [1m[36mProduct Load (0.3ms)[0m  [1mSELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1[0m
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_checkout.html.erb (1.9ms)
  Rendered buy/index.html.erb within layouts/application (3.5ms)
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_stripe_header.html.erb (0.1ms)
Completed 200 OK in 140ms (Views: 138.9ms | ActiveRecord: 0.3ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-10-24 16:21:13 -0400


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-10-24 16:21:13 -0400


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-10-24 16:21:13 -0400


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-10-24 16:21:13 -0400


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-10-24 16:21:13 -0400


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-10-24 16:21:13 -0400


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-10-24 16:21:13 -0400


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-10-24 16:21:13 -0400


Started POST "/payola/buy/product/foo" for 127.0.0.1 at 2014-10-24 16:21:31 -0400

ActionController::RoutingError (No route matches [POST] "/payola/buy/product/foo"):
  actionpack (4.1.6) lib/action_dispatch/middleware/debug_exceptions.rb:21:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/show_exceptions.rb:30:in `call'
  railties (4.1.6) lib/rails/rack/logger.rb:38:in `call_app'
  railties (4.1.6) lib/rails/rack/logger.rb:20:in `block in call'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:68:in `block in tagged'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:26:in `tagged'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:68:in `tagged'
  railties (4.1.6) lib/rails/rack/logger.rb:20:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/request_id.rb:21:in `call'
  rack (1.5.2) lib/rack/methodoverride.rb:21:in `call'
  rack (1.5.2) lib/rack/runtime.rb:17:in `call'
  activesupport (4.1.6) lib/active_support/cache/strategy/local_cache_middleware.rb:26:in `call'
  rack (1.5.2) lib/rack/lock.rb:17:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/static.rb:64:in `call'
  rack (1.5.2) lib/rack/sendfile.rb:112:in `call'
  railties (4.1.6) lib/rails/engine.rb:514:in `call'
  railties (4.1.6) lib/rails/application.rb:144:in `call'
  rack (1.5.2) lib/rack/lock.rb:17:in `call'
  rack (1.5.2) lib/rack/content_length.rb:14:in `call'
  rack (1.5.2) lib/rack/handler/webrick.rb:60:in `service'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/httpserver.rb:138:in `service'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/httpserver.rb:94:in `run'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/server.rb:191:in `block in start_thread'


  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_trace.text.erb (0.6ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/routing_error.text.erb (4.6ms)


Started GET "/buy" for 127.0.0.1 at 2014-10-24 16:24:40 -0400
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Processing by BuyController#index as HTML
  [1m[35mProduct Load (0.1ms)[0m  SELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_checkout.html.erb (107.6ms)
  Rendered buy/index.html.erb within layouts/application (118.9ms)
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_stripe_header.html.erb (0.4ms)
Completed 200 OK in 260ms (Views: 214.9ms | ActiveRecord: 0.7ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-10-24 16:24:41 -0400


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-10-24 16:24:41 -0400


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-10-24 16:24:41 -0400


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-10-24 16:24:41 -0400


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-10-24 16:24:41 -0400


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-10-24 16:24:41 -0400


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-10-24 16:24:41 -0400


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-10-24 16:24:41 -0400


Started POST "/subdir/payola/buy/product/foo" for 127.0.0.1 at 2014-10-24 16:24:59 -0400
Processing by Payola::TransactionsController#create as */*
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"6wiHfmeZWKG5UrgLXFw7cSQK0NFLHPAx+oKixg5H3uM=", "stripeEmail"=>"pete@bugsplat.info", "product_class"=>"product", "permalink"=>"foo"}
  [1m[36mProduct Load (0.3ms)[0m  [1mSELECT  "products".* FROM "products"  WHERE "products"."permalink" = 'foo' LIMIT 1[0m
  [1m[35mPayola::Coupon Load (0.2ms)[0m  SELECT  "payola_coupons".* FROM "payola_coupons"  WHERE (lower(code) = lower(NULL))  ORDER BY "payola_coupons"."id" ASC LIMIT 1
  [1m[36mPayola::Affiliate Load (0.4ms)[0m  [1mSELECT  "payola_affiliates".* FROM "payola_affiliates"  WHERE (lower(code) = lower(NULL))  ORDER BY "payola_affiliates"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPayola::Sale Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "payola_sales"  WHERE "payola_sales"."guid" IS NULL LIMIT 1[0m
  [1m[35m (0.1ms)[0m  rollback transaction
Completed 400 Bad Request in 189ms (Views: 0.3ms | ActiveRecord: 1.9ms)


Started GET "/buy" for 127.0.0.1 at 2014-10-24 16:26:39 -0400
Processing by BuyController#index as HTML
  [1m[36mProduct Load (0.2ms)[0m  [1mSELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1[0m
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_checkout.html.erb (2.4ms)
  Rendered buy/index.html.erb within layouts/application (4.2ms)
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_stripe_header.html.erb (0.1ms)
Completed 200 OK in 63ms (Views: 60.7ms | ActiveRecord: 0.2ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-10-24 16:26:39 -0400


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-10-24 16:26:39 -0400


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-10-24 16:26:39 -0400


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-10-24 16:26:39 -0400


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-10-24 16:26:39 -0400


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-10-24 16:26:39 -0400


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-10-24 16:26:39 -0400


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-10-24 16:26:39 -0400


Started GET "/buy" for 127.0.0.1 at 2014-10-24 16:27:10 -0400
Processing by BuyController#index as HTML
  [1m[35mProduct Load (0.3ms)[0m  SELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_checkout.html.erb (2.4ms)
  Rendered buy/index.html.erb within layouts/application (4.0ms)
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_stripe_header.html.erb (0.1ms)
Completed 200 OK in 78ms (Views: 76.6ms | ActiveRecord: 0.2ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-10-24 16:27:10 -0400


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-10-24 16:27:10 -0400


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-10-24 16:27:10 -0400


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-10-24 16:27:10 -0400


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-10-24 16:27:10 -0400


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-10-24 16:27:10 -0400


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-10-24 16:27:10 -0400


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-10-24 16:27:10 -0400


Started POST "/subdir/payola/buy/product/foo" for 127.0.0.1 at 2014-10-24 16:27:24 -0400
Processing by Payola::TransactionsController#create as */*
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"6wiHfmeZWKG5UrgLXFw7cSQK0NFLHPAx+oKixg5H3uM=", "stripeEmail"=>"pete@bugsplat.info", "product_class"=>"product", "permalink"=>"foo"}
  [1m[36mProduct Load (0.2ms)[0m  [1mSELECT  "products".* FROM "products"  WHERE "products"."permalink" = 'foo' LIMIT 1[0m
  [1m[35mPayola::Coupon Load (0.1ms)[0m  SELECT  "payola_coupons".* FROM "payola_coupons"  WHERE (lower(code) = lower(NULL))  ORDER BY "payola_coupons"."id" ASC LIMIT 1
  [1m[36mPayola::Affiliate Load (0.2ms)[0m  [1mSELECT  "payola_affiliates".* FROM "payola_affiliates"  WHERE (lower(code) = lower(NULL))  ORDER BY "payola_affiliates"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPayola::Sale Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "payola_sales"  WHERE "payola_sales"."guid" IS NULL LIMIT 1[0m
  [1m[35m (0.0ms)[0m  rollback transaction
Completed 400 Bad Request in 136ms (Views: 0.3ms | ActiveRecord: 0.8ms)


Started GET "/buy" for 127.0.0.1 at 2014-10-24 16:45:18 -0400
Processing by BuyController#index as HTML
  [1m[36mProduct Load (0.2ms)[0m  [1mSELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1[0m
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_checkout.html.erb (1.9ms)
  Rendered buy/index.html.erb within layouts/application (3.1ms)
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_stripe_header.html.erb (0.1ms)
Completed 200 OK in 118ms (Views: 117.4ms | ActiveRecord: 0.2ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-10-24 16:45:18 -0400


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-10-24 16:45:18 -0400


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-10-24 16:45:18 -0400


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-10-24 16:45:18 -0400


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-10-24 16:45:18 -0400


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-10-24 16:45:18 -0400


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-10-24 16:45:18 -0400


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-10-24 16:45:18 -0400


Started POST "/subdir/payola/buy/product/foo" for 127.0.0.1 at 2014-10-24 16:45:33 -0400
Processing by Payola::TransactionsController#create as */*
  Parameters: {"stripeToken"=>"tok_14rEwDDpyMZVJxV9Hf80YEcn", "stripeEmail"=>"pete@bugsplat.info", "product_class"=>"product", "permalink"=>"foo"}
Can't verify CSRF token authenticity
Completed 422 Unprocessable Entity in 1ms

ActionController::InvalidAuthenticityToken (ActionController::InvalidAuthenticityToken):
  actionpack (4.1.6) lib/action_controller/metal/request_forgery_protection.rb:176:in `handle_unverified_request'
  actionpack (4.1.6) lib/action_controller/metal/request_forgery_protection.rb:202:in `handle_unverified_request'
  actionpack (4.1.6) lib/action_controller/metal/request_forgery_protection.rb:197:in `verify_authenticity_token'
  activesupport (4.1.6) lib/active_support/callbacks.rb:424:in `block in make_lambda'
  activesupport (4.1.6) lib/active_support/callbacks.rb:160:in `call'
  activesupport (4.1.6) lib/active_support/callbacks.rb:160:in `block in halting'
  activesupport (4.1.6) lib/active_support/callbacks.rb:86:in `call'
  activesupport (4.1.6) lib/active_support/callbacks.rb:86:in `run_callbacks'
  actionpack (4.1.6) lib/abstract_controller/callbacks.rb:19:in `process_action'
  actionpack (4.1.6) lib/action_controller/metal/rescue.rb:29:in `process_action'
  actionpack (4.1.6) lib/action_controller/metal/instrumentation.rb:31:in `block in process_action'
  activesupport (4.1.6) lib/active_support/notifications.rb:159:in `block in instrument'
  activesupport (4.1.6) lib/active_support/notifications/instrumenter.rb:20:in `instrument'
  activesupport (4.1.6) lib/active_support/notifications.rb:159:in `instrument'
  actionpack (4.1.6) lib/action_controller/metal/instrumentation.rb:30:in `process_action'
  actionpack (4.1.6) lib/action_controller/metal/params_wrapper.rb:250:in `process_action'
  activerecord (4.1.6) lib/active_record/railties/controller_runtime.rb:18:in `process_action'
  actionpack (4.1.6) lib/abstract_controller/base.rb:136:in `process'
  actionview (4.1.6) lib/action_view/rendering.rb:30:in `process'
  actionpack (4.1.6) lib/action_controller/metal.rb:196:in `dispatch'
  actionpack (4.1.6) lib/action_controller/metal/rack_delegation.rb:13:in `dispatch'
  actionpack (4.1.6) lib/action_controller/metal.rb:232:in `block in action'
  actionpack (4.1.6) lib/action_dispatch/routing/route_set.rb:82:in `call'
  actionpack (4.1.6) lib/action_dispatch/routing/route_set.rb:82:in `dispatch'
  actionpack (4.1.6) lib/action_dispatch/routing/route_set.rb:50:in `call'
  actionpack (4.1.6) lib/action_dispatch/journey/router.rb:73:in `block in call'
  actionpack (4.1.6) lib/action_dispatch/journey/router.rb:59:in `each'
  actionpack (4.1.6) lib/action_dispatch/journey/router.rb:59:in `call'
  actionpack (4.1.6) lib/action_dispatch/routing/route_set.rb:678:in `call'
  railties (4.1.6) lib/rails/engine.rb:514:in `call'
  railties (4.1.6) lib/rails/railtie.rb:194:in `public_send'
  railties (4.1.6) lib/rails/railtie.rb:194:in `method_missing'
  actionpack (4.1.6) lib/action_dispatch/journey/router.rb:73:in `block in call'
  actionpack (4.1.6) lib/action_dispatch/journey/router.rb:59:in `each'
  actionpack (4.1.6) lib/action_dispatch/journey/router.rb:59:in `call'
  actionpack (4.1.6) lib/action_dispatch/routing/route_set.rb:678:in `call'
  rack (1.5.2) lib/rack/etag.rb:23:in `call'
  rack (1.5.2) lib/rack/conditionalget.rb:35:in `call'
  rack (1.5.2) lib/rack/head.rb:11:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/params_parser.rb:27:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/flash.rb:254:in `call'
  rack (1.5.2) lib/rack/session/abstract/id.rb:225:in `context'
  rack (1.5.2) lib/rack/session/abstract/id.rb:220:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/cookies.rb:560:in `call'
  activerecord (4.1.6) lib/active_record/query_cache.rb:36:in `call'
  activerecord (4.1.6) lib/active_record/connection_adapters/abstract/connection_pool.rb:621:in `call'
  activerecord (4.1.6) lib/active_record/migration.rb:380:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/callbacks.rb:29:in `block in call'
  activesupport (4.1.6) lib/active_support/callbacks.rb:82:in `run_callbacks'
  actionpack (4.1.6) lib/action_dispatch/middleware/callbacks.rb:27:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/reloader.rb:73:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/remote_ip.rb:76:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/debug_exceptions.rb:17:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/show_exceptions.rb:30:in `call'
  railties (4.1.6) lib/rails/rack/logger.rb:38:in `call_app'
  railties (4.1.6) lib/rails/rack/logger.rb:20:in `block in call'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:68:in `block in tagged'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:26:in `tagged'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:68:in `tagged'
  railties (4.1.6) lib/rails/rack/logger.rb:20:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/request_id.rb:21:in `call'
  rack (1.5.2) lib/rack/methodoverride.rb:21:in `call'
  rack (1.5.2) lib/rack/runtime.rb:17:in `call'
  activesupport (4.1.6) lib/active_support/cache/strategy/local_cache_middleware.rb:26:in `call'
  rack (1.5.2) lib/rack/lock.rb:17:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/static.rb:64:in `call'
  rack (1.5.2) lib/rack/sendfile.rb:112:in `call'
  railties (4.1.6) lib/rails/engine.rb:514:in `call'
  railties (4.1.6) lib/rails/application.rb:144:in `call'
  rack (1.5.2) lib/rack/lock.rb:17:in `call'
  rack (1.5.2) lib/rack/content_length.rb:14:in `call'
  rack (1.5.2) lib/rack/handler/webrick.rb:60:in `service'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/httpserver.rb:138:in `service'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/httpserver.rb:94:in `run'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/server.rb:191:in `block in start_thread'


  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_source.erb (1.1ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_trace.text.erb (0.8ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_request_and_response.text.erb (1.1ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/diagnostics.erb (71.3ms)


Started GET "/buy" for 127.0.0.1 at 2014-10-24 16:50:10 -0400
Processing by BuyController#index as HTML
  [1m[35mProduct Load (0.2ms)[0m  SELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_checkout.html.erb (2.1ms)
  Rendered buy/index.html.erb within layouts/application (3.6ms)
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_stripe_header.html.erb (0.1ms)
Completed 200 OK in 129ms (Views: 127.8ms | ActiveRecord: 0.2ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-10-24 16:50:10 -0400


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-10-24 16:50:10 -0400


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-10-24 16:50:10 -0400


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-10-24 16:50:10 -0400


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-10-24 16:50:11 -0400


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-10-24 16:50:11 -0400


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-10-24 16:50:11 -0400


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-10-24 16:50:11 -0400


Started POST "/subdir/payola/buy/product/foo" for 127.0.0.1 at 2014-10-24 16:50:27 -0400
Processing by Payola::TransactionsController#create as */*
  Parameters: {"stripeToken"=>"tok_14rF0xDpyMZVJxV9zgP97t6C", "stripeEmail"=>"pete@bugsplat.info", "authenticity_token"=>"6wiHfmeZWKG5UrgLXFw7cSQK0NFLHPAx+oKixg5H3uM=", "product_class"=>"product", "permalink"=>"foo"}
  [1m[36mProduct Load (0.2ms)[0m  [1mSELECT  "products".* FROM "products"  WHERE "products"."permalink" = 'foo' LIMIT 1[0m
  [1m[35mPayola::Coupon Load (0.2ms)[0m  SELECT  "payola_coupons".* FROM "payola_coupons"  WHERE (lower(code) = lower(NULL))  ORDER BY "payola_coupons"."id" ASC LIMIT 1
  [1m[36mPayola::Affiliate Load (0.1ms)[0m  [1mSELECT  "payola_affiliates".* FROM "payola_affiliates"  WHERE (lower(code) = lower(NULL))  ORDER BY "payola_affiliates"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPayola::Sale Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "payola_sales"  WHERE "payola_sales"."guid" IS NULL LIMIT 1[0m
  [1m[35mCACHE (0.0ms)[0m  SELECT  1 AS one FROM "payola_sales"  WHERE "payola_sales"."guid" IS NULL LIMIT 1
  [1m[36mPayola::Sale Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "payola_sales"  WHERE "payola_sales"."guid" = '1v2hth' LIMIT 1[0m
  [1m[35mSQL (0.8ms)[0m  INSERT INTO "payola_sales" ("amount", "created_at", "currency", "email", "guid", "product_id", "product_type", "state", "stripe_token", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)  [["amount", 100], ["created_at", "2014-10-24 20:50:28.064239"], ["currency", "usd"], ["email", "pete@bugsplat.info"], ["guid", "1v2hth"], ["product_id", 1], ["product_type", "Product"], ["state", "pending"], ["stripe_token", "tok_14rF0xDpyMZVJxV9zgP97t6C"], ["updated_at", "2014-10-24 20:50:28.064239"]]
  [1m[36m (5.9ms)[0m  [1mcommit transaction[0m
Completed 200 OK in 355ms (Views: 0.4ms | ActiveRecord: 7.6ms)
  [1m[35mPayola::Sale Load (0.3ms)[0m  SELECT  "payola_sales".* FROM "payola_sales"  WHERE "payola_sales"."guid" = '1v2hth'  ORDER BY "payola_sales"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mSQL (0.5ms)[0m  UPDATE "payola_sales" SET "state" = 'processing' WHERE "payola_sales"."id" = 1


Started GET "/undefined/status/1v2hth" for 127.0.0.1 at 2014-10-24 16:50:28 -0400

ActionController::RoutingError (No route matches [GET] "/undefined/status/1v2hth"):
  actionpack (4.1.6) lib/action_dispatch/middleware/debug_exceptions.rb:21:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/show_exceptions.rb:30:in `call'
  railties (4.1.6) lib/rails/rack/logger.rb:38:in `call_app'
  railties (4.1.6) lib/rails/rack/logger.rb:20:in `block in call'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:68:in `block in tagged'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:26:in `tagged'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:68:in `tagged'
  railties (4.1.6) lib/rails/rack/logger.rb:20:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/request_id.rb:21:in `call'
  rack (1.5.2) lib/rack/methodoverride.rb:21:in `call'
  rack (1.5.2) lib/rack/runtime.rb:17:in `call'
  activesupport (4.1.6) lib/active_support/cache/strategy/local_cache_middleware.rb:26:in `call'
  rack (1.5.2) lib/rack/lock.rb:17:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/static.rb:64:in `call'
  rack (1.5.2) lib/rack/sendfile.rb:112:in `call'
  railties (4.1.6) lib/rails/engine.rb:514:in `call'
  railties (4.1.6) lib/rails/application.rb:144:in `call'
  rack (1.5.2) lib/rack/lock.rb:17:in `call'
  rack (1.5.2) lib/rack/content_length.rb:14:in `call'
  rack (1.5.2) lib/rack/handler/webrick.rb:60:in `service'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/httpserver.rb:138:in `service'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/httpserver.rb:94:in `run'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/server.rb:191:in `block in start_thread'


  [1m[36mPayola::Sale Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "payola_sales"  WHERE ("payola_sales"."guid" = '1v2hth' AND "payola_sales"."id" != 1) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "payola_sales" SET "state" = ?, "updated_at" = ? WHERE "payola_sales"."id" = 1  [["state", "processing"], ["updated_at", "2014-10-24 20:50:28.498900"]]
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_trace.text.erb (0.7ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/routing_error.text.erb (62.8ms)
  [1m[36mPayola::Sale Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "payola_sales"  WHERE ("payola_sales"."guid" = '1v2hth' AND "payola_sales"."id" != 1) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "payola_sales" SET "card_expiration" = ?, "card_last4" = ?, "card_type" = ?, "fee_amount" = ?, "stripe_customer_id" = ?, "stripe_id" = ?, "updated_at" = ? WHERE "payola_sales"."id" = 1  [["card_expiration", "2034-12-01"], ["card_last4", "4242"], ["card_type", "Visa"], ["fee_amount", 33], ["stripe_customer_id", "cus_51HaSWCD64X7ii"], ["stripe_id", "ch_14rF0zDpyMZVJxV9h51YbGRx"], ["updated_at", "2014-10-24 20:50:30.964672"]]
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (1.2ms)[0m  UPDATE "payola_sales" SET "state" = 'finished' WHERE "payola_sales"."id" = 1
  [1m[36mProduct Load (0.2ms)[0m  [1mSELECT  "products".* FROM "products"  WHERE "products"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.9ms)[0m  [1mcommit transaction[0m


Started GET "/buy" for 127.0.0.1 at 2014-10-24 16:50:55 -0400
Processing by BuyController#index as HTML
  [1m[35mProduct Load (0.6ms)[0m  SELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_checkout.html.erb (3.5ms)
  Rendered buy/index.html.erb within layouts/application (5.1ms)
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_stripe_header.html.erb (0.1ms)
Completed 200 OK in 128ms (Views: 125.7ms | ActiveRecord: 0.6ms)


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-10-24 16:50:56 -0400


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-10-24 16:50:56 -0400


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-10-24 16:50:56 -0400


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-10-24 16:50:56 -0400


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-10-24 16:50:56 -0400


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-10-24 16:50:56 -0400


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-10-24 16:50:56 -0400


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-10-24 16:50:56 -0400


Started POST "/subdir/payola/buy/product/foo" for 127.0.0.1 at 2014-10-24 16:51:07 -0400
Processing by Payola::TransactionsController#create as */*
  Parameters: {"stripeToken"=>"tok_14rF1bDpyMZVJxV9C5GT9wMk", "stripeEmail"=>"pete@bugsplat.info", "authenticity_token"=>"6wiHfmeZWKG5UrgLXFw7cSQK0NFLHPAx+oKixg5H3uM=", "product_class"=>"product", "permalink"=>"foo"}
  [1m[36mProduct Load (0.1ms)[0m  [1mSELECT  "products".* FROM "products"  WHERE "products"."permalink" = 'foo' LIMIT 1[0m
  [1m[35mPayola::Coupon Load (0.2ms)[0m  SELECT  "payola_coupons".* FROM "payola_coupons"  WHERE (lower(code) = lower(NULL))  ORDER BY "payola_coupons"."id" ASC LIMIT 1
  [1m[36mPayola::Affiliate Load (1.7ms)[0m  [1mSELECT  "payola_affiliates".* FROM "payola_affiliates"  WHERE (lower(code) = lower(NULL))  ORDER BY "payola_affiliates"."id" ASC LIMIT 1[0m
  [1m[35m (0.2ms)[0m  begin transaction
  [1m[36mPayola::Sale Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "payola_sales"  WHERE "payola_sales"."guid" IS NULL LIMIT 1[0m
  [1m[35mCACHE (0.0ms)[0m  SELECT  1 AS one FROM "payola_sales"  WHERE "payola_sales"."guid" IS NULL LIMIT 1
  [1m[36mPayola::Sale Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "payola_sales"  WHERE "payola_sales"."guid" = 'c6jbbp' LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "payola_sales" ("amount", "created_at", "currency", "email", "guid", "product_id", "product_type", "state", "stripe_token", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)  [["amount", 100], ["created_at", "2014-10-24 20:51:08.133946"], ["currency", "usd"], ["email", "pete@bugsplat.info"], ["guid", "c6jbbp"], ["product_id", 1], ["product_type", "Product"], ["state", "pending"], ["stripe_token", "tok_14rF1bDpyMZVJxV9C5GT9wMk"], ["updated_at", "2014-10-24 20:51:08.133946"]]
  [1m[36m (2.3ms)[0m  [1mcommit transaction[0m
Completed 200 OK in 283ms (Views: 0.3ms | ActiveRecord: 5.6ms)
  [1m[35mPayola::Sale Load (0.3ms)[0m  SELECT  "payola_sales".* FROM "payola_sales"  WHERE "payola_sales"."guid" = 'c6jbbp'  ORDER BY "payola_sales"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m

  [1m[35mSQL (0.5ms)[0m  UPDATE "payola_sales" SET "state" = 'processing' WHERE "payola_sales"."id" = 2

  [1m[36mPayola::Sale Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "payola_sales"  WHERE ("payola_sales"."guid" = 'c6jbbp' AND "payola_sales"."id" != 2) LIMIT 1[0m
Started GET "/subdir/payola/status/c6jbbp" for 127.0.0.1 at 2014-10-24 16:51:08 -0400
  [1m[35mSQL (0.1ms)[0m  UPDATE "payola_sales" SET "state" = ?, "updated_at" = ? WHERE "payola_sales"."id" = 2  [["state", "processing"], ["updated_at", "2014-10-24 20:51:08.268137"]]
Processing by Payola::TransactionsController#status as */*
  Parameters: {"guid"=>"c6jbbp"}
  [1m[36mPayola::Sale Load (0.2ms)[0m  [1mSELECT  "payola_sales".* FROM "payola_sales"  WHERE "payola_sales"."guid" = 'c6jbbp'  ORDER BY "payola_sales"."id" ASC LIMIT 1[0m
Completed 200 OK in 5ms (Views: 0.3ms | ActiveRecord: 1.4ms)


Started GET "/subdir/payola/status/c6jbbp" for 127.0.0.1 at 2014-10-24 16:51:08 -0400
Processing by Payola::TransactionsController#status as */*
  Parameters: {"guid"=>"c6jbbp"}
  [1m[35mPayola::Sale Load (0.2ms)[0m  SELECT  "payola_sales".* FROM "payola_sales"  WHERE "payola_sales"."guid" = 'c6jbbp'  ORDER BY "payola_sales"."id" ASC LIMIT 1
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.2ms)


Started GET "/subdir/payola/status/c6jbbp" for 127.0.0.1 at 2014-10-24 16:51:09 -0400
Processing by Payola::TransactionsController#status as */*
  Parameters: {"guid"=>"c6jbbp"}
  [1m[36mPayola::Sale Load (0.2ms)[0m  [1mSELECT  "payola_sales".* FROM "payola_sales"  WHERE "payola_sales"."guid" = 'c6jbbp'  ORDER BY "payola_sales"."id" ASC LIMIT 1[0m
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.2ms)


Started GET "/subdir/payola/status/c6jbbp" for 127.0.0.1 at 2014-10-24 16:51:10 -0400
Processing by Payola::TransactionsController#status as */*
  Parameters: {"guid"=>"c6jbbp"}
  [1m[35mPayola::Sale Load (0.3ms)[0m  SELECT  "payola_sales".* FROM "payola_sales"  WHERE "payola_sales"."guid" = 'c6jbbp'  ORDER BY "payola_sales"."id" ASC LIMIT 1
Completed 200 OK in 2ms (Views: 0.4ms | ActiveRecord: 0.3ms)
  [1m[36mPayola::Sale Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "payola_sales"  WHERE ("payola_sales"."guid" = 'c6jbbp' AND "payola_sales"."id" != 2) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "payola_sales" SET "card_expiration" = ?, "card_last4" = ?, "card_type" = ?, "fee_amount" = ?, "stripe_customer_id" = ?, "stripe_id" = ?, "updated_at" = ? WHERE "payola_sales"."id" = 2  [["card_expiration", "2034-12-01"], ["card_last4", "4242"], ["card_type", "Visa"], ["fee_amount", 33], ["stripe_customer_id", "cus_51Haa02oV95sKB"], ["stripe_id", "ch_14rF1dDpyMZVJxV9CmaAzs8b"], ["updated_at", "2014-10-24 20:51:10.511057"]]
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.7ms)[0m  UPDATE "payola_sales" SET "state" = 'finished' WHERE "payola_sales"."id" = 2
  [1m[36mProduct Load (0.2ms)[0m  [1mSELECT  "products".* FROM "products"  WHERE "products"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (2.2ms)[0m  [1mcommit transaction[0m


Started GET "/subdir/payola/status/c6jbbp" for 127.0.0.1 at 2014-10-24 16:51:10 -0400
Processing by Payola::TransactionsController#status as */*
  Parameters: {"guid"=>"c6jbbp"}
  [1m[35mPayola::Sale Load (0.2ms)[0m  SELECT  "payola_sales".* FROM "payola_sales"  WHERE "payola_sales"."guid" = 'c6jbbp'  ORDER BY "payola_sales"."id" ASC LIMIT 1
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.2ms)


Started POST "/" for 127.0.0.1 at 2014-10-24 16:51:10 -0400

ActionController::RoutingError (No route matches [POST] "/"):
  actionpack (4.1.6) lib/action_dispatch/middleware/debug_exceptions.rb:21:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/show_exceptions.rb:30:in `call'
  railties (4.1.6) lib/rails/rack/logger.rb:38:in `call_app'
  railties (4.1.6) lib/rails/rack/logger.rb:20:in `block in call'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:68:in `block in tagged'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:26:in `tagged'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:68:in `tagged'
  railties (4.1.6) lib/rails/rack/logger.rb:20:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/request_id.rb:21:in `call'
  rack (1.5.2) lib/rack/methodoverride.rb:21:in `call'
  rack (1.5.2) lib/rack/runtime.rb:17:in `call'
  activesupport (4.1.6) lib/active_support/cache/strategy/local_cache_middleware.rb:26:in `call'
  rack (1.5.2) lib/rack/lock.rb:17:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/static.rb:64:in `call'
  rack (1.5.2) lib/rack/sendfile.rb:112:in `call'
  railties (4.1.6) lib/rails/engine.rb:514:in `call'
  railties (4.1.6) lib/rails/application.rb:144:in `call'
  rack (1.5.2) lib/rack/lock.rb:17:in `call'
  rack (1.5.2) lib/rack/content_length.rb:14:in `call'
  rack (1.5.2) lib/rack/handler/webrick.rb:60:in `service'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/httpserver.rb:138:in `service'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/httpserver.rb:94:in `run'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/server.rb:191:in `block in start_thread'


  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (0.9ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/routes/_route.html.erb (1.3ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/routes/_route.html.erb (0.2ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/routes/_route.html.erb (0.3ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/routes/_table.html.erb (11.1ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/routing_error.html.erb within rescues/layout (124.3ms)


Started GET "/buy" for 127.0.0.1 at 2014-10-24 16:53:26 -0400
Processing by BuyController#index as HTML
  [1m[36mProduct Load (0.3ms)[0m  [1mSELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1[0m
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_checkout.html.erb (3.0ms)
  Rendered buy/index.html.erb within layouts/application (4.9ms)
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_stripe_header.html.erb (0.1ms)
Completed 200 OK in 135ms (Views: 133.5ms | ActiveRecord: 0.3ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-10-24 16:53:26 -0400


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-10-24 16:53:26 -0400


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-10-24 16:53:26 -0400


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-10-24 16:53:26 -0400


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-10-24 16:53:26 -0400


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-10-24 16:53:26 -0400


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-10-24 16:53:26 -0400


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-10-24 16:53:27 -0400


Started POST "/subdir/payola/buy/product/foo" for 127.0.0.1 at 2014-10-24 16:53:41 -0400
Processing by Payola::TransactionsController#create as */*
  Parameters: {"stripeToken"=>"tok_14rF45DpyMZVJxV9aT7V54TK", "stripeEmail"=>"pete@bugsplat.info", "authenticity_token"=>"6wiHfmeZWKG5UrgLXFw7cSQK0NFLHPAx+oKixg5H3uM=", "product_class"=>"product", "permalink"=>"foo"}
  [1m[35mProduct Load (0.1ms)[0m  SELECT  "products".* FROM "products"  WHERE "products"."permalink" = 'foo' LIMIT 1
  [1m[36mPayola::Coupon Load (0.2ms)[0m  [1mSELECT  "payola_coupons".* FROM "payola_coupons"  WHERE (lower(code) = lower(NULL))  ORDER BY "payola_coupons"."id" ASC LIMIT 1[0m
  [1m[35mPayola::Affiliate Load (0.1ms)[0m  SELECT  "payola_affiliates".* FROM "payola_affiliates"  WHERE (lower(code) = lower(NULL))  ORDER BY "payola_affiliates"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPayola::Sale Exists (0.2ms)[0m  SELECT  1 AS one FROM "payola_sales"  WHERE "payola_sales"."guid" IS NULL LIMIT 1
  [1m[36mCACHE (0.0ms)[0m  [1mSELECT  1 AS one FROM "payola_sales"  WHERE "payola_sales"."guid" IS NULL LIMIT 1[0m
  [1m[35mPayola::Sale Exists (0.1ms)[0m  SELECT  1 AS one FROM "payola_sales"  WHERE "payola_sales"."guid" = 'fmd7nk' LIMIT 1
  [1m[36mSQL (0.6ms)[0m  [1mINSERT INTO "payola_sales" ("amount", "created_at", "currency", "email", "guid", "product_id", "product_type", "state", "stripe_token", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["amount", 100], ["created_at", "2014-10-24 20:53:42.156020"], ["currency", "usd"], ["email", "pete@bugsplat.info"], ["guid", "fmd7nk"], ["product_id", 1], ["product_type", "Product"], ["state", "pending"], ["stripe_token", "tok_14rF45DpyMZVJxV9aT7V54TK"], ["updated_at", "2014-10-24 20:53:42.156020"]]
  [1m[35m (2.2ms)[0m  commit transaction
Completed 200 OK in 297ms (Views: 0.2ms | ActiveRecord: 3.8ms)
  [1m[36mPayola::Sale Load (0.3ms)[0m  [1mSELECT  "payola_sales".* FROM "payola_sales"  WHERE "payola_sales"."guid" = 'fmd7nk'  ORDER BY "payola_sales"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  begin transaction

  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "payola_sales" SET "state" = 'processing' WHERE "payola_sales"."id" = 3[0m

  [1m[35mPayola::Sale Exists (0.1ms)[0m  SELECT  1 AS one FROM "payola_sales"  WHERE ("payola_sales"."guid" = 'fmd7nk' AND "payola_sales"."id" != 3) LIMIT 1
Started GET "/subdir/payola/status/fmd7nk" for 127.0.0.1 at 2014-10-24 16:53:42 -0400
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "payola_sales" SET "state" = ?, "updated_at" = ? WHERE "payola_sales"."id" = 3[0m  [["state", "processing"], ["updated_at", "2014-10-24 20:53:42.258338"]]
Processing by Payola::TransactionsController#status as */*
  Parameters: {"guid"=>"fmd7nk"}
  [1m[35mPayola::Sale Load (0.3ms)[0m  SELECT  "payola_sales".* FROM "payola_sales"  WHERE "payola_sales"."guid" = 'fmd7nk'  ORDER BY "payola_sales"."id" ASC LIMIT 1
Completed 200 OK in 2ms (Views: 0.2ms | ActiveRecord: 0.3ms)


Started GET "/subdir/payola/status/fmd7nk" for 127.0.0.1 at 2014-10-24 16:53:42 -0400
Processing by Payola::TransactionsController#status as */*
  Parameters: {"guid"=>"fmd7nk"}
  [1m[36mPayola::Sale Load (0.4ms)[0m  [1mSELECT  "payola_sales".* FROM "payola_sales"  WHERE "payola_sales"."guid" = 'fmd7nk'  ORDER BY "payola_sales"."id" ASC LIMIT 1[0m
Completed 200 OK in 2ms (Views: 0.4ms | ActiveRecord: 0.4ms)


Started GET "/subdir/payola/status/fmd7nk" for 127.0.0.1 at 2014-10-24 16:53:43 -0400
Processing by Payola::TransactionsController#status as */*
  Parameters: {"guid"=>"fmd7nk"}
  [1m[35mPayola::Sale Load (0.2ms)[0m  SELECT  "payola_sales".* FROM "payola_sales"  WHERE "payola_sales"."guid" = 'fmd7nk'  ORDER BY "payola_sales"."id" ASC LIMIT 1
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.2ms)


Started GET "/subdir/payola/status/fmd7nk" for 127.0.0.1 at 2014-10-24 16:53:44 -0400
Processing by Payola::TransactionsController#status as */*
  Parameters: {"guid"=>"fmd7nk"}
  [1m[36mPayola::Sale Load (0.3ms)[0m  [1mSELECT  "payola_sales".* FROM "payola_sales"  WHERE "payola_sales"."guid" = 'fmd7nk'  ORDER BY "payola_sales"."id" ASC LIMIT 1[0m
Completed 200 OK in 2ms (Views: 0.3ms | ActiveRecord: 0.3ms)
  [1m[35mPayola::Sale Exists (0.2ms)[0m  SELECT  1 AS one FROM "payola_sales"  WHERE ("payola_sales"."guid" = 'fmd7nk' AND "payola_sales"."id" != 3) LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "payola_sales" SET "card_expiration" = ?, "card_last4" = ?, "card_type" = ?, "fee_amount" = ?, "stripe_customer_id" = ?, "stripe_id" = ?, "updated_at" = ? WHERE "payola_sales"."id" = 3[0m  [["card_expiration", "2034-12-01"], ["card_last4", "4242"], ["card_type", "Visa"], ["fee_amount", 33], ["stripe_customer_id", "cus_51HdNSPn0zJj4Q"], ["stripe_id", "ch_14rF47DpyMZVJxV911dIpIYX"], ["updated_at", "2014-10-24 20:53:44.712072"]]
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1

  [1m[36mSQL (0.4ms)[0m  [1mUPDATE "payola_sales" SET "state" = 'finished' WHERE "payola_sales"."id" = 3[0m

  [1m[35mProduct Load (0.1ms)[0m  SELECT  "products".* FROM "products"  WHERE "products"."id" = ? LIMIT 1  [["id", 1]]
Started GET "/subdir/payola/status/fmd7nk" for 127.0.0.1 at 2014-10-24 16:53:44 -0400
  [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Processing by Payola::TransactionsController#status as */*
  [1m[35m (2.0ms)[0m  commit transaction
  Parameters: {"guid"=>"fmd7nk"}
  [1m[36mPayola::Sale Load (0.3ms)[0m  [1mSELECT  "payola_sales".* FROM "payola_sales"  WHERE "payola_sales"."guid" = 'fmd7nk'  ORDER BY "payola_sales"."id" ASC LIMIT 1[0m
Completed 200 OK in 2ms (Views: 0.3ms | ActiveRecord: 0.3ms)


Started POST "/" for 127.0.0.1 at 2014-10-24 16:53:45 -0400

ActionController::RoutingError (No route matches [POST] "/"):
  actionpack (4.1.6) lib/action_dispatch/middleware/debug_exceptions.rb:21:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/show_exceptions.rb:30:in `call'
  railties (4.1.6) lib/rails/rack/logger.rb:38:in `call_app'
  railties (4.1.6) lib/rails/rack/logger.rb:20:in `block in call'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:68:in `block in tagged'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:26:in `tagged'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:68:in `tagged'
  railties (4.1.6) lib/rails/rack/logger.rb:20:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/request_id.rb:21:in `call'
  rack (1.5.2) lib/rack/methodoverride.rb:21:in `call'
  rack (1.5.2) lib/rack/runtime.rb:17:in `call'
  activesupport (4.1.6) lib/active_support/cache/strategy/local_cache_middleware.rb:26:in `call'
  rack (1.5.2) lib/rack/lock.rb:17:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/static.rb:64:in `call'
  rack (1.5.2) lib/rack/sendfile.rb:112:in `call'
  railties (4.1.6) lib/rails/engine.rb:514:in `call'
  railties (4.1.6) lib/rails/application.rb:144:in `call'
  rack (1.5.2) lib/rack/lock.rb:17:in `call'
  rack (1.5.2) lib/rack/content_length.rb:14:in `call'
  rack (1.5.2) lib/rack/handler/webrick.rb:60:in `service'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/httpserver.rb:138:in `service'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/httpserver.rb:94:in `run'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/server.rb:191:in `block in start_thread'


  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (1.7ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/routes/_route.html.erb (1.9ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/routes/_route.html.erb (0.1ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/routes/_route.html.erb (0.3ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/routes/_table.html.erb (1.2ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/routing_error.html.erb within rescues/layout (150.3ms)


Started GET "/" for 127.0.0.1 at 2014-10-25 09:14:00 -0400
Processing by Rails::WelcomeController#index as HTML
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/railties-4.1.6/lib/rails/templates/rails/welcome/index.html.erb (2.8ms)
Completed 200 OK in 11ms (Views: 10.2ms | ActiveRecord: 0.0ms)


Started GET "/" for 127.0.0.1 at 2014-10-25 22:07:03 -0400
Processing by Rails::WelcomeController#index as HTML
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/railties-4.1.6/lib/rails/templates/rails/welcome/index.html.erb (0.1ms)
Completed 200 OK in 3ms (Views: 3.1ms | ActiveRecord: 0.0ms)
Terminating 3 actors...


Started GET "/buy" for 127.0.0.1 at 2014-10-26 09:39:07 -0400
  [1m[36mActiveRecord::SchemaMigration Load (0.5ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Processing by BuyController#index as HTML
  [1m[35mProduct Load (0.5ms)[0m  SELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_checkout.html.erb (145.6ms)
  Rendered buy/index.html.erb within layouts/application (154.4ms)
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_stripe_header.html.erb (0.5ms)
Completed 200 OK in 359ms (Views: 307.5ms | ActiveRecord: 1.2ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-10-26 09:39:08 -0400


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-10-26 09:39:08 -0400


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-10-26 09:39:08 -0400


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-10-26 09:39:08 -0400


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-10-26 09:39:08 -0400


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-10-26 09:39:08 -0400


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-10-26 09:39:08 -0400


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-10-26 09:39:08 -0400


Started GET "/buy" for 127.0.0.1 at 2014-10-26 09:39:44 -0400
Processing by BuyController#index as HTML
  [1m[36mProduct Load (0.4ms)[0m  [1mSELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1[0m
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_checkout.html.erb (3.2ms)
  Rendered buy/index.html.erb within layouts/application (5.2ms)
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_stripe_header.html.erb (0.1ms)
Completed 200 OK in 92ms (Views: 83.3ms | ActiveRecord: 0.4ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-10-26 09:39:44 -0400


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-10-26 09:39:44 -0400


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-10-26 09:39:44 -0400


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-10-26 09:39:44 -0400


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-10-26 09:39:44 -0400


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-10-26 09:39:44 -0400


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-10-26 09:39:44 -0400


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-10-26 09:39:45 -0400


Started GET "/buy" for 127.0.0.1 at 2014-10-26 09:40:25 -0400
Processing by BuyController#index as HTML
  [1m[35mProduct Load (0.3ms)[0m  SELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_checkout.html.erb (6.0ms)
  Rendered buy/index.html.erb within layouts/application (7.7ms)
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_stripe_header.html.erb (0.1ms)
Completed 200 OK in 62ms (Views: 60.1ms | ActiveRecord: 0.3ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-10-26 09:40:26 -0400


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-10-26 09:40:26 -0400


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-10-26 09:40:26 -0400


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-10-26 09:40:26 -0400


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-10-26 09:40:26 -0400


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-10-26 09:40:26 -0400


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-10-26 09:40:26 -0400


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-10-26 09:40:26 -0400


Started GET "/buy" for 127.0.0.1 at 2014-10-26 09:41:01 -0400
Processing by BuyController#index as HTML
  [1m[36mProduct Load (0.2ms)[0m  [1mSELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1[0m
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_checkout.html.erb (4.0ms)
  Rendered buy/index.html.erb within layouts/application (5.4ms)
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_stripe_header.html.erb (0.1ms)
Completed 200 OK in 84ms (Views: 82.8ms | ActiveRecord: 0.2ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-10-26 09:41:01 -0400


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-10-26 09:41:01 -0400


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-10-26 09:41:01 -0400


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-10-26 09:41:01 -0400


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-10-26 09:41:01 -0400


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-10-26 09:41:01 -0400


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-10-26 09:41:01 -0400


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-10-26 09:41:01 -0400
  [1m[36m (3.0ms)[0m  [1mCREATE TABLE "payola_affiliates" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "code" varchar(255), "email" varchar(255), "percent" integer, "created_at" datetime, "updated_at" datetime) [0m
  [1m[35m (0.8ms)[0m  CREATE TABLE "payola_coupons" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "code" varchar(255), "percent_off" integer, "created_at" datetime, "updated_at" datetime) 
  [1m[36m (0.8ms)[0m  [1mCREATE TABLE "payola_sales" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar(255), "guid" varchar(255), "product_id" integer, "product_type" varchar(255), "created_at" datetime, "updated_at" datetime, "state" varchar(255), "stripe_id" varchar(255), "stripe_token" varchar(255), "card_last4" varchar(255), "card_expiration" date, "card_type" varchar(255), "error" text, "amount" integer, "fee_amount" integer, "coupon_id" integer, "opt_in" boolean, "download_count" integer, "affiliate_id" integer, "customer_address" text, "business_address" text, "stripe_customer_id" varchar(255), "currency" varchar(255), "custom_fields" text) [0m
  [1m[35m (0.2ms)[0m  select sqlite_version(*)
  [1m[36m (0.9ms)[0m  [1mCREATE  INDEX "index_payola_sales_on_coupon_id" ON "payola_sales" ("coupon_id")[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'

  [1m[36m (0.8ms)[0m  [1mCREATE  INDEX "index_payola_sales_on_email" ON "payola_sales" ("email")[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_email' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'
[0m
  [1m[35m (0.8ms)[0m  CREATE  INDEX "index_payola_sales_on_guid" ON "payola_sales" ("guid")
  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_guid' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_guid' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_email' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  CREATE  INDEX "index_payola_sales_on_product" ON "payola_sales" ("product_id", "product_type")
  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_product' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_product' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_guid' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_guid' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_email' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'

  [1m[36m (0.9ms)[0m  [1mCREATE  INDEX "index_payola_sales_on_stripe_customer_id" ON "payola_sales" ("stripe_customer_id")[0m
  [1m[35m (0.8ms)[0m  CREATE TABLE "payola_stripe_webhooks" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "stripe_id" varchar(255), "created_at" datetime, "updated_at" datetime) 
  [1m[36m (0.8ms)[0m  [1mCREATE TABLE "products" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar(255), "permalink" varchar(255), "price" integer, "created_at" datetime, "updated_at" datetime) [0m
  [1m[35m (0.9ms)[0m  CREATE TABLE "schema_migrations" ("version" varchar(255) NOT NULL) 
  [1m[36m (1.0ms)[0m  [1mCREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")[0m
  [1m[35m (0.2ms)[0m  SELECT version FROM "schema_migrations"
  [1m[36m (1.2ms)[0m  [1mINSERT INTO "schema_migrations" (version) VALUES ('20141026101628')[0m
  [1m[35m (0.8ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20141001230848')
  [1m[36m (0.7ms)[0m  [1mINSERT INTO "schema_migrations" (version) VALUES ('20141001170138')[0m
  [1m[35m (0.8ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20141001203541')
  [1m[36m (0.8ms)[0m  [1mINSERT INTO "schema_migrations" (version) VALUES ('20141002013618')[0m
  [1m[35m (0.7ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20141002013701')
  [1m[36m (0.7ms)[0m  [1mINSERT INTO "schema_migrations" (version) VALUES ('20141002203725')[0m
  [1m[35m (0.7ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20141017233304')


Started GET "/" for 127.0.0.1 at 2014-10-28 07:59:00 -0400
  [1m[36mActiveRecord::SchemaMigration Load (0.5ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Processing by Rails::WelcomeController#index as HTML
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/railties-4.1.6/lib/rails/templates/rails/welcome/index.html.erb (2.1ms)
Completed 200 OK in 9ms (Views: 8.8ms | ActiveRecord: 0.0ms)


Started GET "/buy" for 127.0.0.1 at 2014-10-28 07:59:03 -0400
Processing by BuyController#index as HTML
  [1m[35mProduct Load (0.5ms)[0m  SELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_checkout.html.erb (144.0ms)
  Rendered buy/index.html.erb within layouts/application (149.9ms)
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_stripe_header.html.erb (0.4ms)
Completed 200 OK in 242ms (Views: 232.9ms | ActiveRecord: 1.1ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-10-28 07:59:04 -0400


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-10-28 07:59:04 -0400


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-10-28 07:59:04 -0400


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-10-28 07:59:04 -0400


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-10-28 07:59:04 -0400


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-10-28 07:59:04 -0400


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-10-28 07:59:04 -0400


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-10-28 07:59:04 -0400


Started GET "/buy" for 127.0.0.1 at 2014-10-28 07:59:55 -0400
Processing by BuyController#index as HTML
  [1m[36mProduct Load (0.1ms)[0m  [1mSELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1[0m
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_checkout.html.erb (12.1ms)
  Rendered buy/index.html.erb within layouts/application (13.8ms)
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_stripe_header.html.erb (0.1ms)
Completed 200 OK in 94ms (Views: 84.2ms | ActiveRecord: 1.2ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-10-28 07:59:55 -0400


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-10-28 07:59:55 -0400


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-10-28 07:59:55 -0400


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-10-28 07:59:55 -0400


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-10-28 07:59:55 -0400


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-10-28 07:59:55 -0400


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-10-28 07:59:55 -0400


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-10-28 07:59:55 -0400


Started GET "/buy" for 127.0.0.1 at 2014-10-28 08:00:13 -0400
Processing by BuyController#index as HTML
  [1m[35mProduct Load (0.2ms)[0m  SELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_checkout.html.erb (5.0ms)
  Rendered buy/index.html.erb within layouts/application (7.1ms)
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_stripe_header.html.erb (0.1ms)
Completed 200 OK in 60ms (Views: 58.9ms | ActiveRecord: 0.2ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-10-28 08:00:13 -0400


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-10-28 08:00:13 -0400


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-10-28 08:00:13 -0400


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-10-28 08:00:13 -0400


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-10-28 08:00:13 -0400


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-10-28 08:00:13 -0400


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-10-28 08:00:13 -0400


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-10-28 08:00:13 -0400


Started GET "/buy" for 127.0.0.1 at 2014-10-28 08:01:33 -0400
Processing by BuyController#index as HTML
  [1m[36mProduct Load (0.2ms)[0m  [1mSELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1[0m
  Rendered buy/index.html.erb within layouts/application (0.9ms)
Completed 500 Internal Server Error in 6ms

SyntaxError (/Users/peter/devel/payola/spec/dummy/app/views/buy/index.html.erb:1: syntax error, unexpected tSTRING_BEG, expecting keyword_do or '{' or '('
...s: 'not-a-class', panel_label '{{amount}}' );@output_buffer....
...                               ^):
  app/views/buy/index.html.erb:1: syntax error, unexpected tSTRING_BEG, expecting keyword_do or '{' or '('


  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_source.erb (0.7ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (1.1ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.2ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/diagnostics.erb within rescues/layout (51.1ms)


Started GET "/buy" for 127.0.0.1 at 2014-10-28 08:01:39 -0400
Processing by BuyController#index as HTML
  [1m[35mProduct Load (0.3ms)[0m  SELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_checkout.html.erb (4.3ms)
  Rendered buy/index.html.erb within layouts/application (6.3ms)
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_stripe_header.html.erb (0.1ms)
Completed 200 OK in 80ms (Views: 78.8ms | ActiveRecord: 0.3ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-10-28 08:01:39 -0400


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-10-28 08:01:39 -0400


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-10-28 08:01:39 -0400


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-10-28 08:01:39 -0400


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-10-28 08:01:39 -0400


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-10-28 08:01:39 -0400


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-10-28 08:01:39 -0400


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-10-28 08:01:39 -0400


Started GET "/buy" for 127.0.0.1 at 2014-10-28 08:01:55 -0400
Processing by BuyController#index as HTML
  [1m[36mProduct Load (0.3ms)[0m  [1mSELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1[0m
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_checkout.html.erb (2.7ms)
  Rendered buy/index.html.erb within layouts/application (8.5ms)
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_stripe_header.html.erb (0.1ms)
Completed 200 OK in 89ms (Views: 87.4ms | ActiveRecord: 0.3ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-10-28 08:01:55 -0400


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-10-28 08:01:55 -0400


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-10-28 08:01:55 -0400


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-10-28 08:01:55 -0400


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-10-28 08:01:55 -0400


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-10-28 08:01:55 -0400


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-10-28 08:01:55 -0400


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-10-28 08:01:55 -0400


Started GET "/buy" for 127.0.0.1 at 2014-10-28 08:06:02 -0400
Processing by BuyController#index as HTML
  [1m[35mProduct Load (0.1ms)[0m  SELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_checkout.html.erb (12.3ms)
  Rendered buy/index.html.erb within layouts/application (14.2ms)
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_stripe_header.html.erb (0.1ms)
Completed 200 OK in 89ms (Views: 80.9ms | ActiveRecord: 0.9ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-10-28 08:06:02 -0400


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-10-28 08:06:02 -0400


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-10-28 08:06:02 -0400


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-10-28 08:06:02 -0400


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-10-28 08:06:02 -0400


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-10-28 08:06:02 -0400


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-10-28 08:06:02 -0400


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-10-28 08:06:02 -0400


Started GET "/" for 127.0.0.1 at 2014-10-28 14:45:44 -0400
  [1m[36mActiveRecord::SchemaMigration Load (0.5ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Processing by Rails::WelcomeController#index as HTML
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/railties-4.1.6/lib/rails/templates/rails/welcome/index.html.erb (4.2ms)
Completed 200 OK in 15ms (Views: 14.8ms | ActiveRecord: 0.0ms)


Started GET "/buy" for 127.0.0.1 at 2014-10-28 14:45:46 -0400
Processing by BuyController#index as HTML
  [1m[35mProduct Load (0.6ms)[0m  SELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_checkout.html.erb (163.1ms)
  Rendered buy/index.html.erb within layouts/application (169.1ms)
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_stripe_header.html.erb (0.8ms)
Completed 200 OK in 272ms (Views: 261.5ms | ActiveRecord: 1.2ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-10-28 14:45:46 -0400


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-10-28 14:45:47 -0400


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-10-28 14:45:47 -0400


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-10-28 14:45:47 -0400


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-10-28 14:45:47 -0400


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-10-28 14:45:47 -0400


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-10-28 14:45:47 -0400


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-10-28 14:45:47 -0400


Started GET "/buy" for 127.0.0.1 at 2014-10-28 14:47:36 -0400
Processing by BuyController#index as HTML
  [1m[36mProduct Load (0.3ms)[0m  [1mSELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1[0m
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_checkout.html.erb (5.0ms)
  Rendered buy/index.html.erb within layouts/application (7.1ms)
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_stripe_header.html.erb (0.0ms)
Completed 200 OK in 103ms (Views: 101.2ms | ActiveRecord: 0.3ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-10-28 14:47:36 -0400


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-10-28 14:47:36 -0400


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-10-28 14:47:36 -0400


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-10-28 14:47:36 -0400


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-10-28 14:47:36 -0400


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-10-28 14:47:36 -0400


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-10-28 14:47:36 -0400


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-10-28 14:47:36 -0400


Started POST "/subdir/payola/buy/product/foo" for 127.0.0.1 at 2014-10-28 14:48:05 -0400
Processing by Payola::TransactionsController#create as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"2IuIJThdxsedZZm+4RNkPb6BrXTjLdCWKYgcutw62cE=", "product_class"=>"product", "permalink"=>"foo"}
  [1m[35mProduct Load (0.2ms)[0m  SELECT  "products".* FROM "products"  WHERE "products"."permalink" = 'foo' LIMIT 1
  [1m[36mPayola::Coupon Load (0.5ms)[0m  [1mSELECT  "payola_coupons".* FROM "payola_coupons"  WHERE (lower(code) = lower(NULL))  ORDER BY "payola_coupons"."id" ASC LIMIT 1[0m
  [1m[35mPayola::Affiliate Load (0.4ms)[0m  SELECT  "payola_affiliates".* FROM "payola_affiliates"  WHERE (lower(code) = lower(NULL))  ORDER BY "payola_affiliates"."id" ASC LIMIT 1
Completed 500 Internal Server Error in 92ms

NoMethodError (undefined method `signed_custom_fields=' for #<Payola::Sale:0x007fc91a49e5e0>):
  activemodel (4.1.6) lib/active_model/attribute_methods.rb:435:in `method_missing'
  activerecord (4.1.6) lib/active_record/attribute_methods.rb:211:in `method_missing'
  /Users/peter/devel/payola/app/services/payola/create_sale.rb:14:in `block in call'
  activerecord (4.1.6) lib/active_record/core.rb:200:in `initialize'
  activerecord (4.1.6) lib/active_record/inheritance.rb:30:in `new'
  activerecord (4.1.6) lib/active_record/inheritance.rb:30:in `new'
  /Users/peter/devel/payola/app/services/payola/create_sale.rb:8:in `call'
  /Users/peter/devel/payola/app/controllers/payola/transactions_controller.rb:26:in `create'
  actionpack (4.1.6) lib/action_controller/metal/implicit_render.rb:4:in `send_action'
  actionpack (4.1.6) lib/abstract_controller/base.rb:189:in `process_action'
  actionpack (4.1.6) lib/action_controller/metal/rendering.rb:10:in `process_action'
  actionpack (4.1.6) lib/abstract_controller/callbacks.rb:20:in `block in process_action'
  activesupport (4.1.6) lib/active_support/callbacks.rb:113:in `call'
  activesupport (4.1.6) lib/active_support/callbacks.rb:113:in `call'
  activesupport (4.1.6) lib/active_support/callbacks.rb:149:in `block in halting_and_conditional'
  activesupport (4.1.6) lib/active_support/callbacks.rb:229:in `call'
  activesupport (4.1.6) lib/active_support/callbacks.rb:229:in `block in halting'
  activesupport (4.1.6) lib/active_support/callbacks.rb:166:in `call'
  activesupport (4.1.6) lib/active_support/callbacks.rb:166:in `block in halting'
  activesupport (4.1.6) lib/active_support/callbacks.rb:86:in `call'
  activesupport (4.1.6) lib/active_support/callbacks.rb:86:in `run_callbacks'
  actionpack (4.1.6) lib/abstract_controller/callbacks.rb:19:in `process_action'
  actionpack (4.1.6) lib/action_controller/metal/rescue.rb:29:in `process_action'
  actionpack (4.1.6) lib/action_controller/metal/instrumentation.rb:31:in `block in process_action'
  activesupport (4.1.6) lib/active_support/notifications.rb:159:in `block in instrument'
  activesupport (4.1.6) lib/active_support/notifications/instrumenter.rb:20:in `instrument'
  activesupport (4.1.6) lib/active_support/notifications.rb:159:in `instrument'
  actionpack (4.1.6) lib/action_controller/metal/instrumentation.rb:30:in `process_action'
  actionpack (4.1.6) lib/action_controller/metal/params_wrapper.rb:250:in `process_action'
  activerecord (4.1.6) lib/active_record/railties/controller_runtime.rb:18:in `process_action'
  actionpack (4.1.6) lib/abstract_controller/base.rb:136:in `process'
  actionview (4.1.6) lib/action_view/rendering.rb:30:in `process'
  actionpack (4.1.6) lib/action_controller/metal.rb:196:in `dispatch'
  actionpack (4.1.6) lib/action_controller/metal/rack_delegation.rb:13:in `dispatch'
  actionpack (4.1.6) lib/action_controller/metal.rb:232:in `block in action'
  actionpack (4.1.6) lib/action_dispatch/routing/route_set.rb:82:in `call'
  actionpack (4.1.6) lib/action_dispatch/routing/route_set.rb:82:in `dispatch'
  actionpack (4.1.6) lib/action_dispatch/routing/route_set.rb:50:in `call'
  actionpack (4.1.6) lib/action_dispatch/journey/router.rb:73:in `block in call'
  actionpack (4.1.6) lib/action_dispatch/journey/router.rb:59:in `each'
  actionpack (4.1.6) lib/action_dispatch/journey/router.rb:59:in `call'
  actionpack (4.1.6) lib/action_dispatch/routing/route_set.rb:678:in `call'
  railties (4.1.6) lib/rails/engine.rb:514:in `call'
  railties (4.1.6) lib/rails/railtie.rb:194:in `public_send'
  railties (4.1.6) lib/rails/railtie.rb:194:in `method_missing'
  actionpack (4.1.6) lib/action_dispatch/journey/router.rb:73:in `block in call'
  actionpack (4.1.6) lib/action_dispatch/journey/router.rb:59:in `each'
  actionpack (4.1.6) lib/action_dispatch/journey/router.rb:59:in `call'
  actionpack (4.1.6) lib/action_dispatch/routing/route_set.rb:678:in `call'
  rack (1.5.2) lib/rack/etag.rb:23:in `call'
  rack (1.5.2) lib/rack/conditionalget.rb:35:in `call'
  rack (1.5.2) lib/rack/head.rb:11:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/params_parser.rb:27:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/flash.rb:254:in `call'
  rack (1.5.2) lib/rack/session/abstract/id.rb:225:in `context'
  rack (1.5.2) lib/rack/session/abstract/id.rb:220:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/cookies.rb:560:in `call'
  activerecord (4.1.6) lib/active_record/query_cache.rb:36:in `call'
  activerecord (4.1.6) lib/active_record/connection_adapters/abstract/connection_pool.rb:621:in `call'
  activerecord (4.1.6) lib/active_record/migration.rb:380:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/callbacks.rb:29:in `block in call'
  activesupport (4.1.6) lib/active_support/callbacks.rb:82:in `run_callbacks'
  actionpack (4.1.6) lib/action_dispatch/middleware/callbacks.rb:27:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/reloader.rb:73:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/remote_ip.rb:76:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/debug_exceptions.rb:17:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/show_exceptions.rb:30:in `call'
  railties (4.1.6) lib/rails/rack/logger.rb:38:in `call_app'
  railties (4.1.6) lib/rails/rack/logger.rb:20:in `block in call'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:68:in `block in tagged'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:26:in `tagged'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:68:in `tagged'
  railties (4.1.6) lib/rails/rack/logger.rb:20:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/request_id.rb:21:in `call'
  rack (1.5.2) lib/rack/methodoverride.rb:21:in `call'
  rack (1.5.2) lib/rack/runtime.rb:17:in `call'
  activesupport (4.1.6) lib/active_support/cache/strategy/local_cache_middleware.rb:26:in `call'
  rack (1.5.2) lib/rack/lock.rb:17:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/static.rb:64:in `call'
  rack (1.5.2) lib/rack/sendfile.rb:112:in `call'
  railties (4.1.6) lib/rails/engine.rb:514:in `call'
  railties (4.1.6) lib/rails/application.rb:144:in `call'
  rack (1.5.2) lib/rack/lock.rb:17:in `call'
  rack (1.5.2) lib/rack/content_length.rb:14:in `call'
  rack (1.5.2) lib/rack/handler/webrick.rb:60:in `service'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/httpserver.rb:138:in `service'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/httpserver.rb:94:in `run'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/server.rb:191:in `block in start_thread'


  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_source.erb (0.5ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (1.1ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.0ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/diagnostics.erb within rescues/layout (47.7ms)


Started GET "/buy" for 127.0.0.1 at 2014-10-28 14:48:29 -0400
Processing by BuyController#index as HTML
  [1m[36mProduct Load (0.3ms)[0m  [1mSELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1[0m
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_checkout.html.erb (3.4ms)
  Rendered buy/index.html.erb within layouts/application (5.2ms)
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_stripe_header.html.erb (0.1ms)
Completed 200 OK in 128ms (Views: 125.9ms | ActiveRecord: 0.3ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-10-28 14:48:29 -0400


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-10-28 14:48:29 -0400


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-10-28 14:48:29 -0400


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-10-28 14:48:29 -0400


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-10-28 14:48:29 -0400


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-10-28 14:48:29 -0400


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-10-28 14:48:29 -0400


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-10-28 14:48:29 -0400


Started POST "/subdir/payola/buy/product/foo" for 127.0.0.1 at 2014-10-28 14:48:32 -0400
Processing by Payola::TransactionsController#create as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"2IuIJThdxsedZZm+4RNkPb6BrXTjLdCWKYgcutw62cE=", "product_class"=>"product", "permalink"=>"foo"}
  [1m[35mProduct Load (0.3ms)[0m  SELECT  "products".* FROM "products"  WHERE "products"."permalink" = 'foo' LIMIT 1
  [1m[36mPayola::Coupon Load (0.2ms)[0m  [1mSELECT  "payola_coupons".* FROM "payola_coupons"  WHERE (lower(code) = lower(NULL))  ORDER BY "payola_coupons"."id" ASC LIMIT 1[0m
  [1m[35mPayola::Affiliate Load (0.1ms)[0m  SELECT  "payola_affiliates".* FROM "payola_affiliates"  WHERE (lower(code) = lower(NULL))  ORDER BY "payola_affiliates"."id" ASC LIMIT 1
Completed 500 Internal Server Error in 150ms

NoMethodError (undefined method `signed_custom_fields=' for #<Payola::Sale:0x007fc91c829258>):
  activemodel (4.1.6) lib/active_model/attribute_methods.rb:435:in `method_missing'
  activerecord (4.1.6) lib/active_record/attribute_methods.rb:211:in `method_missing'
  /Users/peter/devel/payola/app/services/payola/create_sale.rb:14:in `block in call'
  activerecord (4.1.6) lib/active_record/core.rb:200:in `initialize'
  activerecord (4.1.6) lib/active_record/inheritance.rb:30:in `new'
  activerecord (4.1.6) lib/active_record/inheritance.rb:30:in `new'
  /Users/peter/devel/payola/app/services/payola/create_sale.rb:8:in `call'
  /Users/peter/devel/payola/app/controllers/payola/transactions_controller.rb:26:in `create'
  actionpack (4.1.6) lib/action_controller/metal/implicit_render.rb:4:in `send_action'
  actionpack (4.1.6) lib/abstract_controller/base.rb:189:in `process_action'
  actionpack (4.1.6) lib/action_controller/metal/rendering.rb:10:in `process_action'
  actionpack (4.1.6) lib/abstract_controller/callbacks.rb:20:in `block in process_action'
  activesupport (4.1.6) lib/active_support/callbacks.rb:113:in `call'
  activesupport (4.1.6) lib/active_support/callbacks.rb:113:in `call'
  activesupport (4.1.6) lib/active_support/callbacks.rb:149:in `block in halting_and_conditional'
  activesupport (4.1.6) lib/active_support/callbacks.rb:229:in `call'
  activesupport (4.1.6) lib/active_support/callbacks.rb:229:in `block in halting'
  activesupport (4.1.6) lib/active_support/callbacks.rb:166:in `call'
  activesupport (4.1.6) lib/active_support/callbacks.rb:166:in `block in halting'
  activesupport (4.1.6) lib/active_support/callbacks.rb:86:in `call'
  activesupport (4.1.6) lib/active_support/callbacks.rb:86:in `run_callbacks'
  actionpack (4.1.6) lib/abstract_controller/callbacks.rb:19:in `process_action'
  actionpack (4.1.6) lib/action_controller/metal/rescue.rb:29:in `process_action'
  actionpack (4.1.6) lib/action_controller/metal/instrumentation.rb:31:in `block in process_action'
  activesupport (4.1.6) lib/active_support/notifications.rb:159:in `block in instrument'
  activesupport (4.1.6) lib/active_support/notifications/instrumenter.rb:20:in `instrument'
  activesupport (4.1.6) lib/active_support/notifications.rb:159:in `instrument'
  actionpack (4.1.6) lib/action_controller/metal/instrumentation.rb:30:in `process_action'
  actionpack (4.1.6) lib/action_controller/metal/params_wrapper.rb:250:in `process_action'
  activerecord (4.1.6) lib/active_record/railties/controller_runtime.rb:18:in `process_action'
  actionpack (4.1.6) lib/abstract_controller/base.rb:136:in `process'
  actionview (4.1.6) lib/action_view/rendering.rb:30:in `process'
  actionpack (4.1.6) lib/action_controller/metal.rb:196:in `dispatch'
  actionpack (4.1.6) lib/action_controller/metal/rack_delegation.rb:13:in `dispatch'
  actionpack (4.1.6) lib/action_controller/metal.rb:232:in `block in action'
  actionpack (4.1.6) lib/action_dispatch/routing/route_set.rb:82:in `call'
  actionpack (4.1.6) lib/action_dispatch/routing/route_set.rb:82:in `dispatch'
  actionpack (4.1.6) lib/action_dispatch/routing/route_set.rb:50:in `call'
  actionpack (4.1.6) lib/action_dispatch/journey/router.rb:73:in `block in call'
  actionpack (4.1.6) lib/action_dispatch/journey/router.rb:59:in `each'
  actionpack (4.1.6) lib/action_dispatch/journey/router.rb:59:in `call'
  actionpack (4.1.6) lib/action_dispatch/routing/route_set.rb:678:in `call'
  railties (4.1.6) lib/rails/engine.rb:514:in `call'
  railties (4.1.6) lib/rails/railtie.rb:194:in `public_send'
  railties (4.1.6) lib/rails/railtie.rb:194:in `method_missing'
  actionpack (4.1.6) lib/action_dispatch/journey/router.rb:73:in `block in call'
  actionpack (4.1.6) lib/action_dispatch/journey/router.rb:59:in `each'
  actionpack (4.1.6) lib/action_dispatch/journey/router.rb:59:in `call'
  actionpack (4.1.6) lib/action_dispatch/routing/route_set.rb:678:in `call'
  rack (1.5.2) lib/rack/etag.rb:23:in `call'
  rack (1.5.2) lib/rack/conditionalget.rb:35:in `call'
  rack (1.5.2) lib/rack/head.rb:11:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/params_parser.rb:27:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/flash.rb:254:in `call'
  rack (1.5.2) lib/rack/session/abstract/id.rb:225:in `context'
  rack (1.5.2) lib/rack/session/abstract/id.rb:220:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/cookies.rb:560:in `call'
  activerecord (4.1.6) lib/active_record/query_cache.rb:36:in `call'
  activerecord (4.1.6) lib/active_record/connection_adapters/abstract/connection_pool.rb:621:in `call'
  activerecord (4.1.6) lib/active_record/migration.rb:380:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/callbacks.rb:29:in `block in call'
  activesupport (4.1.6) lib/active_support/callbacks.rb:82:in `run_callbacks'
  actionpack (4.1.6) lib/action_dispatch/middleware/callbacks.rb:27:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/reloader.rb:73:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/remote_ip.rb:76:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/debug_exceptions.rb:17:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/show_exceptions.rb:30:in `call'
  railties (4.1.6) lib/rails/rack/logger.rb:38:in `call_app'
  railties (4.1.6) lib/rails/rack/logger.rb:20:in `block in call'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:68:in `block in tagged'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:26:in `tagged'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:68:in `tagged'
  railties (4.1.6) lib/rails/rack/logger.rb:20:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/request_id.rb:21:in `call'
  rack (1.5.2) lib/rack/methodoverride.rb:21:in `call'
  rack (1.5.2) lib/rack/runtime.rb:17:in `call'
  activesupport (4.1.6) lib/active_support/cache/strategy/local_cache_middleware.rb:26:in `call'
  rack (1.5.2) lib/rack/lock.rb:17:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/static.rb:64:in `call'
  rack (1.5.2) lib/rack/sendfile.rb:112:in `call'
  railties (4.1.6) lib/rails/engine.rb:514:in `call'
  railties (4.1.6) lib/rails/application.rb:144:in `call'
  rack (1.5.2) lib/rack/lock.rb:17:in `call'
  rack (1.5.2) lib/rack/content_length.rb:14:in `call'
  rack (1.5.2) lib/rack/handler/webrick.rb:60:in `service'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/httpserver.rb:138:in `service'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/httpserver.rb:94:in `run'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/server.rb:191:in `block in start_thread'


  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_source.erb (0.4ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (1.4ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (0.9ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/diagnostics.erb within rescues/layout (56.4ms)


Started GET "/buy" for 127.0.0.1 at 2014-10-28 14:48:59 -0400
Processing by BuyController#index as HTML
  [1m[36mProduct Load (0.3ms)[0m  [1mSELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1[0m
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_checkout.html.erb (2.9ms)
  Rendered buy/index.html.erb within layouts/application (4.5ms)
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_stripe_header.html.erb (0.1ms)
Completed 200 OK in 150ms (Views: 148.2ms | ActiveRecord: 0.3ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-10-28 14:48:59 -0400


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-10-28 14:48:59 -0400


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-10-28 14:48:59 -0400


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-10-28 14:48:59 -0400


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-10-28 14:48:59 -0400


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-10-28 14:48:59 -0400


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-10-28 14:48:59 -0400


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-10-28 14:48:59 -0400


Started GET "/buy" for 127.0.0.1 at 2014-10-28 14:49:12 -0400
Processing by BuyController#index as HTML
  [1m[35mProduct Load (0.2ms)[0m  SELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_checkout.html.erb (2.6ms)
  Rendered buy/index.html.erb within layouts/application (3.9ms)
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_stripe_header.html.erb (0.0ms)
Completed 200 OK in 107ms (Views: 106.3ms | ActiveRecord: 0.2ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-10-28 14:49:12 -0400


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-10-28 14:49:12 -0400


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-10-28 14:49:12 -0400


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-10-28 14:49:12 -0400


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-10-28 14:49:12 -0400


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-10-28 14:49:12 -0400


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-10-28 14:49:12 -0400


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-10-28 14:49:12 -0400


Started POST "/subdir/payola/buy/product/foo" for 127.0.0.1 at 2014-10-28 14:49:14 -0400
Processing by Payola::TransactionsController#create as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"2IuIJThdxsedZZm+4RNkPb6BrXTjLdCWKYgcutw62cE=", "product_class"=>"product", "permalink"=>"foo"}
  [1m[36mProduct Load (0.2ms)[0m  [1mSELECT  "products".* FROM "products"  WHERE "products"."permalink" = 'foo' LIMIT 1[0m
  [1m[35mPayola::Coupon Load (0.2ms)[0m  SELECT  "payola_coupons".* FROM "payola_coupons"  WHERE (lower(code) = lower(NULL))  ORDER BY "payola_coupons"."id" ASC LIMIT 1
  [1m[36mPayola::Affiliate Load (0.1ms)[0m  [1mSELECT  "payola_affiliates".* FROM "payola_affiliates"  WHERE (lower(code) = lower(NULL))  ORDER BY "payola_affiliates"."id" ASC LIMIT 1[0m
Completed 500 Internal Server Error in 82ms

NoMethodError (undefined method `signed_custom_fields=' for #<Payola::Sale:0x007fc91c9dbf10>):
  activemodel (4.1.6) lib/active_model/attribute_methods.rb:435:in `method_missing'
  activerecord (4.1.6) lib/active_record/attribute_methods.rb:211:in `method_missing'
  /Users/peter/devel/payola/app/services/payola/create_sale.rb:14:in `block in call'
  activerecord (4.1.6) lib/active_record/core.rb:200:in `initialize'
  activerecord (4.1.6) lib/active_record/inheritance.rb:30:in `new'
  activerecord (4.1.6) lib/active_record/inheritance.rb:30:in `new'
  /Users/peter/devel/payola/app/services/payola/create_sale.rb:8:in `call'
  /Users/peter/devel/payola/app/controllers/payola/transactions_controller.rb:26:in `create'
  actionpack (4.1.6) lib/action_controller/metal/implicit_render.rb:4:in `send_action'
  actionpack (4.1.6) lib/abstract_controller/base.rb:189:in `process_action'
  actionpack (4.1.6) lib/action_controller/metal/rendering.rb:10:in `process_action'
  actionpack (4.1.6) lib/abstract_controller/callbacks.rb:20:in `block in process_action'
  activesupport (4.1.6) lib/active_support/callbacks.rb:113:in `call'
  activesupport (4.1.6) lib/active_support/callbacks.rb:113:in `call'
  activesupport (4.1.6) lib/active_support/callbacks.rb:149:in `block in halting_and_conditional'
  activesupport (4.1.6) lib/active_support/callbacks.rb:229:in `call'
  activesupport (4.1.6) lib/active_support/callbacks.rb:229:in `block in halting'
  activesupport (4.1.6) lib/active_support/callbacks.rb:166:in `call'
  activesupport (4.1.6) lib/active_support/callbacks.rb:166:in `block in halting'
  activesupport (4.1.6) lib/active_support/callbacks.rb:86:in `call'
  activesupport (4.1.6) lib/active_support/callbacks.rb:86:in `run_callbacks'
  actionpack (4.1.6) lib/abstract_controller/callbacks.rb:19:in `process_action'
  actionpack (4.1.6) lib/action_controller/metal/rescue.rb:29:in `process_action'
  actionpack (4.1.6) lib/action_controller/metal/instrumentation.rb:31:in `block in process_action'
  activesupport (4.1.6) lib/active_support/notifications.rb:159:in `block in instrument'
  activesupport (4.1.6) lib/active_support/notifications/instrumenter.rb:20:in `instrument'
  activesupport (4.1.6) lib/active_support/notifications.rb:159:in `instrument'
  actionpack (4.1.6) lib/action_controller/metal/instrumentation.rb:30:in `process_action'
  actionpack (4.1.6) lib/action_controller/metal/params_wrapper.rb:250:in `process_action'
  activerecord (4.1.6) lib/active_record/railties/controller_runtime.rb:18:in `process_action'
  actionpack (4.1.6) lib/abstract_controller/base.rb:136:in `process'
  actionview (4.1.6) lib/action_view/rendering.rb:30:in `process'
  actionpack (4.1.6) lib/action_controller/metal.rb:196:in `dispatch'
  actionpack (4.1.6) lib/action_controller/metal/rack_delegation.rb:13:in `dispatch'
  actionpack (4.1.6) lib/action_controller/metal.rb:232:in `block in action'
  actionpack (4.1.6) lib/action_dispatch/routing/route_set.rb:82:in `call'
  actionpack (4.1.6) lib/action_dispatch/routing/route_set.rb:82:in `dispatch'
  actionpack (4.1.6) lib/action_dispatch/routing/route_set.rb:50:in `call'
  actionpack (4.1.6) lib/action_dispatch/journey/router.rb:73:in `block in call'
  actionpack (4.1.6) lib/action_dispatch/journey/router.rb:59:in `each'
  actionpack (4.1.6) lib/action_dispatch/journey/router.rb:59:in `call'
  actionpack (4.1.6) lib/action_dispatch/routing/route_set.rb:678:in `call'
  railties (4.1.6) lib/rails/engine.rb:514:in `call'
  railties (4.1.6) lib/rails/railtie.rb:194:in `public_send'
  railties (4.1.6) lib/rails/railtie.rb:194:in `method_missing'
  actionpack (4.1.6) lib/action_dispatch/journey/router.rb:73:in `block in call'
  actionpack (4.1.6) lib/action_dispatch/journey/router.rb:59:in `each'
  actionpack (4.1.6) lib/action_dispatch/journey/router.rb:59:in `call'
  actionpack (4.1.6) lib/action_dispatch/routing/route_set.rb:678:in `call'
  rack (1.5.2) lib/rack/etag.rb:23:in `call'
  rack (1.5.2) lib/rack/conditionalget.rb:35:in `call'
  rack (1.5.2) lib/rack/head.rb:11:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/params_parser.rb:27:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/flash.rb:254:in `call'
  rack (1.5.2) lib/rack/session/abstract/id.rb:225:in `context'
  rack (1.5.2) lib/rack/session/abstract/id.rb:220:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/cookies.rb:560:in `call'
  activerecord (4.1.6) lib/active_record/query_cache.rb:36:in `call'
  activerecord (4.1.6) lib/active_record/connection_adapters/abstract/connection_pool.rb:621:in `call'
  activerecord (4.1.6) lib/active_record/migration.rb:380:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/callbacks.rb:29:in `block in call'
  activesupport (4.1.6) lib/active_support/callbacks.rb:82:in `run_callbacks'
  actionpack (4.1.6) lib/action_dispatch/middleware/callbacks.rb:27:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/reloader.rb:73:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/remote_ip.rb:76:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/debug_exceptions.rb:17:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/show_exceptions.rb:30:in `call'
  railties (4.1.6) lib/rails/rack/logger.rb:38:in `call_app'
  railties (4.1.6) lib/rails/rack/logger.rb:20:in `block in call'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:68:in `block in tagged'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:26:in `tagged'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:68:in `tagged'
  railties (4.1.6) lib/rails/rack/logger.rb:20:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/request_id.rb:21:in `call'
  rack (1.5.2) lib/rack/methodoverride.rb:21:in `call'
  rack (1.5.2) lib/rack/runtime.rb:17:in `call'
  activesupport (4.1.6) lib/active_support/cache/strategy/local_cache_middleware.rb:26:in `call'
  rack (1.5.2) lib/rack/lock.rb:17:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/static.rb:64:in `call'
  rack (1.5.2) lib/rack/sendfile.rb:112:in `call'
  railties (4.1.6) lib/rails/engine.rb:514:in `call'
  railties (4.1.6) lib/rails/application.rb:144:in `call'
  rack (1.5.2) lib/rack/lock.rb:17:in `call'
  rack (1.5.2) lib/rack/content_length.rb:14:in `call'
  rack (1.5.2) lib/rack/handler/webrick.rb:60:in `service'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/httpserver.rb:138:in `service'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/httpserver.rb:94:in `run'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/server.rb:191:in `block in start_thread'


  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_source.erb (0.6ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (1.0ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (0.8ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/diagnostics.erb within rescues/layout (45.6ms)


Started POST "/subdir/payola/buy/product/foo" for 127.0.0.1 at 2014-10-28 14:49:22 -0400
Processing by Payola::TransactionsController#create as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"2IuIJThdxsedZZm+4RNkPb6BrXTjLdCWKYgcutw62cE=", "product_class"=>"product", "permalink"=>"foo"}
  [1m[35mProduct Load (0.2ms)[0m  SELECT  "products".* FROM "products"  WHERE "products"."permalink" = 'foo' LIMIT 1
  [1m[36mPayola::Coupon Load (0.1ms)[0m  [1mSELECT  "payola_coupons".* FROM "payola_coupons"  WHERE (lower(code) = lower(NULL))  ORDER BY "payola_coupons"."id" ASC LIMIT 1[0m
  [1m[35mPayola::Affiliate Load (0.2ms)[0m  SELECT  "payola_affiliates".* FROM "payola_affiliates"  WHERE (lower(code) = lower(NULL))  ORDER BY "payola_affiliates"."id" ASC LIMIT 1
Completed 500 Internal Server Error in 106ms

NoMethodError (undefined method `signed_custom_fields=' for #<Payola::Sale:0x007fc91c966d00>):
  activemodel (4.1.6) lib/active_model/attribute_methods.rb:435:in `method_missing'
  activerecord (4.1.6) lib/active_record/attribute_methods.rb:211:in `method_missing'
  /Users/peter/devel/payola/app/services/payola/create_sale.rb:14:in `block in call'
  activerecord (4.1.6) lib/active_record/core.rb:200:in `initialize'
  activerecord (4.1.6) lib/active_record/inheritance.rb:30:in `new'
  activerecord (4.1.6) lib/active_record/inheritance.rb:30:in `new'
  /Users/peter/devel/payola/app/services/payola/create_sale.rb:8:in `call'
  /Users/peter/devel/payola/app/controllers/payola/transactions_controller.rb:26:in `create'
  actionpack (4.1.6) lib/action_controller/metal/implicit_render.rb:4:in `send_action'
  actionpack (4.1.6) lib/abstract_controller/base.rb:189:in `process_action'
  actionpack (4.1.6) lib/action_controller/metal/rendering.rb:10:in `process_action'
  actionpack (4.1.6) lib/abstract_controller/callbacks.rb:20:in `block in process_action'
  activesupport (4.1.6) lib/active_support/callbacks.rb:113:in `call'
  activesupport (4.1.6) lib/active_support/callbacks.rb:113:in `call'
  activesupport (4.1.6) lib/active_support/callbacks.rb:149:in `block in halting_and_conditional'
  activesupport (4.1.6) lib/active_support/callbacks.rb:229:in `call'
  activesupport (4.1.6) lib/active_support/callbacks.rb:229:in `block in halting'
  activesupport (4.1.6) lib/active_support/callbacks.rb:166:in `call'
  activesupport (4.1.6) lib/active_support/callbacks.rb:166:in `block in halting'
  activesupport (4.1.6) lib/active_support/callbacks.rb:86:in `call'
  activesupport (4.1.6) lib/active_support/callbacks.rb:86:in `run_callbacks'
  actionpack (4.1.6) lib/abstract_controller/callbacks.rb:19:in `process_action'
  actionpack (4.1.6) lib/action_controller/metal/rescue.rb:29:in `process_action'
  actionpack (4.1.6) lib/action_controller/metal/instrumentation.rb:31:in `block in process_action'
  activesupport (4.1.6) lib/active_support/notifications.rb:159:in `block in instrument'
  activesupport (4.1.6) lib/active_support/notifications/instrumenter.rb:20:in `instrument'
  activesupport (4.1.6) lib/active_support/notifications.rb:159:in `instrument'
  actionpack (4.1.6) lib/action_controller/metal/instrumentation.rb:30:in `process_action'
  actionpack (4.1.6) lib/action_controller/metal/params_wrapper.rb:250:in `process_action'
  activerecord (4.1.6) lib/active_record/railties/controller_runtime.rb:18:in `process_action'
  actionpack (4.1.6) lib/abstract_controller/base.rb:136:in `process'
  actionview (4.1.6) lib/action_view/rendering.rb:30:in `process'
  actionpack (4.1.6) lib/action_controller/metal.rb:196:in `dispatch'
  actionpack (4.1.6) lib/action_controller/metal/rack_delegation.rb:13:in `dispatch'
  actionpack (4.1.6) lib/action_controller/metal.rb:232:in `block in action'
  actionpack (4.1.6) lib/action_dispatch/routing/route_set.rb:82:in `call'
  actionpack (4.1.6) lib/action_dispatch/routing/route_set.rb:82:in `dispatch'
  actionpack (4.1.6) lib/action_dispatch/routing/route_set.rb:50:in `call'
  actionpack (4.1.6) lib/action_dispatch/journey/router.rb:73:in `block in call'
  actionpack (4.1.6) lib/action_dispatch/journey/router.rb:59:in `each'
  actionpack (4.1.6) lib/action_dispatch/journey/router.rb:59:in `call'
  actionpack (4.1.6) lib/action_dispatch/routing/route_set.rb:678:in `call'
  railties (4.1.6) lib/rails/engine.rb:514:in `call'
  railties (4.1.6) lib/rails/railtie.rb:194:in `public_send'
  railties (4.1.6) lib/rails/railtie.rb:194:in `method_missing'
  actionpack (4.1.6) lib/action_dispatch/journey/router.rb:73:in `block in call'
  actionpack (4.1.6) lib/action_dispatch/journey/router.rb:59:in `each'
  actionpack (4.1.6) lib/action_dispatch/journey/router.rb:59:in `call'
  actionpack (4.1.6) lib/action_dispatch/routing/route_set.rb:678:in `call'
  rack (1.5.2) lib/rack/etag.rb:23:in `call'
  rack (1.5.2) lib/rack/conditionalget.rb:35:in `call'
  rack (1.5.2) lib/rack/head.rb:11:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/params_parser.rb:27:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/flash.rb:254:in `call'
  rack (1.5.2) lib/rack/session/abstract/id.rb:225:in `context'
  rack (1.5.2) lib/rack/session/abstract/id.rb:220:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/cookies.rb:560:in `call'
  activerecord (4.1.6) lib/active_record/query_cache.rb:36:in `call'
  activerecord (4.1.6) lib/active_record/connection_adapters/abstract/connection_pool.rb:621:in `call'
  activerecord (4.1.6) lib/active_record/migration.rb:380:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/callbacks.rb:29:in `block in call'
  activesupport (4.1.6) lib/active_support/callbacks.rb:82:in `run_callbacks'
  actionpack (4.1.6) lib/action_dispatch/middleware/callbacks.rb:27:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/reloader.rb:73:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/remote_ip.rb:76:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/debug_exceptions.rb:17:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/show_exceptions.rb:30:in `call'
  railties (4.1.6) lib/rails/rack/logger.rb:38:in `call_app'
  railties (4.1.6) lib/rails/rack/logger.rb:20:in `block in call'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:68:in `block in tagged'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:26:in `tagged'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:68:in `tagged'
  railties (4.1.6) lib/rails/rack/logger.rb:20:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/request_id.rb:21:in `call'
  rack (1.5.2) lib/rack/methodoverride.rb:21:in `call'
  rack (1.5.2) lib/rack/runtime.rb:17:in `call'
  activesupport (4.1.6) lib/active_support/cache/strategy/local_cache_middleware.rb:26:in `call'
  rack (1.5.2) lib/rack/lock.rb:17:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/static.rb:64:in `call'
  rack (1.5.2) lib/rack/sendfile.rb:112:in `call'
  railties (4.1.6) lib/rails/engine.rb:514:in `call'
  railties (4.1.6) lib/rails/application.rb:144:in `call'
  rack (1.5.2) lib/rack/lock.rb:17:in `call'
  rack (1.5.2) lib/rack/content_length.rb:14:in `call'
  rack (1.5.2) lib/rack/handler/webrick.rb:60:in `service'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/httpserver.rb:138:in `service'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/httpserver.rb:94:in `run'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/server.rb:191:in `block in start_thread'


  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_source.erb (0.5ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (1.0ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (0.9ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/diagnostics.erb within rescues/layout (46.2ms)


Started GET "/buy" for 127.0.0.1 at 2014-10-28 14:49:32 -0400
Processing by BuyController#index as HTML
  [1m[36mProduct Load (0.2ms)[0m  [1mSELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1[0m
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_checkout.html.erb (6.4ms)
  Rendered buy/index.html.erb within layouts/application (7.7ms)
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_stripe_header.html.erb (0.1ms)
Completed 200 OK in 167ms (Views: 165.2ms | ActiveRecord: 0.2ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-10-28 14:49:33 -0400


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-10-28 14:49:33 -0400


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-10-28 14:49:33 -0400


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-10-28 14:49:33 -0400


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-10-28 14:49:33 -0400


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-10-28 14:49:33 -0400


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-10-28 14:49:33 -0400


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-10-28 14:49:33 -0400


Started GET "/buy" for 127.0.0.1 at 2014-10-28 14:50:17 -0400
Processing by BuyController#index as HTML
  [1m[35mProduct Load (0.3ms)[0m  SELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_checkout.html.erb (3.2ms)
  Rendered buy/index.html.erb within layouts/application (4.8ms)
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_stripe_header.html.erb (0.0ms)
Completed 200 OK in 104ms (Views: 102.2ms | ActiveRecord: 0.3ms)


Started GET "/buy" for 127.0.0.1 at 2014-10-28 14:50:20 -0400
Processing by BuyController#index as HTML
  [1m[36mProduct Load (0.2ms)[0m  [1mSELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1[0m
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_checkout.html.erb (1.8ms)
  Rendered buy/index.html.erb within layouts/application (3.0ms)
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_stripe_header.html.erb (0.0ms)
Completed 200 OK in 133ms (Views: 132.5ms | ActiveRecord: 0.2ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-10-28 14:50:20 -0400


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-10-28 14:50:20 -0400


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-10-28 14:50:20 -0400


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-10-28 14:50:21 -0400


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-10-28 14:50:21 -0400


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-10-28 14:50:21 -0400


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-10-28 14:50:21 -0400


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-10-28 14:50:21 -0400


Started GET "/buy" for 127.0.0.1 at 2014-10-28 14:51:46 -0400
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Processing by BuyController#index as HTML
  [1m[35mProduct Load (0.2ms)[0m  SELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_checkout.html.erb (106.9ms)
  Rendered buy/index.html.erb within layouts/application (113.6ms)
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_stripe_header.html.erb (0.4ms)
Completed 200 OK in 249ms (Views: 202.6ms | ActiveRecord: 1.1ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-10-28 14:51:47 -0400


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-10-28 14:51:47 -0400


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-10-28 14:51:47 -0400


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-10-28 14:51:47 -0400


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-10-28 14:51:47 -0400


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-10-28 14:51:47 -0400


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-10-28 14:51:47 -0400


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-10-28 14:51:47 -0400


Started POST "/subdir/payola/buy/product/foo" for 127.0.0.1 at 2014-10-28 14:52:04 -0400
Processing by Payola::TransactionsController#create as */*
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"2IuIJThdxsedZZm+4RNkPb6BrXTjLdCWKYgcutw62cE=", "stripeToken"=>"tok_52kZBVNHVMDeDL", "stripeEmail"=>"test@example.com", "product_class"=>"product", "permalink"=>"foo"}
  [1m[36mProduct Load (0.2ms)[0m  [1mSELECT  "products".* FROM "products"  WHERE "products"."permalink" = 'foo' LIMIT 1[0m
  [1m[35mPayola::Coupon Load (0.1ms)[0m  SELECT  "payola_coupons".* FROM "payola_coupons"  WHERE (lower(code) = lower(NULL))  ORDER BY "payola_coupons"."id" ASC LIMIT 1
  [1m[36mPayola::Affiliate Load (0.4ms)[0m  [1mSELECT  "payola_affiliates".* FROM "payola_affiliates"  WHERE (lower(code) = lower(NULL))  ORDER BY "payola_affiliates"."id" ASC LIMIT 1[0m
Completed 500 Internal Server Error in 141ms

NoMethodError (undefined method `signed_custom_fields=' for #<Payola::Sale:0x007fe08f7e4358>):
  activemodel (4.1.6) lib/active_model/attribute_methods.rb:435:in `method_missing'
  activerecord (4.1.6) lib/active_record/attribute_methods.rb:211:in `method_missing'
  /Users/peter/devel/payola/app/services/payola/create_sale.rb:14:in `block in call'
  activerecord (4.1.6) lib/active_record/core.rb:200:in `initialize'
  activerecord (4.1.6) lib/active_record/inheritance.rb:30:in `new'
  activerecord (4.1.6) lib/active_record/inheritance.rb:30:in `new'
  /Users/peter/devel/payola/app/services/payola/create_sale.rb:8:in `call'
  /Users/peter/devel/payola/app/controllers/payola/transactions_controller.rb:26:in `create'
  actionpack (4.1.6) lib/action_controller/metal/implicit_render.rb:4:in `send_action'
  actionpack (4.1.6) lib/abstract_controller/base.rb:189:in `process_action'
  actionpack (4.1.6) lib/action_controller/metal/rendering.rb:10:in `process_action'
  actionpack (4.1.6) lib/abstract_controller/callbacks.rb:20:in `block in process_action'
  activesupport (4.1.6) lib/active_support/callbacks.rb:113:in `call'
  activesupport (4.1.6) lib/active_support/callbacks.rb:113:in `call'
  activesupport (4.1.6) lib/active_support/callbacks.rb:149:in `block in halting_and_conditional'
  activesupport (4.1.6) lib/active_support/callbacks.rb:229:in `call'
  activesupport (4.1.6) lib/active_support/callbacks.rb:229:in `block in halting'
  activesupport (4.1.6) lib/active_support/callbacks.rb:166:in `call'
  activesupport (4.1.6) lib/active_support/callbacks.rb:166:in `block in halting'
  activesupport (4.1.6) lib/active_support/callbacks.rb:86:in `call'
  activesupport (4.1.6) lib/active_support/callbacks.rb:86:in `run_callbacks'
  actionpack (4.1.6) lib/abstract_controller/callbacks.rb:19:in `process_action'
  actionpack (4.1.6) lib/action_controller/metal/rescue.rb:29:in `process_action'
  actionpack (4.1.6) lib/action_controller/metal/instrumentation.rb:31:in `block in process_action'
  activesupport (4.1.6) lib/active_support/notifications.rb:159:in `block in instrument'
  activesupport (4.1.6) lib/active_support/notifications/instrumenter.rb:20:in `instrument'
  activesupport (4.1.6) lib/active_support/notifications.rb:159:in `instrument'
  actionpack (4.1.6) lib/action_controller/metal/instrumentation.rb:30:in `process_action'
  actionpack (4.1.6) lib/action_controller/metal/params_wrapper.rb:250:in `process_action'
  activerecord (4.1.6) lib/active_record/railties/controller_runtime.rb:18:in `process_action'
  actionpack (4.1.6) lib/abstract_controller/base.rb:136:in `process'
  actionview (4.1.6) lib/action_view/rendering.rb:30:in `process'
  actionpack (4.1.6) lib/action_controller/metal.rb:196:in `dispatch'
  actionpack (4.1.6) lib/action_controller/metal/rack_delegation.rb:13:in `dispatch'
  actionpack (4.1.6) lib/action_controller/metal.rb:232:in `block in action'
  actionpack (4.1.6) lib/action_dispatch/routing/route_set.rb:82:in `call'
  actionpack (4.1.6) lib/action_dispatch/routing/route_set.rb:82:in `dispatch'
  actionpack (4.1.6) lib/action_dispatch/routing/route_set.rb:50:in `call'
  actionpack (4.1.6) lib/action_dispatch/journey/router.rb:73:in `block in call'
  actionpack (4.1.6) lib/action_dispatch/journey/router.rb:59:in `each'
  actionpack (4.1.6) lib/action_dispatch/journey/router.rb:59:in `call'
  actionpack (4.1.6) lib/action_dispatch/routing/route_set.rb:678:in `call'
  railties (4.1.6) lib/rails/engine.rb:514:in `call'
  railties (4.1.6) lib/rails/railtie.rb:194:in `public_send'
  railties (4.1.6) lib/rails/railtie.rb:194:in `method_missing'
  actionpack (4.1.6) lib/action_dispatch/journey/router.rb:73:in `block in call'
  actionpack (4.1.6) lib/action_dispatch/journey/router.rb:59:in `each'
  actionpack (4.1.6) lib/action_dispatch/journey/router.rb:59:in `call'
  actionpack (4.1.6) lib/action_dispatch/routing/route_set.rb:678:in `call'
  rack (1.5.2) lib/rack/etag.rb:23:in `call'
  rack (1.5.2) lib/rack/conditionalget.rb:35:in `call'
  rack (1.5.2) lib/rack/head.rb:11:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/params_parser.rb:27:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/flash.rb:254:in `call'
  rack (1.5.2) lib/rack/session/abstract/id.rb:225:in `context'
  rack (1.5.2) lib/rack/session/abstract/id.rb:220:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/cookies.rb:560:in `call'
  activerecord (4.1.6) lib/active_record/query_cache.rb:36:in `call'
  activerecord (4.1.6) lib/active_record/connection_adapters/abstract/connection_pool.rb:621:in `call'
  activerecord (4.1.6) lib/active_record/migration.rb:380:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/callbacks.rb:29:in `block in call'
  activesupport (4.1.6) lib/active_support/callbacks.rb:82:in `run_callbacks'
  actionpack (4.1.6) lib/action_dispatch/middleware/callbacks.rb:27:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/reloader.rb:73:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/remote_ip.rb:76:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/debug_exceptions.rb:17:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/show_exceptions.rb:30:in `call'
  railties (4.1.6) lib/rails/rack/logger.rb:38:in `call_app'
  railties (4.1.6) lib/rails/rack/logger.rb:20:in `block in call'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:68:in `block in tagged'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:26:in `tagged'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:68:in `tagged'
  railties (4.1.6) lib/rails/rack/logger.rb:20:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/request_id.rb:21:in `call'
  rack (1.5.2) lib/rack/methodoverride.rb:21:in `call'
  rack (1.5.2) lib/rack/runtime.rb:17:in `call'
  activesupport (4.1.6) lib/active_support/cache/strategy/local_cache_middleware.rb:26:in `call'
  rack (1.5.2) lib/rack/lock.rb:17:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/static.rb:64:in `call'
  rack (1.5.2) lib/rack/sendfile.rb:112:in `call'
  railties (4.1.6) lib/rails/engine.rb:514:in `call'
  railties (4.1.6) lib/rails/application.rb:144:in `call'
  rack (1.5.2) lib/rack/lock.rb:17:in `call'
  rack (1.5.2) lib/rack/content_length.rb:14:in `call'
  rack (1.5.2) lib/rack/handler/webrick.rb:60:in `service'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/httpserver.rb:138:in `service'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/httpserver.rb:94:in `run'
  /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/1.9.1/webrick/server.rb:191:in `block in start_thread'


  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_source.erb (0.4ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_trace.text.erb (0.5ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_request_and_response.text.erb (0.6ms)
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/diagnostics.erb (49.5ms)
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.1ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (0.2ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_stripe_customer_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_stripe_customer_id' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_product' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_product' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_guid' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_guid' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_email' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'
[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Migrating to AddCustomFieldsToPayolaSale (20141026101628)
  [1m[35m (0.2ms)[0m  begin transaction
  [1m[36m (0.7ms)[0m  [1mALTER TABLE "payola_sales" ADD "custom_fields" text[0m
  [1m[35mSQL (0.6ms)[0m  INSERT INTO "schema_migrations" ("version") VALUES (?)  [["version", "20141026101628"]]
  [1m[36m (2.9ms)[0m  [1mcommit transaction[0m
Migrating to RenameCustomFieldsToSignedCustomFieldsOnPayolaSale (20141026144800)
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (1.0ms)[0m  [1mCREATE TEMPORARY TABLE "apayola_sales" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar(255), "guid" varchar(255), "product_id" integer, "product_type" varchar(255), "created_at" datetime, "updated_at" datetime, "state" varchar(255), "stripe_id" varchar(255), "stripe_token" varchar(255), "card_last4" varchar(255), "card_expiration" date, "card_type" varchar(255), "error" text, "amount" integer, "fee_amount" integer, "coupon_id" integer, "opt_in" boolean, "download_count" integer, "affiliate_id" integer, "customer_address" text, "business_address" text, "stripe_customer_id" varchar(255), "currency" varchar(255), "signed_custom_fields" text) [0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_stripe_customer_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_stripe_customer_id' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_product' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_product' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_guid' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_guid' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_email' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'

  [1m[36m (0.0ms)[0m  [1mselect sqlite_version(*)[0m
  [1m[35m (0.1ms)[0m  CREATE  INDEX "tindex_apayola_sales_on_stripe_customer_id" ON "apayola_sales" ("stripe_customer_id")
  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='tindex_apayola_sales_on_stripe_customer_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='tindex_apayola_sales_on_stripe_customer_id' AND type='index'
[0m
  [1m[35m (0.1ms)[0m  CREATE  INDEX "tindex_apayola_sales_on_product" ON "apayola_sales" ("product_id", "product_type")
  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='tindex_apayola_sales_on_product' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='tindex_apayola_sales_on_product' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='tindex_apayola_sales_on_stripe_customer_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='tindex_apayola_sales_on_stripe_customer_id' AND type='index'

  [1m[36m (0.1ms)[0m  [1mCREATE  INDEX "tindex_apayola_sales_on_guid" ON "apayola_sales" ("guid")[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='tindex_apayola_sales_on_guid' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='tindex_apayola_sales_on_guid' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='tindex_apayola_sales_on_product' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='tindex_apayola_sales_on_product' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='tindex_apayola_sales_on_stripe_customer_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='tindex_apayola_sales_on_stripe_customer_id' AND type='index'

  [1m[36m (0.1ms)[0m  [1mCREATE  INDEX "tindex_apayola_sales_on_email" ON "apayola_sales" ("email")[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='tindex_apayola_sales_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='tindex_apayola_sales_on_email' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='tindex_apayola_sales_on_guid' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='tindex_apayola_sales_on_guid' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='tindex_apayola_sales_on_product' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='tindex_apayola_sales_on_product' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='tindex_apayola_sales_on_stripe_customer_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='tindex_apayola_sales_on_stripe_customer_id' AND type='index'
[0m
  [1m[35m (0.1ms)[0m  CREATE  INDEX "tindex_apayola_sales_on_coupon_id" ON "apayola_sales" ("coupon_id")
  [1m[36m (0.3ms)[0m  [1mSELECT * FROM "payola_sales"[0m
  [1m[35m (0.2ms)[0m  INSERT INTO "apayola_sales" ("id","email","guid","product_id","product_type","created_at","updated_at","state","stripe_id","stripe_token","card_last4","card_expiration","card_type","error","amount","fee_amount","coupon_id","opt_in","download_count","affiliate_id","customer_address","business_address","stripe_customer_id","currency","signed_custom_fields") VALUES (1, 'pete@bugsplat.info', '1v2hth', 1, 'Product', '2014-10-24 20:50:28.064239', '2014-10-24 20:50:30.964672', 'finished', 'ch_14rF0zDpyMZVJxV9h51YbGRx', 'tok_14rF0xDpyMZVJxV9zgP97t6C', '4242', '2034-12-01', 'Visa', NULL, 100, 33, NULL, NULL, NULL, NULL, NULL, NULL, 'cus_51HaSWCD64X7ii', 'usd', NULL)
  [1m[36m (0.1ms)[0m  [1mINSERT INTO "apayola_sales" ("id","email","guid","product_id","product_type","created_at","updated_at","state","stripe_id","stripe_token","card_last4","card_expiration","card_type","error","amount","fee_amount","coupon_id","opt_in","download_count","affiliate_id","customer_address","business_address","stripe_customer_id","currency","signed_custom_fields") VALUES (2, 'pete@bugsplat.info', 'c6jbbp', 1, 'Product', '2014-10-24 20:51:08.133946', '2014-10-24 20:51:10.511057', 'finished', 'ch_14rF1dDpyMZVJxV9CmaAzs8b', 'tok_14rF1bDpyMZVJxV9C5GT9wMk', '4242', '2034-12-01', 'Visa', NULL, 100, 33, NULL, NULL, NULL, NULL, NULL, NULL, 'cus_51Haa02oV95sKB', 'usd', NULL)[0m
  [1m[35m (0.1ms)[0m  INSERT INTO "apayola_sales" ("id","email","guid","product_id","product_type","created_at","updated_at","state","stripe_id","stripe_token","card_last4","card_expiration","card_type","error","amount","fee_amount","coupon_id","opt_in","download_count","affiliate_id","customer_address","business_address","stripe_customer_id","currency","signed_custom_fields") VALUES (3, 'pete@bugsplat.info', 'fmd7nk', 1, 'Product', '2014-10-24 20:53:42.156020', '2014-10-24 20:53:44.712072', 'finished', 'ch_14rF47DpyMZVJxV911dIpIYX', 'tok_14rF45DpyMZVJxV9aT7V54TK', '4242', '2034-12-01', 'Visa', NULL, 100, 33, NULL, NULL, NULL, NULL, NULL, NULL, 'cus_51HdNSPn0zJj4Q', 'usd', NULL)
  [1m[36m (1.9ms)[0m  [1mDROP TABLE "payola_sales"[0m
  [1m[35m (0.2ms)[0m  CREATE TABLE "payola_sales" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar(255), "guid" varchar(255), "product_id" integer, "product_type" varchar(255), "created_at" datetime, "updated_at" datetime, "state" varchar(255), "stripe_id" varchar(255), "stripe_token" varchar(255), "card_last4" varchar(255), "card_expiration" date, "card_type" varchar(255), "error" text, "amount" integer, "fee_amount" integer, "coupon_id" integer, "opt_in" boolean, "download_count" integer, "affiliate_id" integer, "customer_address" text, "business_address" text, "stripe_customer_id" varchar(255), "currency" varchar(255), "signed_custom_fields" text) 
  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='tindex_apayola_sales_on_coupon_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='tindex_apayola_sales_on_coupon_id' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='tindex_apayola_sales_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='tindex_apayola_sales_on_email' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='tindex_apayola_sales_on_guid' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='tindex_apayola_sales_on_guid' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='tindex_apayola_sales_on_product' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='tindex_apayola_sales_on_product' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='tindex_apayola_sales_on_stripe_customer_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='tindex_apayola_sales_on_stripe_customer_id' AND type='index'
[0m
  [1m[35m (0.1ms)[0m  CREATE  INDEX "index_payola_sales_on_coupon_id" ON "payola_sales" ("coupon_id")
  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'
[0m
  [1m[35m (0.1ms)[0m  CREATE  INDEX "index_payola_sales_on_email" ON "payola_sales" ("email")
  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_email' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'

  [1m[36m (0.1ms)[0m  [1mCREATE  INDEX "index_payola_sales_on_guid" ON "payola_sales" ("guid")[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_guid' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_guid' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_email' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'

  [1m[36m (0.1ms)[0m  [1mCREATE  INDEX "index_payola_sales_on_product" ON "payola_sales" ("product_id", "product_type")[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_product' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_product' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_guid' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_guid' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_email' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'
[0m
  [1m[35m (0.1ms)[0m  CREATE  INDEX "index_payola_sales_on_stripe_customer_id" ON "payola_sales" ("stripe_customer_id")
  [1m[36m (0.1ms)[0m  [1mSELECT * FROM "apayola_sales"[0m
  [1m[35m (0.1ms)[0m  INSERT INTO "payola_sales" ("id","email","guid","product_id","product_type","created_at","updated_at","state","stripe_id","stripe_token","card_last4","card_expiration","card_type","error","amount","fee_amount","coupon_id","opt_in","download_count","affiliate_id","customer_address","business_address","stripe_customer_id","currency","signed_custom_fields") VALUES (1, 'pete@bugsplat.info', '1v2hth', 1, 'Product', '2014-10-24 20:50:28.064239', '2014-10-24 20:50:30.964672', 'finished', 'ch_14rF0zDpyMZVJxV9h51YbGRx', 'tok_14rF0xDpyMZVJxV9zgP97t6C', '4242', '2034-12-01', 'Visa', NULL, 100, 33, NULL, NULL, NULL, NULL, NULL, NULL, 'cus_51HaSWCD64X7ii', 'usd', NULL)
  [1m[36m (0.2ms)[0m  [1mINSERT INTO "payola_sales" ("id","email","guid","product_id","product_type","created_at","updated_at","state","stripe_id","stripe_token","card_last4","card_expiration","card_type","error","amount","fee_amount","coupon_id","opt_in","download_count","affiliate_id","customer_address","business_address","stripe_customer_id","currency","signed_custom_fields") VALUES (2, 'pete@bugsplat.info', 'c6jbbp', 1, 'Product', '2014-10-24 20:51:08.133946', '2014-10-24 20:51:10.511057', 'finished', 'ch_14rF1dDpyMZVJxV9CmaAzs8b', 'tok_14rF1bDpyMZVJxV9C5GT9wMk', '4242', '2034-12-01', 'Visa', NULL, 100, 33, NULL, NULL, NULL, NULL, NULL, NULL, 'cus_51Haa02oV95sKB', 'usd', NULL)[0m
  [1m[35m (0.2ms)[0m  INSERT INTO "payola_sales" ("id","email","guid","product_id","product_type","created_at","updated_at","state","stripe_id","stripe_token","card_last4","card_expiration","card_type","error","amount","fee_amount","coupon_id","opt_in","download_count","affiliate_id","customer_address","business_address","stripe_customer_id","currency","signed_custom_fields") VALUES (3, 'pete@bugsplat.info', 'fmd7nk', 1, 'Product', '2014-10-24 20:53:42.156020', '2014-10-24 20:53:44.712072', 'finished', 'ch_14rF47DpyMZVJxV911dIpIYX', 'tok_14rF45DpyMZVJxV9aT7V54TK', '4242', '2034-12-01', 'Visa', NULL, 100, 33, NULL, NULL, NULL, NULL, NULL, NULL, 'cus_51HdNSPn0zJj4Q', 'usd', NULL)
  [1m[36m (0.8ms)[0m  [1mDROP TABLE "apayola_sales"[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_stripe_customer_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_stripe_customer_id' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_product' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_product' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_guid' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_guid' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_email' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'

  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO "schema_migrations" ("version") VALUES (?)[0m  [["version", "20141026144800"]]
  [1m[35m (1.0ms)[0m  commit transaction
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.2ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_stripe_customer_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_stripe_customer_id' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_product' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_product' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_guid' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_guid' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_email' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'



Started GET "/buy" for 127.0.0.1 at 2014-10-28 14:52:46 -0400
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Processing by BuyController#index as HTML
  [1m[35mProduct Load (0.1ms)[0m  SELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_checkout.html.erb (159.6ms)
  Rendered buy/index.html.erb within layouts/application (166.2ms)
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_stripe_header.html.erb (0.6ms)
Completed 200 OK in 339ms (Views: 298.8ms | ActiveRecord: 1.0ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-10-28 14:52:47 -0400


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-10-28 14:52:47 -0400


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-10-28 14:52:47 -0400


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-10-28 14:52:47 -0400


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-10-28 14:52:47 -0400


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-10-28 14:52:47 -0400


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-10-28 14:52:47 -0400


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-10-28 14:52:47 -0400


Started POST "/subdir/payola/buy/product/foo" for 127.0.0.1 at 2014-10-28 14:53:00 -0400
Processing by Payola::TransactionsController#create as */*
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"2IuIJThdxsedZZm+4RNkPb6BrXTjLdCWKYgcutw62cE=", "stripeToken"=>"tok_52kaCI8fKvdiYW", "stripeEmail"=>"test@example.com", "product_class"=>"product", "permalink"=>"foo"}
  [1m[36mProduct Load (0.2ms)[0m  [1mSELECT  "products".* FROM "products"  WHERE "products"."permalink" = 'foo' LIMIT 1[0m
  [1m[35mPayola::Coupon Load (0.3ms)[0m  SELECT  "payola_coupons".* FROM "payola_coupons"  WHERE (lower(code) = lower(NULL))  ORDER BY "payola_coupons"."id" ASC LIMIT 1
  [1m[36mPayola::Affiliate Load (0.1ms)[0m  [1mSELECT  "payola_affiliates".* FROM "payola_affiliates"  WHERE (lower(code) = lower(NULL))  ORDER BY "payola_affiliates"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPayola::Sale Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "payola_sales"  WHERE "payola_sales"."guid" IS NULL LIMIT 1[0m
  [1m[35mCACHE (0.0ms)[0m  SELECT  1 AS one FROM "payola_sales"  WHERE "payola_sales"."guid" IS NULL LIMIT 1
  [1m[36mPayola::Sale Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "payola_sales"  WHERE "payola_sales"."guid" = '3ufe1d' LIMIT 1[0m
  [1m[35mSQL (0.6ms)[0m  INSERT INTO "payola_sales" ("amount", "created_at", "currency", "email", "guid", "product_id", "product_type", "state", "stripe_token", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)  [["amount", 100], ["created_at", "2014-10-28 18:53:01.110322"], ["currency", "usd"], ["email", "test@example.com"], ["guid", "3ufe1d"], ["product_id", 1], ["product_type", "Product"], ["state", "pending"], ["stripe_token", "tok_52kaCI8fKvdiYW"], ["updated_at", "2014-10-28 18:53:01.110322"]]
  [1m[36m (0.9ms)[0m  [1mcommit transaction[0m
Completed 200 OK in 335ms (Views: 0.4ms | ActiveRecord: 3.1ms)
  [1m[35mPayola::Sale Load (0.3ms)[0m  SELECT  "payola_sales".* FROM "payola_sales"  WHERE "payola_sales"."guid" = '3ufe1d'  ORDER BY "payola_sales"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE "payola_sales" SET "state" = 'processing' WHERE "payola_sales"."id" = 4
  [1m[36mPayola::Sale Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "payola_sales"  WHERE ("payola_sales"."guid" = '3ufe1d' AND "payola_sales"."id" != 4) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "payola_sales" SET "state" = ?, "updated_at" = ? WHERE "payola_sales"."id" = 4  [["state", "processing"], ["updated_at", "2014-10-28 18:53:01.271426"]]


Started GET "/subdir/payola/status/3ufe1d" for 127.0.0.1 at 2014-10-28 14:53:01 -0400
Processing by Payola::TransactionsController#status as */*
  Parameters: {"guid"=>"3ufe1d"}
  [1m[36mPayola::Sale Load (0.2ms)[0m  [1mSELECT  "payola_sales".* FROM "payola_sales"  WHERE "payola_sales"."guid" = '3ufe1d'  ORDER BY "payola_sales"."id" ASC LIMIT 1[0m
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 1.0ms)


Started GET "/subdir/payola/status/3ufe1d" for 127.0.0.1 at 2014-10-28 14:53:01 -0400
Processing by Payola::TransactionsController#status as */*
  Parameters: {"guid"=>"3ufe1d"}
  [1m[35mPayola::Sale Load (0.2ms)[0m  SELECT  "payola_sales".* FROM "payola_sales"  WHERE "payola_sales"."guid" = '3ufe1d'  ORDER BY "payola_sales"."id" ASC LIMIT 1
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.2ms)


Started GET "/subdir/payola/status/3ufe1d" for 127.0.0.1 at 2014-10-28 14:53:02 -0400
Processing by Payola::TransactionsController#status as */*
  Parameters: {"guid"=>"3ufe1d"}
  [1m[36mPayola::Sale Load (0.3ms)[0m  [1mSELECT  "payola_sales".* FROM "payola_sales"  WHERE "payola_sales"."guid" = '3ufe1d'  ORDER BY "payola_sales"."id" ASC LIMIT 1[0m
Completed 200 OK in 2ms (Views: 0.3ms | ActiveRecord: 0.3ms)


Started GET "/subdir/payola/status/3ufe1d" for 127.0.0.1 at 2014-10-28 14:53:03 -0400
Processing by Payola::TransactionsController#status as */*
  Parameters: {"guid"=>"3ufe1d"}
  [1m[35mPayola::Sale Load (0.3ms)[0m  SELECT  "payola_sales".* FROM "payola_sales"  WHERE "payola_sales"."guid" = '3ufe1d'  ORDER BY "payola_sales"."id" ASC LIMIT 1
Completed 200 OK in 2ms (Views: 0.2ms | ActiveRecord: 0.3ms)


Started GET "/subdir/payola/status/3ufe1d" for 127.0.0.1 at 2014-10-28 14:53:03 -0400
Processing by Payola::TransactionsController#status as */*
  Parameters: {"guid"=>"3ufe1d"}
  [1m[36mPayola::Sale Load (0.3ms)[0m  [1mSELECT  "payola_sales".* FROM "payola_sales"  WHERE "payola_sales"."guid" = '3ufe1d'  ORDER BY "payola_sales"."id" ASC LIMIT 1[0m
Completed 200 OK in 2ms (Views: 0.2ms | ActiveRecord: 0.3ms)
  [1m[35mPayola::Sale Exists (0.2ms)[0m  SELECT  1 AS one FROM "payola_sales"  WHERE ("payola_sales"."guid" = '3ufe1d' AND "payola_sales"."id" != 4) LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "payola_sales" SET "card_expiration" = ?, "card_last4" = ?, "card_type" = ?, "fee_amount" = ?, "stripe_customer_id" = ?, "stripe_id" = ?, "updated_at" = ? WHERE "payola_sales"."id" = 4[0m  [["card_expiration", "2034-12-01"], ["card_last4", "4242"], ["card_type", "Visa"], ["fee_amount", 33], ["stripe_customer_id", "cus_52kaT9CSfu0alj"], ["stripe_id", "ch_52kaTQfCRbZSOv"], ["updated_at", "2014-10-28 18:53:03.908193"]]
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (1.3ms)[0m  [1mUPDATE "payola_sales" SET "state" = 'finished' WHERE "payola_sales"."id" = 4[0m
  [1m[35mProduct Load (0.2ms)[0m  SELECT  "products".* FROM "products"  WHERE "products"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (1.3ms)[0m  commit transaction


Started GET "/subdir/payola/status/3ufe1d" for 127.0.0.1 at 2014-10-28 14:53:04 -0400
Processing by Payola::TransactionsController#status as */*
  Parameters: {"guid"=>"3ufe1d"}
  [1m[36mPayola::Sale Load (0.2ms)[0m  [1mSELECT  "payola_sales".* FROM "payola_sales"  WHERE "payola_sales"."guid" = '3ufe1d'  ORDER BY "payola_sales"."id" ASC LIMIT 1[0m
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.2ms)


Started GET "/subdir/payola/confirm/3ufe1d" for 127.0.0.1 at 2014-10-28 14:53:04 -0400
Processing by Payola::TransactionsController#show as HTML
  Parameters: {"guid"=>"3ufe1d"}
  [1m[35mPayola::Sale Load (0.3ms)[0m  SELECT  "payola_sales".* FROM "payola_sales"  WHERE "payola_sales"."guid" = '3ufe1d' LIMIT 1
  [1m[36mProduct Load (0.3ms)[0m  [1mSELECT  "products".* FROM "products"  WHERE "products"."id" = ? LIMIT 1[0m  [["id", 1]]
Redirected to http://localhost:3000/
Completed 302 Found in 35ms (ActiveRecord: 0.7ms)


Started GET "/" for 127.0.0.1 at 2014-10-28 14:53:04 -0400
Processing by Rails::WelcomeController#index as HTML
  Rendered /Users/peter/.rbenv/versions/1.9.3-p286/lib/ruby/gems/1.9.1/gems/railties-4.1.6/lib/rails/templates/rails/welcome/index.html.erb (0.9ms)
Completed 200 OK in 3ms (Views: 2.4ms | ActiveRecord: 0.0ms)
Terminating 3 actors...
Terminating task: type=:finalizer, meta={:method_name=>:__shutdown__}, status=:callwait
  [1m[36mActiveRecord::SchemaMigration Load (0.4ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Migrating to CreatePayolaSubscription (20141028203710)
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.5ms)[0m  [1mCREATE TABLE "payola_subscriptions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar(255), "guid" varchar(255), "plan_id" integer, "plan_type" integer, "state" varchar(255), "stripe_id" varchar(255), "affiliate_id" integer, "created_at" datetime, "updated_at" datetime) [0m
  [1m[35m (0.1ms)[0m  select sqlite_version(*)
  [1m[36m (0.2ms)[0m  [1mCREATE  INDEX "index_payola_subscriptions_on_guid" ON "payola_subscriptions" ("guid")[0m
  [1m[35m (0.2ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_subscriptions_on_guid' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_subscriptions_on_guid' AND type='index'

  [1m[36m (0.2ms)[0m  [1mCREATE  INDEX "index_payola_subscriptions_on_stripe_id" ON "payola_subscriptions" ("stripe_id")[0m
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "schema_migrations" ("version") VALUES (?)  [["version", "20141028203710"]]
  [1m[36m (4.7ms)[0m  [1mcommit transaction[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.1ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_stripe_customer_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_stripe_customer_id' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_product' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_product' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_guid' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_guid' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_email' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_subscriptions_on_stripe_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_subscriptions_on_stripe_id' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_subscriptions_on_guid' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_subscriptions_on_guid' AND type='index'
[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.1ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
Migrating to CreatePayolaSubscription (20141028203710)
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.2ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_subscriptions_on_stripe_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_subscriptions_on_stripe_id' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_subscriptions_on_guid' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_subscriptions_on_guid' AND type='index'
[0m
  [1m[35m (0.3ms)[0m  DROP INDEX "index_payola_subscriptions_on_stripe_id"
  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_subscriptions_on_guid' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_subscriptions_on_guid' AND type='index'
[0m
  [1m[35m (1.3ms)[0m  DROP INDEX "index_payola_subscriptions_on_guid"
  [1m[36m (0.2ms)[0m  [1mDROP TABLE "payola_subscriptions"[0m
  [1m[35mSQL (0.2ms)[0m  DELETE FROM "schema_migrations" WHERE "schema_migrations"."version" = '20141028203710'
  [1m[36m (0.8ms)[0m  [1mcommit transaction[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.1ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_stripe_customer_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_stripe_customer_id' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_product' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_product' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_guid' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_guid' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_email' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'
[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.5ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Migrating to AddOwnerToPayolaSale (20141029135848)
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.7ms)[0m  [1mALTER TABLE "payola_sales" ADD "owner_id" integer[0m
  [1m[35m (0.3ms)[0m  ALTER TABLE "payola_sales" ADD "owner_type" varchar(255)
  [1m[36m (0.1ms)[0m  [1mselect sqlite_version(*)[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_stripe_customer_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_stripe_customer_id' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_product' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_product' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_guid' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_guid' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_email' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'

  [1m[36m (0.9ms)[0m  [1mCREATE  INDEX "index_payola_sales_on_owner_id_and_owner_type" ON "payola_sales" ("owner_id", "owner_type")[0m
  [1m[35mSQL (0.7ms)[0m  INSERT INTO "schema_migrations" ("version") VALUES (?)  [["version", "20141029135848"]]
  [1m[36m (4.3ms)[0m  [1mcommit transaction[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.1ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_owner_id_and_owner_type' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_owner_id_and_owner_type' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_stripe_customer_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_stripe_customer_id' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_product' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_product' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_guid' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_guid' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_email' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'

  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Migrating to CreateOwners (20141029140518)
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.5ms)[0m  [1mCREATE TABLE "owners" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "created_at" datetime, "updated_at" datetime) [0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "schema_migrations" ("version") VALUES (?)  [["version", "20141029140518"]]
  [1m[36m (2.2ms)[0m  [1mcommit transaction[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.1ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_owner_id_and_owner_type' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_owner_id_and_owner_type' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_stripe_customer_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_stripe_customer_id' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_product' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_product' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_guid' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_guid' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_email' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'

  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.1ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_owner_id_and_owner_type' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_owner_id_and_owner_type' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_stripe_customer_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_stripe_customer_id' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_product' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_product' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_guid' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_guid' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_email' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'

  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.1ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_owner_id_and_owner_type' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_owner_id_and_owner_type' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_stripe_customer_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_stripe_customer_id' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_product' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_product' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_guid' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_guid' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_email' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'

  [1m[36mActiveRecord::SchemaMigration Load (0.5ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Migrating to CreateSubscriptionPlans (20141105010234)
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.9ms)[0m  [1mCREATE TABLE "subscription_plans" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "amount" integer, "interval" varchar(255), "interval_count" integer, "name" varchar(255), "stripe_id" varchar(255), "trial_period_days" integer, "created_at" datetime, "updated_at" datetime) [0m
  [1m[35mSQL (0.6ms)[0m  INSERT INTO "schema_migrations" ("version") VALUES (?)  [["version", "20141105010234"]]
  [1m[36m (3.2ms)[0m  [1mcommit transaction[0m
Migrating to CreatePayolaSubscriptions (20141105043439)
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.4ms)[0m  [1mCREATE TABLE "payola_subscriptions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "plan_type" varchar(255), "plan_id" integer, "start" datetime, "status" varchar(255), "owner_type" varchar(255), "owner_id" integer, "stripe_customer_id" varchar(255), "cancel_at_period_end" boolean, "current_period_start" datetime, "current_period_end" datetime, "ended_at" datetime, "trial_start" datetime, "trial_end" datetime, "canceled_at" datetime, "quantity" integer, "stripe_id" varchar(255), "stripe_token" varchar(255), "card_last4" varchar(255), "card_expiration" date, "card_type" varchar(255), "error" text, "state" varchar(255), "email" varchar(255), "created_at" datetime, "updated_at" datetime) [0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "schema_migrations" ("version") VALUES (?)  [["version", "20141105043439"]]
  [1m[36m (0.9ms)[0m  [1mcommit transaction[0m
Migrating to AddCurrencyToPayolaSubscriptions (20141106034610)
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.3ms)[0m  [1mALTER TABLE "payola_subscriptions" ADD "currency" varchar(255)[0m
  [1m[35m (0.1ms)[0m  ALTER TABLE "payola_subscriptions" ADD "amount" integer
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO "schema_migrations" ("version") VALUES (?)[0m  [["version", "20141106034610"]]
  [1m[35m (0.7ms)[0m  commit transaction
Migrating to AddGuidToPayolaSubscriptions (20141107025420)
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.3ms)[0m  ALTER TABLE "payola_subscriptions" ADD "guid" varchar(255)
  [1m[36m (0.0ms)[0m  [1mselect sqlite_version(*)[0m
  [1m[35m (0.1ms)[0m  CREATE  INDEX "index_payola_subscriptions_on_guid" ON "payola_subscriptions" ("guid")
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO "schema_migrations" ("version") VALUES (?)[0m  [["version", "20141107025420"]]
  [1m[35m (0.8ms)[0m  commit transaction
Migrating to AddStripeStatusToPayolaSubscription (20141109203101)
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.8ms)[0m  ALTER TABLE "payola_subscriptions" ADD "stripe_status" varchar(255)
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "schema_migrations" ("version") VALUES (?)[0m  [["version", "20141109203101"]]
  [1m[35m (0.8ms)[0m  commit transaction
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.2ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_owner_id_and_owner_type' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_owner_id_and_owner_type' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_stripe_customer_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_stripe_customer_id' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_product' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_product' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_guid' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_guid' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_email' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_subscriptions_on_guid' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_subscriptions_on_guid' AND type='index'



Started GET "/" for 127.0.0.1 at 2014-11-13 10:28:29 -0500
  [1m[36mActiveRecord::SchemaMigration Load (0.5ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Processing by Rails::WelcomeController#index as HTML
  Rendered /Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/railties-4.1.6/lib/rails/templates/rails/welcome/index.html.erb (2.3ms)
Completed 200 OK in 8ms (Views: 7.6ms | ActiveRecord: 0.0ms)


Started GET "/" for 127.0.0.1 at 2014-11-13 10:28:31 -0500
Processing by Rails::WelcomeController#index as HTML
  Rendered /Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/railties-4.1.6/lib/rails/templates/rails/welcome/index.html.erb (0.1ms)
Completed 200 OK in 2ms (Views: 1.3ms | ActiveRecord: 0.0ms)


Started GET "/" for 127.0.0.1 at 2014-11-13 10:28:32 -0500
Processing by Rails::WelcomeController#index as HTML
  Rendered /Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/railties-4.1.6/lib/rails/templates/rails/welcome/index.html.erb (0.1ms)
Completed 200 OK in 1ms (Views: 1.1ms | ActiveRecord: 0.0ms)


Started GET "/buy" for 127.0.0.1 at 2014-11-13 10:28:32 -0500
Processing by BuyController#index as HTML
  [1m[35mProduct Load (0.6ms)[0m  SELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_checkout.html.erb (50.5ms)
  Rendered buy/index.html.erb within layouts/application (55.5ms)
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_stripe_header.html.erb (0.4ms)
Completed 200 OK in 179ms (Views: 169.3ms | ActiveRecord: 1.4ms)


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-11-13 10:28:32 -0500


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-11-13 10:28:32 -0500


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-11-13 10:28:32 -0500


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-11-13 10:28:32 -0500


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-11-13 10:28:32 -0500


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-11-13 10:28:32 -0500


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-11-13 10:28:32 -0500


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-11-13 10:28:32 -0500
  [1m[36mActiveRecord::SchemaMigration Load (0.5ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Migrating to AddAffiliateIdToPayolaSubscriptions (20141112024805)
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.8ms)[0m  [1mALTER TABLE "payola_subscriptions" ADD "affiliate_id" integer[0m
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "schema_migrations" ("version") VALUES (?)  [["version", "20141112024805"]]
  [1m[36m (0.9ms)[0m  [1mcommit transaction[0m
Migrating to AddCouponCodeToPayolaSubscriptions (20141114032013)
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.5ms)[0m  [1mALTER TABLE "payola_subscriptions" ADD "coupon" varchar(255)[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO "schema_migrations" ("version") VALUES (?)  [["version", "20141114032013"]]
  [1m[36m (0.8ms)[0m  [1mcommit transaction[0m
Migrating to AddSignedCustomFieldsToPayolaSubscription (20141114154223)
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.3ms)[0m  [1mALTER TABLE "payola_subscriptions" ADD "signed_custom_fields" text[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO "schema_migrations" ("version") VALUES (?)  [["version", "20141114154223"]]
  [1m[36m (0.8ms)[0m  [1mcommit transaction[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.1ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_owner_id_and_owner_type' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_owner_id_and_owner_type' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_stripe_customer_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_stripe_customer_id' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_product' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_product' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_guid' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_guid' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_email' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'

  [1m[36m (0.2ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_subscriptions_on_guid' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_subscriptions_on_guid' AND type='index'
[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.5ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Migrating to AddAddressesToPayolaSubscription (20141114163841)
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.5ms)[0m  [1mALTER TABLE "payola_subscriptions" ADD "customer_address" text[0m
  [1m[35m (0.2ms)[0m  ALTER TABLE "payola_subscriptions" ADD "business_address" text
  [1m[36mSQL (0.6ms)[0m  [1mINSERT INTO "schema_migrations" ("version") VALUES (?)[0m  [["version", "20141114163841"]]
  [1m[35m (1.2ms)[0m  commit transaction
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
  [1m[35m (0.2ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_owner_id_and_owner_type' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_owner_id_and_owner_type' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_stripe_customer_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_stripe_customer_id' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_product' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_product' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_guid' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_guid' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_email' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_subscriptions_on_guid' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_subscriptions_on_guid' AND type='index'

  [1m[36m (1.1ms)[0m  [1mCREATE TABLE "owners" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "created_at" datetime, "updated_at" datetime) [0m
  [1m[35m (1.0ms)[0m  CREATE TABLE "payola_affiliates" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "code" varchar(255), "email" varchar(255), "percent" integer, "created_at" datetime, "updated_at" datetime) 
  [1m[36m (0.8ms)[0m  [1mCREATE TABLE "payola_coupons" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "code" varchar(255), "percent_off" integer, "created_at" datetime, "updated_at" datetime) [0m
  [1m[35m (1.0ms)[0m  CREATE TABLE "payola_sales" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar(255), "guid" varchar(255), "product_id" integer, "product_type" varchar(255), "created_at" datetime, "updated_at" datetime, "state" varchar(255), "stripe_id" varchar(255), "stripe_token" varchar(255), "card_last4" varchar(255), "card_expiration" date, "card_type" varchar(255), "error" text, "amount" integer, "fee_amount" integer, "coupon_id" integer, "opt_in" boolean, "download_count" integer, "affiliate_id" integer, "customer_address" text, "business_address" text, "stripe_customer_id" varchar(255), "currency" varchar(255), "signed_custom_fields" text, "owner_id" integer, "owner_type" varchar(255)) 
  [1m[36m (0.1ms)[0m  [1mselect sqlite_version(*)[0m
  [1m[35m (1.0ms)[0m  CREATE  INDEX "index_payola_sales_on_coupon_id" ON "payola_sales" ("coupon_id")
  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'
[0m
  [1m[35m (0.8ms)[0m  CREATE  INDEX "index_payola_sales_on_email" ON "payola_sales" ("email")
  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_email' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'

  [1m[36m (0.9ms)[0m  [1mCREATE  INDEX "index_payola_sales_on_guid" ON "payola_sales" ("guid")[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_guid' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_guid' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_email' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'

  [1m[36m (0.8ms)[0m  [1mCREATE  INDEX "index_payola_sales_on_owner_id_and_owner_type" ON "payola_sales" ("owner_id", "owner_type")[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_owner_id_and_owner_type' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_owner_id_and_owner_type' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_guid' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_guid' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_email' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'
[0m
  [1m[35m (0.8ms)[0m  CREATE  INDEX "index_payola_sales_on_product" ON "payola_sales" ("product_id", "product_type")
  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_product' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_product' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_owner_id_and_owner_type' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_owner_id_and_owner_type' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_guid' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_guid' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_email' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'
[0m
  [1m[35m (0.8ms)[0m  CREATE  INDEX "index_payola_sales_on_stripe_customer_id" ON "payola_sales" ("stripe_customer_id")
  [1m[36m (0.7ms)[0m  [1mCREATE TABLE "payola_stripe_webhooks" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "stripe_id" varchar(255), "created_at" datetime, "updated_at" datetime) [0m
  [1m[35m (0.9ms)[0m  CREATE TABLE "payola_subscriptions" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "plan_type" varchar(255), "plan_id" integer, "start" datetime, "status" varchar(255), "owner_type" varchar(255), "owner_id" integer, "stripe_customer_id" varchar(255), "cancel_at_period_end" boolean, "current_period_start" datetime, "current_period_end" datetime, "ended_at" datetime, "trial_start" datetime, "trial_end" datetime, "canceled_at" datetime, "quantity" integer, "stripe_id" varchar(255), "stripe_token" varchar(255), "card_last4" varchar(255), "card_expiration" date, "card_type" varchar(255), "error" text, "state" varchar(255), "email" varchar(255), "created_at" datetime, "updated_at" datetime, "currency" varchar(255), "amount" integer, "guid" varchar(255), "stripe_status" varchar(255), "affiliate_id" integer, "coupon" varchar(255), "signed_custom_fields" text, "customer_address" text, "business_address" text) 
  [1m[36m (0.8ms)[0m  [1mCREATE  INDEX "index_payola_subscriptions_on_guid" ON "payola_subscriptions" ("guid")[0m
  [1m[35m (0.8ms)[0m  CREATE TABLE "products" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar(255), "permalink" varchar(255), "price" integer, "created_at" datetime, "updated_at" datetime) 
  [1m[36m (1.0ms)[0m  [1mCREATE TABLE "subscription_plans" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "amount" integer, "interval" varchar(255), "interval_count" integer, "name" varchar(255), "stripe_id" varchar(255), "trial_period_days" integer, "created_at" datetime, "updated_at" datetime) [0m
  [1m[35m (0.9ms)[0m  CREATE TABLE "schema_migrations" ("version" varchar(255) NOT NULL) 
  [1m[36m (1.1ms)[0m  [1mCREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")[0m
  [1m[35m (0.1ms)[0m  SELECT version FROM "schema_migrations"
  [1m[36m (0.8ms)[0m  [1mINSERT INTO "schema_migrations" (version) VALUES ('20141114163841')[0m
  [1m[35m (0.8ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20141001230848')
  [1m[36m (0.7ms)[0m  [1mINSERT INTO "schema_migrations" (version) VALUES ('20141029140518')[0m
  [1m[35m (0.7ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20141105010234')
  [1m[36m (0.7ms)[0m  [1mINSERT INTO "schema_migrations" (version) VALUES ('20141001170138')[0m
  [1m[35m (0.6ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20141001203541')
  [1m[36m (0.8ms)[0m  [1mINSERT INTO "schema_migrations" (version) VALUES ('20141002013618')[0m
  [1m[35m (0.7ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20141002013701')
  [1m[36m (0.7ms)[0m  [1mINSERT INTO "schema_migrations" (version) VALUES ('20141002203725')[0m
  [1m[35m (0.8ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20141017233304')
  [1m[36m (0.9ms)[0m  [1mINSERT INTO "schema_migrations" (version) VALUES ('20141026101628')[0m
  [1m[35m (0.8ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20141026144800')
  [1m[36m (0.8ms)[0m  [1mINSERT INTO "schema_migrations" (version) VALUES ('20141029135848')[0m
  [1m[35m (0.7ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20141105043439')
  [1m[36m (0.6ms)[0m  [1mINSERT INTO "schema_migrations" (version) VALUES ('20141106034610')[0m
  [1m[35m (0.7ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20141107025420')
  [1m[36m (0.6ms)[0m  [1mINSERT INTO "schema_migrations" (version) VALUES ('20141109203101')[0m
  [1m[35m (0.7ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20141112024805')
  [1m[36m (0.8ms)[0m  [1mINSERT INTO "schema_migrations" (version) VALUES ('20141114032013')[0m
  [1m[35m (0.7ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20141114154223')
  [1m[36mActiveRecord::SchemaMigration Load (0.5ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Migrating to CreateSubscriptionPlanWithoutIntervalCounts (20141120170744)
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.6ms)[0m  [1mCREATE TABLE "subscription_plan_without_interval_counts" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "name" varchar(255), "stripe_id" varchar(255), "amount" integer, "interval" varchar(255), "created_at" datetime, "updated_at" datetime) [0m
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "schema_migrations" ("version") VALUES (?)  [["version", "20141120170744"]]
  [1m[36m (1.0ms)[0m  [1mcommit transaction[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.2ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (0.2ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_owner_id_and_owner_type' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_owner_id_and_owner_type' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_stripe_customer_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_stripe_customer_id' AND type='index'

  [1m[36m (0.2ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_product' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_product' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_guid' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_guid' AND type='index'

  [1m[36m (0.5ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_email' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'

  [1m[36m (0.2ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_subscriptions_on_guid' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_subscriptions_on_guid' AND type='index'
[0m


Started GET "/" for 127.0.0.1 at 2014-11-21 18:20:13 -0500
  [1m[36mActiveRecord::SchemaMigration Load (0.5ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Processing by HomeController#index as HTML
  Rendered home/index.html.erb within layouts/application (2.7ms)
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_stripe_header.html.erb (0.7ms)
Completed 200 OK in 138ms (Views: 137.7ms | ActiveRecord: 0.0ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-11-21 18:20:13 -0500


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-11-21 18:20:13 -0500


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-11-21 18:20:13 -0500


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-11-21 18:20:13 -0500


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-11-21 18:20:13 -0500


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-11-21 18:20:13 -0500


Started GET "/assets/payola/subscription_form.js?body=1" for 127.0.0.1 at 2014-11-21 18:20:13 -0500


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-11-21 18:20:13 -0500


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-11-21 18:20:13 -0500


Started GET "/hmm/new" for 127.0.0.1 at 2014-11-21 18:20:16 -0500
Processing by HmmController#new as HTML
  [1m[35mSubscriptionPlan Load (0.6ms)[0m  SELECT  "subscription_plans".* FROM "subscription_plans"   ORDER BY "subscription_plans"."id" ASC LIMIT 1
  Rendered hmm/new.html.erb within layouts/application (13.2ms)
Completed 500 Internal Server Error in 16ms

ActionView::Template::Error (First argument in form cannot contain nil or be empty):
    1: <%= form_for SubscriptionPlan.first, url: '/hmm' do |f| %>
    2:   <%= f.submit %>
    3: <% end %>
  app/views/hmm/new.html.erb:1:in `_app_views_hmm_new_html_erb___560673872852318278_70216458825980'


  Rendered /Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (1.3ms)
  Rendered /Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.6ms)
  Rendered /Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout (12.6ms)


Started GET "/hmm/new" for 127.0.0.1 at 2014-11-21 18:20:40 -0500
Processing by HmmController#new as HTML
  [1m[36mProduct Load (0.6ms)[0m  [1mSELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1[0m
  Rendered hmm/new.html.erb within layouts/application (30.0ms)
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_stripe_header.html.erb (0.1ms)
Completed 200 OK in 66ms (Views: 64.5ms | ActiveRecord: 0.9ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-11-21 18:20:40 -0500


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-11-21 18:20:40 -0500


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-11-21 18:20:40 -0500


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-11-21 18:20:40 -0500


Started GET "/assets/payola/subscription_form.js?body=1" for 127.0.0.1 at 2014-11-21 18:20:40 -0500


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-11-21 18:20:40 -0500


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-11-21 18:20:40 -0500


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-11-21 18:20:40 -0500


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-11-21 18:20:40 -0500


Started GET "/hmm/new" for 127.0.0.1 at 2014-11-21 18:21:08 -0500
Processing by HmmController#new as HTML
  [1m[35mProduct Load (0.2ms)[0m  SELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1
  Rendered hmm/new.html.erb within layouts/application (8.5ms)
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_stripe_header.html.erb (0.1ms)
Completed 200 OK in 51ms (Views: 50.2ms | ActiveRecord: 0.2ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-11-21 18:21:08 -0500


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-11-21 18:21:08 -0500


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-11-21 18:21:08 -0500


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-11-21 18:21:08 -0500


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-11-21 18:21:08 -0500


Started GET "/assets/payola/subscription_form.js?body=1" for 127.0.0.1 at 2014-11-21 18:21:08 -0500


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-11-21 18:21:08 -0500


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-11-21 18:21:08 -0500


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-11-21 18:21:08 -0500


Started PATCH "/hmm" for 127.0.0.1 at 2014-11-21 18:21:10 -0500

ActionController::RoutingError (No route matches [PATCH] "/hmm"):
  actionpack (4.1.6) lib/action_dispatch/middleware/debug_exceptions.rb:21:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/show_exceptions.rb:30:in `call'
  railties (4.1.6) lib/rails/rack/logger.rb:38:in `call_app'
  railties (4.1.6) lib/rails/rack/logger.rb:20:in `block in call'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:68:in `block in tagged'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:26:in `tagged'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:68:in `tagged'
  railties (4.1.6) lib/rails/rack/logger.rb:20:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/request_id.rb:21:in `call'
  rack (1.5.2) lib/rack/methodoverride.rb:21:in `call'
  rack (1.5.2) lib/rack/runtime.rb:17:in `call'
  activesupport (4.1.6) lib/active_support/cache/strategy/local_cache_middleware.rb:26:in `call'
  rack (1.5.2) lib/rack/lock.rb:17:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/static.rb:64:in `call'
  rack (1.5.2) lib/rack/sendfile.rb:112:in `call'
  railties (4.1.6) lib/rails/engine.rb:514:in `call'
  railties (4.1.6) lib/rails/application.rb:144:in `call'
  rack (1.5.2) lib/rack/lock.rb:17:in `call'
  rack (1.5.2) lib/rack/content_length.rb:14:in `call'
  rack (1.5.2) lib/rack/handler/webrick.rb:60:in `service'
  /Users/peter/.rbenv/versions/2.1.2/lib/ruby/2.1.0/webrick/httpserver.rb:138:in `service'
  /Users/peter/.rbenv/versions/2.1.2/lib/ruby/2.1.0/webrick/httpserver.rb:94:in `run'
  /Users/peter/.rbenv/versions/2.1.2/lib/ruby/2.1.0/webrick/server.rb:295:in `block in start_thread'


  Rendered /Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (1.1ms)
  Rendered /Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/routes/_route.html.erb (1.8ms)
  Rendered /Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/routes/_route.html.erb (0.2ms)
  Rendered /Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/routes/_route.html.erb (0.8ms)
  Rendered /Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/routes/_table.html.erb (8.6ms)
  Rendered /Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/routing_error.html.erb within rescues/layout (39.9ms)


Started GET "/hmm/new" for 127.0.0.1 at 2014-11-21 18:21:21 -0500
Processing by HmmController#new as HTML
  [1m[36mProduct Load (0.2ms)[0m  [1mSELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1[0m
  Rendered hmm/new.html.erb within layouts/application (2.8ms)
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_stripe_header.html.erb (0.1ms)
Completed 200 OK in 46ms (Views: 45.2ms | ActiveRecord: 0.2ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-11-21 18:21:21 -0500


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-11-21 18:21:21 -0500


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-11-21 18:21:21 -0500


Started GET "/assets/payola/subscription_form.js?body=1" for 127.0.0.1 at 2014-11-21 18:21:21 -0500


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-11-21 18:21:21 -0500


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-11-21 18:21:21 -0500


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-11-21 18:21:21 -0500


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-11-21 18:21:21 -0500


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-11-21 18:21:21 -0500


Started POST "/hmm" for 127.0.0.1 at 2014-11-21 18:21:22 -0500
Processing by HmmController#create as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"pmeohcfXt8LFtx6fFfyT+rS/4J9mBIyGrp6DsNEfi/w=", "commit"=>"Update Product"}
Redirected to 
Completed 500 Internal Server Error in 43ms

NoMethodError (undefined method `new_url' for #<HmmController:0x007fb9142064b0>):
  app/controllers/hmm_controller.rb:6:in `create'


  Rendered /Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_source.erb (0.7ms)
  Rendered /Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (1.3ms)
  Rendered /Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (0.9ms)
  Rendered /Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/diagnostics.erb within rescues/layout (16.5ms)


Started POST "/hmm" for 127.0.0.1 at 2014-11-21 18:21:37 -0500
Processing by HmmController#create as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"pmeohcfXt8LFtx6fFfyT+rS/4J9mBIyGrp6DsNEfi/w=", "commit"=>"Update Product"}
Redirected to http://localhost:3000/hmm/new
Completed 302 Found in 1ms (ActiveRecord: 0.0ms)


Started GET "/hmm/new" for 127.0.0.1 at 2014-11-21 18:21:37 -0500
Processing by HmmController#new as HTML
  [1m[35mProduct Load (0.5ms)[0m  SELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1
  Rendered hmm/new.html.erb within layouts/application (10.8ms)
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_stripe_header.html.erb (0.1ms)
Completed 200 OK in 48ms (Views: 46.2ms | ActiveRecord: 1.9ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-11-21 18:21:37 -0500


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-11-21 18:21:37 -0500


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-11-21 18:21:37 -0500


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-11-21 18:21:37 -0500


Started GET "/assets/payola/subscription_form.js?body=1" for 127.0.0.1 at 2014-11-21 18:21:37 -0500


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-11-21 18:21:37 -0500


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-11-21 18:21:37 -0500


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-11-21 18:21:37 -0500


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-11-21 18:21:37 -0500


Started POST "/hmm" for 127.0.0.1 at 2014-11-21 18:21:38 -0500
Processing by HmmController#create as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"pmeohcfXt8LFtx6fFfyT+rS/4J9mBIyGrp6DsNEfi/w=", "commit"=>"Update Product"}
Redirected to http://localhost:3000/hmm/new
Completed 302 Found in 1ms (ActiveRecord: 0.0ms)


Started GET "/hmm/new" for 127.0.0.1 at 2014-11-21 18:21:38 -0500
Processing by HmmController#new as HTML
  [1m[36mProduct Load (0.1ms)[0m  [1mSELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1[0m
  Rendered hmm/new.html.erb within layouts/application (1.7ms)
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_stripe_header.html.erb (0.1ms)
Completed 200 OK in 43ms (Views: 43.1ms | ActiveRecord: 0.1ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-11-21 18:21:38 -0500


Started GET "/assets/payola/subscription_form.js?body=1" for 127.0.0.1 at 2014-11-21 18:21:38 -0500


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-11-21 18:21:38 -0500


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-11-21 18:21:38 -0500


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-11-21 18:21:38 -0500


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-11-21 18:21:38 -0500


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-11-21 18:21:38 -0500


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-11-21 18:21:38 -0500


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-11-21 18:21:38 -0500


Started POST "/hmm" for 127.0.0.1 at 2014-11-21 18:21:39 -0500
Processing by HmmController#create as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"pmeohcfXt8LFtx6fFfyT+rS/4J9mBIyGrp6DsNEfi/w=", "commit"=>"Update Product"}
Redirected to http://localhost:3000/hmm/new
Completed 302 Found in 1ms (ActiveRecord: 0.0ms)


Started GET "/hmm/new" for 127.0.0.1 at 2014-11-21 18:21:39 -0500
Processing by HmmController#new as HTML
  [1m[35mProduct Load (0.1ms)[0m  SELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1
  Rendered hmm/new.html.erb within layouts/application (2.2ms)
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_stripe_header.html.erb (0.0ms)
Completed 200 OK in 42ms (Views: 42.0ms | ActiveRecord: 0.1ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-11-21 18:21:39 -0500


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-11-21 18:21:39 -0500


Started GET "/assets/payola/subscription_form.js?body=1" for 127.0.0.1 at 2014-11-21 18:21:39 -0500


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-11-21 18:21:39 -0500


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-11-21 18:21:39 -0500


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-11-21 18:21:39 -0500


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-11-21 18:21:39 -0500


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-11-21 18:21:39 -0500


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-11-21 18:21:39 -0500


Started POST "/hmm" for 127.0.0.1 at 2014-11-21 18:21:39 -0500
Processing by HmmController#create as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"pmeohcfXt8LFtx6fFfyT+rS/4J9mBIyGrp6DsNEfi/w=", "commit"=>"Update Product"}
Redirected to http://localhost:3000/hmm/new
Completed 302 Found in 1ms (ActiveRecord: 0.0ms)


Started GET "/hmm/new" for 127.0.0.1 at 2014-11-21 18:21:39 -0500
Processing by HmmController#new as HTML
  [1m[36mProduct Load (0.1ms)[0m  [1mSELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1[0m
  Rendered hmm/new.html.erb within layouts/application (1.6ms)
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_stripe_header.html.erb (0.0ms)
Completed 200 OK in 39ms (Views: 38.4ms | ActiveRecord: 0.1ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-11-21 18:21:39 -0500


Started GET "/assets/payola/subscription_form.js?body=1" for 127.0.0.1 at 2014-11-21 18:21:39 -0500


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-11-21 18:21:39 -0500


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-11-21 18:21:39 -0500


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-11-21 18:21:39 -0500


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-11-21 18:21:39 -0500


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-11-21 18:21:39 -0500


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-11-21 18:21:39 -0500


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-11-21 18:21:39 -0500


Started GET "/" for 127.0.0.1 at 2014-11-21 19:02:24 -0500
Processing by HomeController#index as HTML
  Rendered home/index.html.erb within layouts/application (1.7ms)
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_stripe_header.html.erb (0.2ms)
Completed 200 OK in 220ms (Views: 218.2ms | ActiveRecord: 0.0ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-11-21 19:02:24 -0500


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-11-21 19:02:24 -0500


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-11-21 19:02:24 -0500


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-11-21 19:02:24 -0500


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-11-21 19:02:24 -0500


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-11-21 19:02:24 -0500


Started GET "/assets/payola/subscription_form.js?body=1" for 127.0.0.1 at 2014-11-21 19:02:24 -0500


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-11-21 19:02:24 -0500


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-11-21 19:02:24 -0500


Started GET "/subscribe" for 127.0.0.1 at 2014-11-21 19:02:27 -0500
Processing by SubscribeController#index as HTML
  [1m[35mSubscriptionPlan Load (0.6ms)[0m  SELECT  "subscription_plans".* FROM "subscription_plans"   ORDER BY "subscription_plans"."id" ASC LIMIT 1
  Rendered subscribe/index.html.erb within layouts/application (1.9ms)
Completed 500 Internal Server Error in 16ms

ActionView::Template::Error (undefined method `plan_class' for nil:NilClass):
    2: 
    3: <hr>
    4: 
    5: <%= form_for @plan, url: '/', method: :post, html: { class: 'payola-subscription-form', 'data-payola-base-path' => '/subdir/payola', 'data-payola-plan-type' => @plan.plan_class, 'data-payola-plan-id' => @plan.id } do |f| %>
    6:   <span class="payola-payment-error"></span>
    7:   Email:<br>
    8:   <input type="email" name="stripeEmail" data-payola="email"></input><br>
  app/views/subscribe/index.html.erb:5:in `_app_views_subscribe_index_html_erb___3860689752389464979_70216474829000'


  Rendered /Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (2.4ms)
  Rendered /Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (2.1ms)
  Rendered /Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout (19.5ms)


Started GET "/buy" for 127.0.0.1 at 2014-11-21 19:02:35 -0500
Processing by BuyController#index as HTML
  [1m[36mProduct Load (0.2ms)[0m  [1mSELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1[0m
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_checkout.html.erb (69.5ms)
  Rendered buy/index.html.erb within layouts/application (72.1ms)
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_stripe_header.html.erb (0.1ms)
Completed 200 OK in 122ms (Views: 120.5ms | ActiveRecord: 0.6ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-11-21 19:02:35 -0500


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-11-21 19:02:35 -0500


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-11-21 19:02:35 -0500


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-11-21 19:02:35 -0500


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-11-21 19:02:35 -0500


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-11-21 19:02:35 -0500


Started POST "/" for 127.0.0.1 at 2014-11-21 19:02:51 -0500
Processing by HomeController#index as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"pmeohcfXt8LFtx6fFfyT+rS/4J9mBIyGrp6DsNEfi/w=", "stripeEmail"=>"test@bugsplat.info"}
  Rendered home/index.html.erb within layouts/application (0.2ms)
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_stripe_header.html.erb (0.1ms)
Completed 200 OK in 92ms (Views: 92.1ms | ActiveRecord: 0.0ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-11-21 19:02:51 -0500


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-11-21 19:02:51 -0500


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-11-21 19:02:51 -0500


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-11-21 19:02:51 -0500


Started GET "/assets/payola/subscription_form.js?body=1" for 127.0.0.1 at 2014-11-21 19:02:51 -0500


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-11-21 19:02:51 -0500


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-11-21 19:02:51 -0500


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-11-21 19:02:51 -0500


Started GET "/buy" for 127.0.0.1 at 2014-11-21 19:03:19 -0500
Processing by BuyController#index as HTML
  [1m[35mProduct Load (0.2ms)[0m  SELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_checkout.html.erb (4.0ms)
  Rendered buy/index.html.erb within layouts/application (6.7ms)
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_stripe_header.html.erb (0.1ms)
Completed 200 OK in 123ms (Views: 121.8ms | ActiveRecord: 0.2ms)


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-11-21 19:03:19 -0500


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-11-21 19:03:19 -0500


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-11-21 19:03:19 -0500


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-11-21 19:03:19 -0500


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-11-21 19:03:19 -0500


Started GET "/assets/payola/subscription_form.js?body=1" for 127.0.0.1 at 2014-11-21 19:03:19 -0500


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-11-21 19:03:19 -0500


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-11-21 19:03:19 -0500


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-11-21 19:03:19 -0500


Started GET "/buy" for 127.0.0.1 at 2014-11-21 19:04:00 -0500
Processing by BuyController#index as HTML
  [1m[36mProduct Load (0.3ms)[0m  [1mSELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1[0m
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_checkout.html.erb (4.0ms)
  Rendered buy/index.html.erb within layouts/application (6.9ms)
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_stripe_header.html.erb (0.1ms)
Completed 200 OK in 172ms (Views: 170.8ms | ActiveRecord: 0.3ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-11-21 19:04:00 -0500


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-11-21 19:04:00 -0500


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-11-21 19:04:00 -0500


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-11-21 19:04:00 -0500


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-11-21 19:04:00 -0500


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-11-21 19:04:00 -0500


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-11-21 19:04:00 -0500


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-11-21 19:04:00 -0500


Started GET "/assets/payola/subscription_form.js?body=1" for 127.0.0.1 at 2014-11-21 19:04:00 -0500


Started GET "/buy" for 127.0.0.1 at 2014-11-21 19:04:02 -0500
Processing by BuyController#index as HTML
  [1m[35mProduct Load (0.2ms)[0m  SELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_checkout.html.erb (2.6ms)
  Rendered buy/index.html.erb within layouts/application (4.6ms)
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_stripe_header.html.erb (0.1ms)
Completed 200 OK in 66ms (Views: 65.0ms | ActiveRecord: 0.2ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-11-21 19:04:03 -0500


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-11-21 19:04:03 -0500


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-11-21 19:04:03 -0500


Started GET "/assets/payola/subscription_form.js?body=1" for 127.0.0.1 at 2014-11-21 19:04:03 -0500


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-11-21 19:04:03 -0500


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-11-21 19:04:03 -0500


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-11-21 19:04:03 -0500


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-11-21 19:04:03 -0500


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-11-21 19:04:03 -0500


Started POST "/subdir/payola/buy/product/foo" for 127.0.0.1 at 2014-11-21 19:04:19 -0500
Processing by Payola::TransactionsController#create as */*
  Parameters: {"stripeToken"=>"tok_151RNuBYGTZJSjsO0fuFJ7Cc", "stripeEmail"=>"pete@bugsplat.inf", "product_class"=>"product", "permalink"=>"foo"}
Can't verify CSRF token authenticity
Completed 422 Unprocessable Entity in 2ms

ActionController::InvalidAuthenticityToken (ActionController::InvalidAuthenticityToken):
  actionpack (4.1.6) lib/action_controller/metal/request_forgery_protection.rb:176:in `handle_unverified_request'
  actionpack (4.1.6) lib/action_controller/metal/request_forgery_protection.rb:202:in `handle_unverified_request'
  actionpack (4.1.6) lib/action_controller/metal/request_forgery_protection.rb:197:in `verify_authenticity_token'
  activesupport (4.1.6) lib/active_support/callbacks.rb:424:in `block in make_lambda'
  activesupport (4.1.6) lib/active_support/callbacks.rb:160:in `call'
  activesupport (4.1.6) lib/active_support/callbacks.rb:160:in `block in halting'
  activesupport (4.1.6) lib/active_support/callbacks.rb:86:in `call'
  activesupport (4.1.6) lib/active_support/callbacks.rb:86:in `run_callbacks'
  actionpack (4.1.6) lib/abstract_controller/callbacks.rb:19:in `process_action'
  actionpack (4.1.6) lib/action_controller/metal/rescue.rb:29:in `process_action'
  actionpack (4.1.6) lib/action_controller/metal/instrumentation.rb:31:in `block in process_action'
  activesupport (4.1.6) lib/active_support/notifications.rb:159:in `block in instrument'
  activesupport (4.1.6) lib/active_support/notifications/instrumenter.rb:20:in `instrument'
  activesupport (4.1.6) lib/active_support/notifications.rb:159:in `instrument'
  actionpack (4.1.6) lib/action_controller/metal/instrumentation.rb:30:in `process_action'
  actionpack (4.1.6) lib/action_controller/metal/params_wrapper.rb:250:in `process_action'
  activerecord (4.1.6) lib/active_record/railties/controller_runtime.rb:18:in `process_action'
  actionpack (4.1.6) lib/abstract_controller/base.rb:136:in `process'
  actionview (4.1.6) lib/action_view/rendering.rb:30:in `process'
  actionpack (4.1.6) lib/action_controller/metal.rb:196:in `dispatch'
  actionpack (4.1.6) lib/action_controller/metal/rack_delegation.rb:13:in `dispatch'
  actionpack (4.1.6) lib/action_controller/metal.rb:232:in `block in action'
  actionpack (4.1.6) lib/action_dispatch/routing/route_set.rb:82:in `call'
  actionpack (4.1.6) lib/action_dispatch/routing/route_set.rb:82:in `dispatch'
  actionpack (4.1.6) lib/action_dispatch/routing/route_set.rb:50:in `call'
  actionpack (4.1.6) lib/action_dispatch/journey/router.rb:73:in `block in call'
  actionpack (4.1.6) lib/action_dispatch/journey/router.rb:59:in `each'
  actionpack (4.1.6) lib/action_dispatch/journey/router.rb:59:in `call'
  actionpack (4.1.6) lib/action_dispatch/routing/route_set.rb:678:in `call'
  railties (4.1.6) lib/rails/engine.rb:514:in `call'
  railties (4.1.6) lib/rails/railtie.rb:194:in `public_send'
  railties (4.1.6) lib/rails/railtie.rb:194:in `method_missing'
  actionpack (4.1.6) lib/action_dispatch/journey/router.rb:73:in `block in call'
  actionpack (4.1.6) lib/action_dispatch/journey/router.rb:59:in `each'
  actionpack (4.1.6) lib/action_dispatch/journey/router.rb:59:in `call'
  actionpack (4.1.6) lib/action_dispatch/routing/route_set.rb:678:in `call'
  rack (1.5.2) lib/rack/etag.rb:23:in `call'
  rack (1.5.2) lib/rack/conditionalget.rb:35:in `call'
  rack (1.5.2) lib/rack/head.rb:11:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/params_parser.rb:27:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/flash.rb:254:in `call'
  rack (1.5.2) lib/rack/session/abstract/id.rb:225:in `context'
  rack (1.5.2) lib/rack/session/abstract/id.rb:220:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/cookies.rb:560:in `call'
  activerecord (4.1.6) lib/active_record/query_cache.rb:36:in `call'
  activerecord (4.1.6) lib/active_record/connection_adapters/abstract/connection_pool.rb:621:in `call'
  activerecord (4.1.6) lib/active_record/migration.rb:380:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/callbacks.rb:29:in `block in call'
  activesupport (4.1.6) lib/active_support/callbacks.rb:82:in `run_callbacks'
  actionpack (4.1.6) lib/action_dispatch/middleware/callbacks.rb:27:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/reloader.rb:73:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/remote_ip.rb:76:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/debug_exceptions.rb:17:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/show_exceptions.rb:30:in `call'
  railties (4.1.6) lib/rails/rack/logger.rb:38:in `call_app'
  railties (4.1.6) lib/rails/rack/logger.rb:20:in `block in call'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:68:in `block in tagged'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:26:in `tagged'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:68:in `tagged'
  railties (4.1.6) lib/rails/rack/logger.rb:20:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/request_id.rb:21:in `call'
  rack (1.5.2) lib/rack/methodoverride.rb:21:in `call'
  rack (1.5.2) lib/rack/runtime.rb:17:in `call'
  activesupport (4.1.6) lib/active_support/cache/strategy/local_cache_middleware.rb:26:in `call'
  rack (1.5.2) lib/rack/lock.rb:17:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/static.rb:64:in `call'
  rack (1.5.2) lib/rack/sendfile.rb:112:in `call'
  railties (4.1.6) lib/rails/engine.rb:514:in `call'
  railties (4.1.6) lib/rails/application.rb:144:in `call'
  rack (1.5.2) lib/rack/lock.rb:17:in `call'
  rack (1.5.2) lib/rack/content_length.rb:14:in `call'
  rack (1.5.2) lib/rack/handler/webrick.rb:60:in `service'
  /Users/peter/.rbenv/versions/2.1.2/lib/ruby/2.1.0/webrick/httpserver.rb:138:in `service'
  /Users/peter/.rbenv/versions/2.1.2/lib/ruby/2.1.0/webrick/httpserver.rb:94:in `run'
  /Users/peter/.rbenv/versions/2.1.2/lib/ruby/2.1.0/webrick/server.rb:295:in `block in start_thread'


  Rendered /Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_source.erb (0.8ms)
  Rendered /Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_trace.text.erb (0.7ms)
  Rendered /Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_request_and_response.text.erb (1.0ms)
  Rendered /Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/diagnostics.erb (18.8ms)


Started GET "/buy" for 127.0.0.1 at 2014-11-21 19:04:32 -0500
Processing by BuyController#index as HTML
  [1m[36mProduct Load (0.2ms)[0m  [1mSELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1[0m
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_checkout.html.erb (4.0ms)
  Rendered buy/index.html.erb within layouts/application (6.9ms)
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_stripe_header.html.erb (0.1ms)
Completed 200 OK in 84ms (Views: 82.4ms | ActiveRecord: 0.2ms)


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-11-21 19:04:32 -0500


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-11-21 19:04:32 -0500


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-11-21 19:04:32 -0500


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-11-21 19:04:32 -0500


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-11-21 19:04:32 -0500


Started GET "/assets/payola/subscription_form.js?body=1" for 127.0.0.1 at 2014-11-21 19:04:32 -0500


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-11-21 19:04:32 -0500


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-11-21 19:04:32 -0500


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-11-21 19:04:32 -0500


Started GET "/buy" for 127.0.0.1 at 2014-11-21 19:04:52 -0500
Processing by BuyController#index as HTML
  [1m[35mProduct Load (0.2ms)[0m  SELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_checkout.html.erb (3.6ms)
  Rendered buy/index.html.erb within layouts/application (6.5ms)
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_stripe_header.html.erb (0.2ms)
Completed 200 OK in 158ms (Views: 156.7ms | ActiveRecord: 0.2ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-11-21 19:04:53 -0500


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-11-21 19:04:53 -0500


Started GET "/assets/payola/subscription_form.js?body=1" for 127.0.0.1 at 2014-11-21 19:04:53 -0500


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-11-21 19:04:53 -0500


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-11-21 19:04:53 -0500


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-11-21 19:04:53 -0500


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-11-21 19:04:53 -0500


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-11-21 19:04:53 -0500


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-11-21 19:04:53 -0500


Started GET "/buy" for 127.0.0.1 at 2014-11-21 19:05:14 -0500
Processing by BuyController#index as HTML
  [1m[36mProduct Load (0.2ms)[0m  [1mSELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1[0m
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_checkout.html.erb (2.8ms)
  Rendered buy/index.html.erb within layouts/application (6.2ms)
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_stripe_header.html.erb (0.1ms)
Completed 200 OK in 59ms (Views: 58.2ms | ActiveRecord: 0.2ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-11-21 19:05:14 -0500


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-11-21 19:05:14 -0500


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-11-21 19:05:14 -0500


Started GET "/assets/payola/subscription_form.js?body=1" for 127.0.0.1 at 2014-11-21 19:05:14 -0500


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-11-21 19:05:14 -0500


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-11-21 19:05:14 -0500


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-11-21 19:05:14 -0500


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-11-21 19:05:14 -0500


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-11-21 19:05:14 -0500


Started POST "/subdir/payola/buy/product/foo" for 127.0.0.1 at 2014-11-21 19:05:27 -0500
Processing by Payola::TransactionsController#create as */*
  Parameters: {"stripeToken"=>"tok_151RP1BYGTZJSjsOUnMYcrbp", "stripeEmail"=>"pete@bugsplat.inf", "product_class"=>"product", "permalink"=>"foo"}
Can't verify CSRF token authenticity
Completed 422 Unprocessable Entity in 1ms

ActionController::InvalidAuthenticityToken (ActionController::InvalidAuthenticityToken):
  actionpack (4.1.6) lib/action_controller/metal/request_forgery_protection.rb:176:in `handle_unverified_request'
  actionpack (4.1.6) lib/action_controller/metal/request_forgery_protection.rb:202:in `handle_unverified_request'
  actionpack (4.1.6) lib/action_controller/metal/request_forgery_protection.rb:197:in `verify_authenticity_token'
  activesupport (4.1.6) lib/active_support/callbacks.rb:424:in `block in make_lambda'
  activesupport (4.1.6) lib/active_support/callbacks.rb:160:in `call'
  activesupport (4.1.6) lib/active_support/callbacks.rb:160:in `block in halting'
  activesupport (4.1.6) lib/active_support/callbacks.rb:86:in `call'
  activesupport (4.1.6) lib/active_support/callbacks.rb:86:in `run_callbacks'
  actionpack (4.1.6) lib/abstract_controller/callbacks.rb:19:in `process_action'
  actionpack (4.1.6) lib/action_controller/metal/rescue.rb:29:in `process_action'
  actionpack (4.1.6) lib/action_controller/metal/instrumentation.rb:31:in `block in process_action'
  activesupport (4.1.6) lib/active_support/notifications.rb:159:in `block in instrument'
  activesupport (4.1.6) lib/active_support/notifications/instrumenter.rb:20:in `instrument'
  activesupport (4.1.6) lib/active_support/notifications.rb:159:in `instrument'
  actionpack (4.1.6) lib/action_controller/metal/instrumentation.rb:30:in `process_action'
  actionpack (4.1.6) lib/action_controller/metal/params_wrapper.rb:250:in `process_action'
  activerecord (4.1.6) lib/active_record/railties/controller_runtime.rb:18:in `process_action'
  actionpack (4.1.6) lib/abstract_controller/base.rb:136:in `process'
  actionview (4.1.6) lib/action_view/rendering.rb:30:in `process'
  actionpack (4.1.6) lib/action_controller/metal.rb:196:in `dispatch'
  actionpack (4.1.6) lib/action_controller/metal/rack_delegation.rb:13:in `dispatch'
  actionpack (4.1.6) lib/action_controller/metal.rb:232:in `block in action'
  actionpack (4.1.6) lib/action_dispatch/routing/route_set.rb:82:in `call'
  actionpack (4.1.6) lib/action_dispatch/routing/route_set.rb:82:in `dispatch'
  actionpack (4.1.6) lib/action_dispatch/routing/route_set.rb:50:in `call'
  actionpack (4.1.6) lib/action_dispatch/journey/router.rb:73:in `block in call'
  actionpack (4.1.6) lib/action_dispatch/journey/router.rb:59:in `each'
  actionpack (4.1.6) lib/action_dispatch/journey/router.rb:59:in `call'
  actionpack (4.1.6) lib/action_dispatch/routing/route_set.rb:678:in `call'
  railties (4.1.6) lib/rails/engine.rb:514:in `call'
  railties (4.1.6) lib/rails/railtie.rb:194:in `public_send'
  railties (4.1.6) lib/rails/railtie.rb:194:in `method_missing'
  actionpack (4.1.6) lib/action_dispatch/journey/router.rb:73:in `block in call'
  actionpack (4.1.6) lib/action_dispatch/journey/router.rb:59:in `each'
  actionpack (4.1.6) lib/action_dispatch/journey/router.rb:59:in `call'
  actionpack (4.1.6) lib/action_dispatch/routing/route_set.rb:678:in `call'
  rack (1.5.2) lib/rack/etag.rb:23:in `call'
  rack (1.5.2) lib/rack/conditionalget.rb:35:in `call'
  rack (1.5.2) lib/rack/head.rb:11:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/params_parser.rb:27:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/flash.rb:254:in `call'
  rack (1.5.2) lib/rack/session/abstract/id.rb:225:in `context'
  rack (1.5.2) lib/rack/session/abstract/id.rb:220:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/cookies.rb:560:in `call'
  activerecord (4.1.6) lib/active_record/query_cache.rb:36:in `call'
  activerecord (4.1.6) lib/active_record/connection_adapters/abstract/connection_pool.rb:621:in `call'
  activerecord (4.1.6) lib/active_record/migration.rb:380:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/callbacks.rb:29:in `block in call'
  activesupport (4.1.6) lib/active_support/callbacks.rb:82:in `run_callbacks'
  actionpack (4.1.6) lib/action_dispatch/middleware/callbacks.rb:27:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/reloader.rb:73:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/remote_ip.rb:76:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/debug_exceptions.rb:17:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/show_exceptions.rb:30:in `call'
  railties (4.1.6) lib/rails/rack/logger.rb:38:in `call_app'
  railties (4.1.6) lib/rails/rack/logger.rb:20:in `block in call'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:68:in `block in tagged'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:26:in `tagged'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:68:in `tagged'
  railties (4.1.6) lib/rails/rack/logger.rb:20:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/request_id.rb:21:in `call'
  rack (1.5.2) lib/rack/methodoverride.rb:21:in `call'
  rack (1.5.2) lib/rack/runtime.rb:17:in `call'
  activesupport (4.1.6) lib/active_support/cache/strategy/local_cache_middleware.rb:26:in `call'
  rack (1.5.2) lib/rack/lock.rb:17:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/static.rb:64:in `call'
  rack (1.5.2) lib/rack/sendfile.rb:112:in `call'
  railties (4.1.6) lib/rails/engine.rb:514:in `call'
  railties (4.1.6) lib/rails/application.rb:144:in `call'
  rack (1.5.2) lib/rack/lock.rb:17:in `call'
  rack (1.5.2) lib/rack/content_length.rb:14:in `call'
  rack (1.5.2) lib/rack/handler/webrick.rb:60:in `service'
  /Users/peter/.rbenv/versions/2.1.2/lib/ruby/2.1.0/webrick/httpserver.rb:138:in `service'
  /Users/peter/.rbenv/versions/2.1.2/lib/ruby/2.1.0/webrick/httpserver.rb:94:in `run'
  /Users/peter/.rbenv/versions/2.1.2/lib/ruby/2.1.0/webrick/server.rb:295:in `block in start_thread'


  Rendered /Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_source.erb (1.1ms)
  Rendered /Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_trace.text.erb (0.9ms)
  Rendered /Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_request_and_response.text.erb (1.0ms)
  Rendered /Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/diagnostics.erb (21.4ms)


Started GET "/buy" for 127.0.0.1 at 2014-11-21 19:09:57 -0500
Processing by BuyController#index as HTML
  [1m[35mProduct Load (0.3ms)[0m  SELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_checkout.html.erb (2.5ms)
  Rendered buy/index.html.erb within layouts/application (4.5ms)
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_stripe_header.html.erb (0.1ms)
Completed 200 OK in 113ms (Views: 111.3ms | ActiveRecord: 0.3ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-11-21 19:09:57 -0500


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-11-21 19:09:57 -0500


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-11-21 19:09:57 -0500


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-11-21 19:09:57 -0500


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-11-21 19:09:57 -0500


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-11-21 19:09:57 -0500


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-11-21 19:09:57 -0500


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-11-21 19:09:57 -0500


Started GET "/assets/payola/subscription_form.js?body=1" for 127.0.0.1 at 2014-11-21 19:09:57 -0500


Started POST "/subdir/payola/buy/product/foo" for 127.0.0.1 at 2014-11-21 19:10:13 -0500
Processing by Payola::TransactionsController#create as */*
  Parameters: {"stripeToken"=>"tok_151RTdBYGTZJSjsOONhGZr46", "stripeEmail"=>"pete@bugsplat.info", "product_class"=>"product", "permalink"=>"foo"}
Can't verify CSRF token authenticity
Completed 422 Unprocessable Entity in 1ms

ActionController::InvalidAuthenticityToken (ActionController::InvalidAuthenticityToken):
  actionpack (4.1.6) lib/action_controller/metal/request_forgery_protection.rb:176:in `handle_unverified_request'
  actionpack (4.1.6) lib/action_controller/metal/request_forgery_protection.rb:202:in `handle_unverified_request'
  actionpack (4.1.6) lib/action_controller/metal/request_forgery_protection.rb:197:in `verify_authenticity_token'
  activesupport (4.1.6) lib/active_support/callbacks.rb:424:in `block in make_lambda'
  activesupport (4.1.6) lib/active_support/callbacks.rb:160:in `call'
  activesupport (4.1.6) lib/active_support/callbacks.rb:160:in `block in halting'
  activesupport (4.1.6) lib/active_support/callbacks.rb:86:in `call'
  activesupport (4.1.6) lib/active_support/callbacks.rb:86:in `run_callbacks'
  actionpack (4.1.6) lib/abstract_controller/callbacks.rb:19:in `process_action'
  actionpack (4.1.6) lib/action_controller/metal/rescue.rb:29:in `process_action'
  actionpack (4.1.6) lib/action_controller/metal/instrumentation.rb:31:in `block in process_action'
  activesupport (4.1.6) lib/active_support/notifications.rb:159:in `block in instrument'
  activesupport (4.1.6) lib/active_support/notifications/instrumenter.rb:20:in `instrument'
  activesupport (4.1.6) lib/active_support/notifications.rb:159:in `instrument'
  actionpack (4.1.6) lib/action_controller/metal/instrumentation.rb:30:in `process_action'
  actionpack (4.1.6) lib/action_controller/metal/params_wrapper.rb:250:in `process_action'
  activerecord (4.1.6) lib/active_record/railties/controller_runtime.rb:18:in `process_action'
  actionpack (4.1.6) lib/abstract_controller/base.rb:136:in `process'
  actionview (4.1.6) lib/action_view/rendering.rb:30:in `process'
  actionpack (4.1.6) lib/action_controller/metal.rb:196:in `dispatch'
  actionpack (4.1.6) lib/action_controller/metal/rack_delegation.rb:13:in `dispatch'
  actionpack (4.1.6) lib/action_controller/metal.rb:232:in `block in action'
  actionpack (4.1.6) lib/action_dispatch/routing/route_set.rb:82:in `call'
  actionpack (4.1.6) lib/action_dispatch/routing/route_set.rb:82:in `dispatch'
  actionpack (4.1.6) lib/action_dispatch/routing/route_set.rb:50:in `call'
  actionpack (4.1.6) lib/action_dispatch/journey/router.rb:73:in `block in call'
  actionpack (4.1.6) lib/action_dispatch/journey/router.rb:59:in `each'
  actionpack (4.1.6) lib/action_dispatch/journey/router.rb:59:in `call'
  actionpack (4.1.6) lib/action_dispatch/routing/route_set.rb:678:in `call'
  railties (4.1.6) lib/rails/engine.rb:514:in `call'
  railties (4.1.6) lib/rails/railtie.rb:194:in `public_send'
  railties (4.1.6) lib/rails/railtie.rb:194:in `method_missing'
  actionpack (4.1.6) lib/action_dispatch/journey/router.rb:73:in `block in call'
  actionpack (4.1.6) lib/action_dispatch/journey/router.rb:59:in `each'
  actionpack (4.1.6) lib/action_dispatch/journey/router.rb:59:in `call'
  actionpack (4.1.6) lib/action_dispatch/routing/route_set.rb:678:in `call'
  rack (1.5.2) lib/rack/etag.rb:23:in `call'
  rack (1.5.2) lib/rack/conditionalget.rb:35:in `call'
  rack (1.5.2) lib/rack/head.rb:11:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/params_parser.rb:27:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/flash.rb:254:in `call'
  rack (1.5.2) lib/rack/session/abstract/id.rb:225:in `context'
  rack (1.5.2) lib/rack/session/abstract/id.rb:220:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/cookies.rb:560:in `call'
  activerecord (4.1.6) lib/active_record/query_cache.rb:36:in `call'
  activerecord (4.1.6) lib/active_record/connection_adapters/abstract/connection_pool.rb:621:in `call'
  activerecord (4.1.6) lib/active_record/migration.rb:380:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/callbacks.rb:29:in `block in call'
  activesupport (4.1.6) lib/active_support/callbacks.rb:82:in `run_callbacks'
  actionpack (4.1.6) lib/action_dispatch/middleware/callbacks.rb:27:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/reloader.rb:73:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/remote_ip.rb:76:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/debug_exceptions.rb:17:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/show_exceptions.rb:30:in `call'
  railties (4.1.6) lib/rails/rack/logger.rb:38:in `call_app'
  railties (4.1.6) lib/rails/rack/logger.rb:20:in `block in call'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:68:in `block in tagged'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:26:in `tagged'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:68:in `tagged'
  railties (4.1.6) lib/rails/rack/logger.rb:20:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/request_id.rb:21:in `call'
  rack (1.5.2) lib/rack/methodoverride.rb:21:in `call'
  rack (1.5.2) lib/rack/runtime.rb:17:in `call'
  activesupport (4.1.6) lib/active_support/cache/strategy/local_cache_middleware.rb:26:in `call'
  rack (1.5.2) lib/rack/lock.rb:17:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/static.rb:64:in `call'
  rack (1.5.2) lib/rack/sendfile.rb:112:in `call'
  railties (4.1.6) lib/rails/engine.rb:514:in `call'
  railties (4.1.6) lib/rails/application.rb:144:in `call'
  rack (1.5.2) lib/rack/lock.rb:17:in `call'
  rack (1.5.2) lib/rack/content_length.rb:14:in `call'
  rack (1.5.2) lib/rack/handler/webrick.rb:60:in `service'
  /Users/peter/.rbenv/versions/2.1.2/lib/ruby/2.1.0/webrick/httpserver.rb:138:in `service'
  /Users/peter/.rbenv/versions/2.1.2/lib/ruby/2.1.0/webrick/httpserver.rb:94:in `run'
  /Users/peter/.rbenv/versions/2.1.2/lib/ruby/2.1.0/webrick/server.rb:295:in `block in start_thread'


  Rendered /Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_source.erb (0.9ms)
  Rendered /Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_trace.text.erb (0.6ms)
  Rendered /Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_request_and_response.text.erb (0.7ms)
  Rendered /Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/diagnostics.erb (13.8ms)


Started GET "/buy" for 127.0.0.1 at 2014-11-21 19:10:37 -0500
Processing by BuyController#index as HTML
  [1m[36mProduct Load (0.2ms)[0m  [1mSELECT  "products".* FROM "products"   ORDER BY "products"."id" ASC LIMIT 1[0m
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_checkout.html.erb (2.0ms)
  Rendered buy/index.html.erb within layouts/application (3.5ms)
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_stripe_header.html.erb (0.1ms)
Completed 200 OK in 104ms (Views: 103.3ms | ActiveRecord: 0.2ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-11-21 19:10:37 -0500


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-11-21 19:10:37 -0500


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-11-21 19:10:37 -0500


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-11-21 19:10:37 -0500


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-11-21 19:10:37 -0500


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-11-21 19:10:37 -0500


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-11-21 19:10:37 -0500


Started GET "/assets/payola/subscription_form.js?body=1" for 127.0.0.1 at 2014-11-21 19:10:37 -0500


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-11-21 19:10:37 -0500


Started POST "/subdir/payola/buy/product/foo" for 127.0.0.1 at 2014-11-21 19:10:50 -0500
Processing by Payola::TransactionsController#create as */*
  Parameters: {"stripeToken"=>"tok_151RUDBYGTZJSjsOsZ3etQ0l", "stripeEmail"=>"pete@bugsplat.info", "authenticity_token"=>"qEb90ljOPy3MTsdR6VWrm0ddvJoxz36Lr9kY37d9f80=", "product_class"=>"product", "permalink"=>"foo"}
  [1m[35mPayola::Affiliate Load (0.4ms)[0m  SELECT  "payola_affiliates".* FROM "payola_affiliates"  WHERE (lower(code) = lower('pa1'))  ORDER BY "payola_affiliates"."id" ASC LIMIT 1
  [1m[36mProduct Load (0.1ms)[0m  [1mSELECT  "products".* FROM "products"  WHERE "products"."permalink" = 'foo' LIMIT 1[0m
  [1m[35mPayola::Coupon Load (0.5ms)[0m  SELECT  "payola_coupons".* FROM "payola_coupons"  WHERE (lower(code) = lower(NULL))  ORDER BY "payola_coupons"."id" ASC LIMIT 1
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPayola::Sale Exists (0.5ms)[0m  SELECT  1 AS one FROM "payola_sales"  WHERE "payola_sales"."guid" IS NULL LIMIT 1
  [1m[36mCACHE (0.0ms)[0m  [1mSELECT  1 AS one FROM "payola_sales"  WHERE "payola_sales"."guid" IS NULL LIMIT 1[0m
  [1m[35mPayola::Sale Exists (0.1ms)[0m  SELECT  1 AS one FROM "payola_sales"  WHERE "payola_sales"."guid" = 'ktqunp' LIMIT 1
  [1m[36mSQL (2.3ms)[0m  [1mINSERT INTO "payola_sales" ("amount", "created_at", "currency", "email", "guid", "product_id", "product_type", "state", "stripe_token", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)[0m  [["amount", 100], ["created_at", "2014-11-22 00:10:50.290542"], ["currency", "usd"], ["email", "pete@bugsplat.info"], ["guid", "ktqunp"], ["product_id", 1], ["product_type", "Product"], ["state", "pending"], ["stripe_token", "tok_151RUDBYGTZJSjsOsZ3etQ0l"], ["updated_at", "2014-11-22 00:10:50.290542"]]
  [1m[35m (1.5ms)[0m  commit transaction
Completed 200 OK in 127ms (Views: 0.4ms | ActiveRecord: 6.0ms)
  [1m[36mPayola::Sale Load (0.2ms)[0m  [1mSELECT  "payola_sales".* FROM "payola_sales"  WHERE "payola_sales"."guid" = 'ktqunp' LIMIT 1[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "payola_sales" SET "state" = 'processing' WHERE "payola_sales"."id" = 5[0m
  [1m[35mPayola::Sale Exists (0.1ms)[0m  SELECT  1 AS one FROM "payola_sales"  WHERE ("payola_sales"."guid" = 'ktqunp' AND "payola_sales"."id" != 5) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "payola_sales" SET "state" = ?, "updated_at" = ? WHERE "payola_sales"."id" = 5[0m  [["state", "processing"], ["updated_at", "2014-11-22 00:10:50.370209"]]


Started GET "/subdir/payola/status/ktqunp" for 127.0.0.1 at 2014-11-21 19:10:50 -0500
Processing by Payola::TransactionsController#status as */*
  Parameters: {"guid"=>"ktqunp"}
  [1m[35mPayola::Affiliate Load (0.2ms)[0m  SELECT  "payola_affiliates".* FROM "payola_affiliates"  WHERE (lower(code) = lower('pa1'))  ORDER BY "payola_affiliates"."id" ASC LIMIT 1
  [1m[36mPayola::Sale Load (0.3ms)[0m  [1mSELECT  "payola_sales".* FROM "payola_sales"  WHERE "payola_sales"."guid" = 'ktqunp' LIMIT 1[0m
Completed 200 OK in 40ms (Views: 0.3ms | ActiveRecord: 0.5ms)


Started GET "/subdir/payola/status/ktqunp" for 127.0.0.1 at 2014-11-21 19:10:50 -0500
Processing by Payola::TransactionsController#status as */*
  Parameters: {"guid"=>"ktqunp"}
  [1m[35mPayola::Affiliate Load (0.2ms)[0m  SELECT  "payola_affiliates".* FROM "payola_affiliates"  WHERE (lower(code) = lower('pa1'))  ORDER BY "payola_affiliates"."id" ASC LIMIT 1
  [1m[36mPayola::Sale Load (0.2ms)[0m  [1mSELECT  "payola_sales".* FROM "payola_sales"  WHERE "payola_sales"."guid" = 'ktqunp' LIMIT 1[0m
Completed 200 OK in 3ms (Views: 0.3ms | ActiveRecord: 0.4ms)


Started GET "/subdir/payola/status/ktqunp" for 127.0.0.1 at 2014-11-21 19:10:51 -0500
Processing by Payola::TransactionsController#status as */*
  Parameters: {"guid"=>"ktqunp"}
  [1m[35mPayola::Affiliate Load (0.2ms)[0m  SELECT  "payola_affiliates".* FROM "payola_affiliates"  WHERE (lower(code) = lower('pa1'))  ORDER BY "payola_affiliates"."id" ASC LIMIT 1
  [1m[36mPayola::Sale Load (0.2ms)[0m  [1mSELECT  "payola_sales".* FROM "payola_sales"  WHERE "payola_sales"."guid" = 'ktqunp' LIMIT 1[0m
Completed 200 OK in 3ms (Views: 0.3ms | ActiveRecord: 0.4ms)


Started GET "/subdir/payola/status/ktqunp" for 127.0.0.1 at 2014-11-21 19:10:51 -0500
Processing by Payola::TransactionsController#status as */*
  Parameters: {"guid"=>"ktqunp"}
  [1m[35mPayola::Affiliate Load (0.2ms)[0m  SELECT  "payola_affiliates".* FROM "payola_affiliates"  WHERE (lower(code) = lower('pa1'))  ORDER BY "payola_affiliates"."id" ASC LIMIT 1
  [1m[36mPayola::Sale Load (0.2ms)[0m  [1mSELECT  "payola_sales".* FROM "payola_sales"  WHERE "payola_sales"."guid" = 'ktqunp' LIMIT 1[0m
Completed 200 OK in 3ms (Views: 0.3ms | ActiveRecord: 0.4ms)
  [1m[35mPayola::Sale Exists (0.2ms)[0m  SELECT  1 AS one FROM "payola_sales"  WHERE ("payola_sales"."guid" = 'ktqunp' AND "payola_sales"."id" != 5) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "payola_sales" SET "card_expiration" = ?, "card_last4" = ?, "card_type" = ?, "fee_amount" = ?, "stripe_customer_id" = ?, "stripe_id" = ?, "updated_at" = ? WHERE "payola_sales"."id" = 5[0m  [["card_expiration", "2034-12-01"], ["card_last4", "4242"], ["card_type", "Visa"], ["fee_amount", 33], ["stripe_customer_id", "cus_5Bp8xw4jUWMD0P"], ["stripe_id", "ch_151RUFBYGTZJSjsODNJQuGBT"], ["updated_at", "2014-11-22 00:10:52.206961"]]
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (1.1ms)[0m  [1mUPDATE "payola_sales" SET "state" = 'finished' WHERE "payola_sales"."id" = 5[0m
  [1m[35mProduct Load (0.4ms)[0m  SELECT  "products".* FROM "products"  WHERE "products"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36m (0.0ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.9ms)[0m  commit transaction


Started GET "/subdir/payola/status/ktqunp" for 127.0.0.1 at 2014-11-21 19:10:52 -0500
Processing by Payola::TransactionsController#status as */*
  Parameters: {"guid"=>"ktqunp"}
  [1m[36mPayola::Affiliate Load (0.2ms)[0m  [1mSELECT  "payola_affiliates".* FROM "payola_affiliates"  WHERE (lower(code) = lower('pa1'))  ORDER BY "payola_affiliates"."id" ASC LIMIT 1[0m
  [1m[35mPayola::Sale Load (0.2ms)[0m  SELECT  "payola_sales".* FROM "payola_sales"  WHERE "payola_sales"."guid" = 'ktqunp' LIMIT 1
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.4ms)


Started POST "/" for 127.0.0.1 at 2014-11-21 19:10:52 -0500
Processing by HomeController#index as HTML
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"qEb90ljOPy3MTsdR6VWrm0ddvJoxz36Lr9kY37d9f80=", "stripeEmail"=>"pete@bugsplat.info", "payola_sale_guid"=>"ktqunp"}
  Rendered home/index.html.erb within layouts/application (0.2ms)
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_stripe_header.html.erb (0.1ms)
Completed 200 OK in 43ms (Views: 43.1ms | ActiveRecord: 0.0ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-11-21 19:10:52 -0500


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-11-21 19:10:52 -0500


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-11-21 19:10:52 -0500


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-11-21 19:10:52 -0500


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-11-21 19:10:52 -0500


Started GET "/assets/payola/subscription_form.js?body=1" for 127.0.0.1 at 2014-11-21 19:10:52 -0500


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-11-21 19:10:52 -0500


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-11-21 19:10:52 -0500


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-11-21 19:10:52 -0500
Terminating 3 actors...
  [1m[36mProduct Load (0.6ms)[0m  [1mSELECT  "products".* FROM "products"   ORDER BY "products"."id" DESC LIMIT 1[0m


Started GET "/" for 127.0.0.1 at 2014-11-25 16:44:09 -0500
  [1m[36mActiveRecord::SchemaMigration Load (0.5ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Processing by HomeController#index as HTML
  Rendered home/index.html.erb within layouts/application (1.9ms)
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_stripe_header.html.erb (0.4ms)
Completed 200 OK in 136ms (Views: 135.3ms | ActiveRecord: 0.0ms)


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-11-25 16:44:09 -0500


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-11-25 16:44:09 -0500


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-11-25 16:44:09 -0500


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-11-25 16:44:09 -0500


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-11-25 16:44:09 -0500


Started GET "/assets/payola/subscription_form.js?body=1" for 127.0.0.1 at 2014-11-25 16:44:09 -0500


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-11-25 16:44:09 -0500


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-11-25 16:44:09 -0500


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-11-25 16:44:09 -0500


Started GET "/subscribe" for 127.0.0.1 at 2014-11-25 16:44:13 -0500
Processing by SubscribeController#index as HTML
  [1m[35mSubscriptionPlan Load (0.6ms)[0m  SELECT  "subscription_plans".* FROM "subscription_plans"   ORDER BY "subscription_plans"."id" ASC LIMIT 1
  Rendered subscribe/index.html.erb within layouts/application (3.1ms)
Completed 500 Internal Server Error in 15ms

ActionView::Template::Error (undefined method `plan_class' for nil:NilClass):
    2: 
    3: <hr>
    4: 
    5: <%= form_for @plan, url: '/', method: :post, html: { class: 'payola-subscription-form', 'data-payola-base-path' => '/subdir/payola', 'data-payola-plan-type' => @plan.plan_class, 'data-payola-plan-id' => @plan.id } do |f| %>
    6:   <span class="payola-payment-error"></span>
    7:   Email:<br>
    8:   <input type="email" name="stripeEmail" data-payola="email"></input><br>
  app/views/subscribe/index.html.erb:5:in `_app_views_subscribe_index_html_erb___3778246022795363001_70332745550660'


  Rendered /Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb (1.4ms)
  Rendered /Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb (1.7ms)
  Rendered /Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/template_error.html.erb within rescues/layout (13.2ms)
  [1m[36m (0.2ms)[0m  [1mbegin transaction[0m
  [1m[35mSubscriptionPlan Exists (0.1ms)[0m  SELECT  1 AS one FROM "subscription_plans"  WHERE "subscription_plans"."stripe_id" = 'test' LIMIT 1
  [1m[36m (0.0ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mSubscriptionPlan Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "subscription_plans"  WHERE "subscription_plans"."stripe_id" = 'test' LIMIT 1[0m
  [1m[35m (0.0ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mSubscriptionPlan Exists (0.1ms)[0m  SELECT  1 AS one FROM "subscription_plans"  WHERE "subscription_plans"."stripe_id" = 'test' LIMIT 1
  [1m[36mSQL (0.9ms)[0m  [1mINSERT INTO "subscription_plans" ("amount", "created_at", "interval", "interval_count", "name", "stripe_id", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["amount", 100], ["created_at", "2014-11-25 21:52:16.521359"], ["interval", "month"], ["interval_count", 1], ["name", "Test"], ["stripe_id", "test"], ["updated_at", "2014-11-25 21:52:16.521359"]]
  [1m[35m (0.9ms)[0m  commit transaction


Started GET "/subscribe" for 127.0.0.1 at 2014-11-25 16:52:21 -0500
Processing by SubscribeController#index as HTML
  [1m[36mSubscriptionPlan Load (0.3ms)[0m  [1mSELECT  "subscription_plans".* FROM "subscription_plans"   ORDER BY "subscription_plans"."id" ASC LIMIT 1[0m
  Rendered subscribe/index.html.erb within layouts/application (2.3ms)
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_stripe_header.html.erb (0.1ms)
Completed 200 OK in 52ms (Views: 42.6ms | ActiveRecord: 0.4ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-11-25 16:52:21 -0500


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-11-25 16:52:21 -0500


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-11-25 16:52:21 -0500


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-11-25 16:52:21 -0500


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-11-25 16:52:21 -0500


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-11-25 16:52:21 -0500


Started GET "/assets/payola/subscription_form.js?body=1" for 127.0.0.1 at 2014-11-25 16:52:21 -0500


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-11-25 16:52:21 -0500


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-11-25 16:52:21 -0500


Started POST "/subscribe" for 127.0.0.1 at 2014-11-25 16:52:37 -0500

ActionController::RoutingError (No route matches [POST] "/subscribe"):
  actionpack (4.1.6) lib/action_dispatch/middleware/debug_exceptions.rb:21:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/show_exceptions.rb:30:in `call'
  railties (4.1.6) lib/rails/rack/logger.rb:38:in `call_app'
  railties (4.1.6) lib/rails/rack/logger.rb:20:in `block in call'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:68:in `block in tagged'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:26:in `tagged'
  activesupport (4.1.6) lib/active_support/tagged_logging.rb:68:in `tagged'
  railties (4.1.6) lib/rails/rack/logger.rb:20:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/request_id.rb:21:in `call'
  rack (1.5.2) lib/rack/methodoverride.rb:21:in `call'
  rack (1.5.2) lib/rack/runtime.rb:17:in `call'
  activesupport (4.1.6) lib/active_support/cache/strategy/local_cache_middleware.rb:26:in `call'
  rack (1.5.2) lib/rack/lock.rb:17:in `call'
  actionpack (4.1.6) lib/action_dispatch/middleware/static.rb:64:in `call'
  rack (1.5.2) lib/rack/sendfile.rb:112:in `call'
  railties (4.1.6) lib/rails/engine.rb:514:in `call'
  railties (4.1.6) lib/rails/application.rb:144:in `call'
  rack (1.5.2) lib/rack/lock.rb:17:in `call'
  rack (1.5.2) lib/rack/content_length.rb:14:in `call'
  rack (1.5.2) lib/rack/handler/webrick.rb:60:in `service'
  /Users/peter/.rbenv/versions/2.1.2/lib/ruby/2.1.0/webrick/httpserver.rb:138:in `service'
  /Users/peter/.rbenv/versions/2.1.2/lib/ruby/2.1.0/webrick/httpserver.rb:94:in `run'
  /Users/peter/.rbenv/versions/2.1.2/lib/ruby/2.1.0/webrick/server.rb:295:in `block in start_thread'


  Rendered /Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/_trace.text.erb (0.8ms)
  Rendered /Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/actionpack-4.1.6/lib/action_dispatch/middleware/templates/rescues/routing_error.text.erb (4.4ms)


Started GET "/subscribe" for 127.0.0.1 at 2014-11-25 16:53:21 -0500
Processing by SubscribeController#index as HTML
  [1m[35mSubscriptionPlan Load (0.1ms)[0m  SELECT  "subscription_plans".* FROM "subscription_plans"   ORDER BY "subscription_plans"."id" ASC LIMIT 1
  Rendered subscribe/index.html.erb within layouts/application (1.4ms)
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_stripe_header.html.erb (0.1ms)
Completed 200 OK in 45ms (Views: 35.9ms | ActiveRecord: 0.7ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-11-25 16:53:21 -0500


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-11-25 16:53:21 -0500


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-11-25 16:53:21 -0500


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-11-25 16:53:21 -0500


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-11-25 16:53:21 -0500


Started GET "/assets/payola/subscription_form.js?body=1" for 127.0.0.1 at 2014-11-25 16:53:21 -0500


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-11-25 16:53:21 -0500


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-11-25 16:53:21 -0500


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-11-25 16:53:21 -0500


Started POST "/subscribe" for 127.0.0.1 at 2014-11-25 16:53:36 -0500
Processing by SubscribeController#create as */*
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"pmeohcfXt8LFtx6fFfyT+rS/4J9mBIyGrp6DsNEfi/w=", "stripeEmail"=>"test@bugsplat.info", "coupon"=>"", "stripeToken"=>"tok_152rFcBYGTZJSjsO3rxUywLC"}
  [1m[36mSubscriptionPlan Load (0.2ms)[0m  [1mSELECT  "subscription_plans".* FROM "subscription_plans"   ORDER BY "subscription_plans"."id" ASC LIMIT 1[0m
  [1m[35mPayola::Subscription Load (0.5ms)[0m  SELECT  "payola_subscriptions".* FROM "payola_subscriptions"  WHERE "payola_subscriptions"."guid" IS NULL LIMIT 1
Payola::Worker::SuckerPunch crashed!
NoMethodError: undefined method `process!' for nil:NilClass
	/Users/peter/devel/payola/app/services/payola/process_subscription.rb:4:in `call'
	/Users/peter/devel/payola/lib/payola/worker/base.rb:5:in `perform'
	/Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/celluloid-0.15.2/lib/celluloid/calls.rb:25:in `public_send'
	/Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/celluloid-0.15.2/lib/celluloid/calls.rb:25:in `dispatch'
	/Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/celluloid-0.15.2/lib/celluloid/calls.rb:67:in `dispatch'
	/Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/celluloid-0.15.2/lib/celluloid/actor.rb:322:in `block in handle_message'
	/Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/celluloid-0.15.2/lib/celluloid/actor.rb:416:in `block in task'
	/Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/celluloid-0.15.2/lib/celluloid/tasks.rb:55:in `block in initialize'
	/Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/celluloid-0.15.2/lib/celluloid/tasks/task_fiber.rb:13:in `block in create'
Celluloid::PoolManager: async call `perform` aborted!
NoMethodError: undefined method `process!' for nil:NilClass
	/Users/peter/devel/payola/app/services/payola/process_subscription.rb:4:in `call'
	/Users/peter/devel/payola/lib/payola/worker/base.rb:5:in `perform'
	/Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/celluloid-0.15.2/lib/celluloid/calls.rb:25:in `public_send'
	/Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/celluloid-0.15.2/lib/celluloid/calls.rb:25:in `dispatch'
	/Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/celluloid-0.15.2/lib/celluloid/calls.rb:67:in `dispatch'
	/Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/celluloid-0.15.2/lib/celluloid/actor.rb:322:in `block in handle_message'
	/Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/celluloid-0.15.2/lib/celluloid/actor.rb:416:in `block in task'
	/Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/celluloid-0.15.2/lib/celluloid/tasks.rb:55:in `block in initialize'
	/Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/celluloid-0.15.2/lib/celluloid/tasks/task_fiber.rb:13:in `block in create'
	(celluloid):0:in `remote procedure call'
	/Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/celluloid-0.15.2/lib/celluloid/calls.rb:92:in `value'
	/Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/celluloid-0.15.2/lib/celluloid/proxies/sync_proxy.rb:33:in `method_missing'
	/Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/celluloid-0.15.2/lib/celluloid/proxies/actor_proxy.rb:20:in `_send_'
	/Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/celluloid-0.15.2/lib/celluloid/pool_manager.rb:41:in `_send_'
	/Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/celluloid-0.15.2/lib/celluloid/pool_manager.rb:123:in `method_missing'
	/Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/celluloid-0.15.2/lib/celluloid/calls.rb:25:in `public_send'
	/Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/celluloid-0.15.2/lib/celluloid/calls.rb:25:in `dispatch'
	/Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/celluloid-0.15.2/lib/celluloid/calls.rb:122:in `dispatch'
	/Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/celluloid-0.15.2/lib/celluloid/actor.rb:322:in `block in handle_message'
	/Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/celluloid-0.15.2/lib/celluloid/actor.rb:416:in `block in task'
	/Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/celluloid-0.15.2/lib/celluloid/tasks.rb:55:in `block in initialize'
	/Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/celluloid-0.15.2/lib/celluloid/tasks/task_fiber.rb:13:in `block in create'
Completed 200 OK in 99ms (Views: 0.2ms | ActiveRecord: 0.7ms)


Started GET "/subdir/payola/subscription_status/null" for 127.0.0.1 at 2014-11-25 16:53:36 -0500
Processing by Payola::SubscriptionsController#status as */*
  Parameters: {"guid"=>"null"}
  [1m[36mPayola::Affiliate Load (0.5ms)[0m  [1mSELECT  "payola_affiliates".* FROM "payola_affiliates"  WHERE (lower(code) = lower(NULL))  ORDER BY "payola_affiliates"."id" ASC LIMIT 1[0m
  [1m[35mPayola::Subscription Load (0.2ms)[0m  SELECT  "payola_subscriptions".* FROM "payola_subscriptions"  WHERE "payola_subscriptions"."guid" = 'null' LIMIT 1
  Rendered text template (0.0ms)
Completed 404 Not Found in 8ms (Views: 1.7ms | ActiveRecord: 0.9ms)


Started GET "/subscribe" for 127.0.0.1 at 2014-11-25 16:54:26 -0500
Processing by SubscribeController#index as HTML
  [1m[36mSubscriptionPlan Load (0.2ms)[0m  [1mSELECT  "subscription_plans".* FROM "subscription_plans"   ORDER BY "subscription_plans"."id" ASC LIMIT 1[0m
  Rendered subscribe/index.html.erb within layouts/application (1.5ms)
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_stripe_header.html.erb (0.1ms)
Completed 200 OK in 89ms (Views: 86.8ms | ActiveRecord: 0.2ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-11-25 16:54:26 -0500


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-11-25 16:54:26 -0500


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-11-25 16:54:26 -0500


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-11-25 16:54:27 -0500


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-11-25 16:54:27 -0500


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-11-25 16:54:27 -0500


Started GET "/assets/payola/subscription_form.js?body=1" for 127.0.0.1 at 2014-11-25 16:54:27 -0500


Started GET "/assets/payola/checkout_button.js?body=1" for 127.0.0.1 at 2014-11-25 16:54:27 -0500


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-11-25 16:54:27 -0500


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-11-25 16:54:31 -0500


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-11-25 16:54:31 -0500


Started POST "/subscribe" for 127.0.0.1 at 2014-11-25 16:54:52 -0500
Processing by SubscribeController#create as */*
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"rBkAQhkOB4WJz7LpfiSQGAv0EGg0QyEIqt/gfXaSXuw=", "stripeEmail"=>"testing@bugsplat.info", "coupon"=>"", "stripeToken"=>"tok_152rGqBYGTZJSjsOQzyW1Pyv"}
  [1m[35mSubscriptionPlan Load (0.2ms)[0m  SELECT  "subscription_plans".* FROM "subscription_plans"   ORDER BY "subscription_plans"."id" ASC LIMIT 1
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.2ms)
  [1m[36mPayola::Subscription Load (0.3ms)[0m  [1mSELECT  "payola_subscriptions".* FROM "payola_subscriptions"  WHERE "payola_subscriptions"."guid" IS NULL LIMIT 1[0m
Payola::Worker::SuckerPunch crashed!
NoMethodError: undefined method `process!' for nil:NilClass
	/Users/peter/devel/payola/app/services/payola/process_subscription.rb:4:in `call'
	/Users/peter/devel/payola/lib/payola/worker/base.rb:5:in `perform'
	/Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/celluloid-0.15.2/lib/celluloid/calls.rb:25:in `public_send'
	/Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/celluloid-0.15.2/lib/celluloid/calls.rb:25:in `dispatch'
	/Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/celluloid-0.15.2/lib/celluloid/calls.rb:67:in `dispatch'
	/Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/celluloid-0.15.2/lib/celluloid/actor.rb:322:in `block in handle_message'
	/Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/celluloid-0.15.2/lib/celluloid/actor.rb:416:in `block in task'
	/Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/celluloid-0.15.2/lib/celluloid/tasks.rb:55:in `block in initialize'
	/Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/celluloid-0.15.2/lib/celluloid/tasks/task_fiber.rb:13:in `block in create'
Celluloid::PoolManager: async call `perform` aborted!
NoMethodError: undefined method `process!' for nil:NilClass
	/Users/peter/devel/payola/app/services/payola/process_subscription.rb:4:in `call'
	/Users/peter/devel/payola/lib/payola/worker/base.rb:5:in `perform'
	/Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/celluloid-0.15.2/lib/celluloid/calls.rb:25:in `public_send'
	/Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/celluloid-0.15.2/lib/celluloid/calls.rb:25:in `dispatch'
	/Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/celluloid-0.15.2/lib/celluloid/calls.rb:67:in `dispatch'
	/Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/celluloid-0.15.2/lib/celluloid/actor.rb:322:in `block in handle_message'
	/Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/celluloid-0.15.2/lib/celluloid/actor.rb:416:in `block in task'
	/Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/celluloid-0.15.2/lib/celluloid/tasks.rb:55:in `block in initialize'
	/Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/celluloid-0.15.2/lib/celluloid/tasks/task_fiber.rb:13:in `block in create'
	(celluloid):0:in `remote procedure call'
	/Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/celluloid-0.15.2/lib/celluloid/calls.rb:92:in `value'
	/Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/celluloid-0.15.2/lib/celluloid/proxies/sync_proxy.rb:33:in `method_missing'
	/Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/celluloid-0.15.2/lib/celluloid/proxies/actor_proxy.rb:20:in `_send_'
	/Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/celluloid-0.15.2/lib/celluloid/pool_manager.rb:41:in `_send_'
	/Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/celluloid-0.15.2/lib/celluloid/pool_manager.rb:123:in `method_missing'
	/Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/celluloid-0.15.2/lib/celluloid/calls.rb:25:in `public_send'
	/Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/celluloid-0.15.2/lib/celluloid/calls.rb:25:in `dispatch'
	/Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/celluloid-0.15.2/lib/celluloid/calls.rb:122:in `dispatch'
	/Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/celluloid-0.15.2/lib/celluloid/actor.rb:322:in `block in handle_message'
	/Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/celluloid-0.15.2/lib/celluloid/actor.rb:416:in `block in task'
	/Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/celluloid-0.15.2/lib/celluloid/tasks.rb:55:in `block in initialize'
	/Users/peter/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/celluloid-0.15.2/lib/celluloid/tasks/task_fiber.rb:13:in `block in create'


Started GET "/subdir/payola/subscription_status/null" for 127.0.0.1 at 2014-11-25 16:54:53 -0500
Processing by Payola::SubscriptionsController#status as */*
  Parameters: {"guid"=>"null"}
  [1m[35mPayola::Affiliate Load (1.9ms)[0m  SELECT  "payola_affiliates".* FROM "payola_affiliates"  WHERE (lower(code) = lower('pa1'))  ORDER BY "payola_affiliates"."id" ASC LIMIT 1
  [1m[36mPayola::Subscription Load (0.2ms)[0m  [1mSELECT  "payola_subscriptions".* FROM "payola_subscriptions"  WHERE "payola_subscriptions"."guid" = 'null' LIMIT 1[0m
  Rendered text template (0.0ms)
Completed 404 Not Found in 6ms (Views: 0.5ms | ActiveRecord: 2.5ms)
Terminating 3 actors...
Terminating task: type=:finalizer, meta={:method_name=>:__shutdown__}, status=:callwait


Started GET "/subscribe" for 127.0.0.1 at 2014-11-25 16:55:52 -0500
  [1m[36mActiveRecord::SchemaMigration Load (0.5ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Processing by SubscribeController#index as HTML
  [1m[35mSubscriptionPlan Load (0.1ms)[0m  SELECT  "subscription_plans".* FROM "subscription_plans"   ORDER BY "subscription_plans"."id" ASC LIMIT 1
  Rendered subscribe/index.html.erb within layouts/application (11.9ms)
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_stripe_header.html.erb (0.4ms)
Completed 200 OK in 116ms (Views: 101.2ms | ActiveRecord: 0.4ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-11-25 16:55:52 -0500


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-11-25 16:55:52 -0500


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-11-25 16:55:52 -0500


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-11-25 16:55:52 -0500


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-11-25 16:55:52 -0500


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-11-25 16:55:52 -0500


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-11-25 16:55:53 -0500


Started POST "/subscribe" for 127.0.0.1 at 2014-11-25 16:56:11 -0500
Processing by SubscribeController#create as */*
  Parameters: {"utf8"=>"✓", "authenticity_token"=>"rBkAQhkOB4WJz7LpfiSQGAv0EGg0QyEIqt/gfXaSXuw=", "stripeEmail"=>"pete@bugsplat.info", "coupon"=>"", "stripeToken"=>"tok_152rI7BYGTZJSjsOcHu8cpuY"}
  [1m[36mSubscriptionPlan Load (0.2ms)[0m  [1mSELECT  "subscription_plans".* FROM "subscription_plans"   ORDER BY "subscription_plans"."id" ASC LIMIT 1[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPayola::Subscription Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "payola_subscriptions"  WHERE "payola_subscriptions"."guid" IS NULL LIMIT 1[0m
  [1m[35mCACHE (0.0ms)[0m  SELECT  1 AS one FROM "payola_subscriptions"  WHERE "payola_subscriptions"."guid" IS NULL LIMIT 1
  [1m[36mPayola::Subscription Exists (0.1ms)[0m  [1mSELECT  1 AS one FROM "payola_subscriptions"  WHERE "payola_subscriptions"."guid" = 's7q3oq' LIMIT 1[0m
  [1m[35mSQL (0.8ms)[0m  INSERT INTO "payola_subscriptions" ("amount", "coupon", "created_at", "currency", "email", "guid", "plan_id", "plan_type", "state", "stripe_token", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)  [["amount", 100], ["coupon", ""], ["created_at", "2014-11-25 21:56:11.490771"], ["currency", "usd"], ["email", "pete@bugsplat.info"], ["guid", "s7q3oq"], ["plan_id", 1], ["plan_type", "SubscriptionPlan"], ["state", "pending"], ["stripe_token", "tok_152rI7BYGTZJSjsOcHu8cpuY"], ["updated_at", "2014-11-25 21:56:11.490771"]]
  [1m[36m (1.1ms)[0m  [1mcommit transaction[0m
  [1m[35mPayola::Subscription Load (0.2ms)[0m  SELECT  "payola_subscriptions".* FROM "payola_subscriptions"  WHERE "payola_subscriptions"."guid" = 's7q3oq' LIMIT 1
  [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
  [1m[35mSQL (0.5ms)[0m  UPDATE "payola_subscriptions" SET "state" = 'processing' WHERE "payola_subscriptions"."id" = 1
  [1m[36mPayola::Subscription Exists (0.2ms)[0m  [1mSELECT  1 AS one FROM "payola_subscriptions"  WHERE ("payola_subscriptions"."guid" = 's7q3oq' AND "payola_subscriptions"."id" != 1) LIMIT 1[0m
Completed 200 OK in 156ms (Views: 0.2ms | ActiveRecord: 2.9ms)
  [1m[35mSQL (0.1ms)[0m  UPDATE "payola_subscriptions" SET "state" = ?, "updated_at" = ? WHERE "payola_subscriptions"."id" = 1  [["state", "processing"], ["updated_at", "2014-11-25 21:56:11.560712"]]
  [1m[36mSubscriptionPlan Load (0.2ms)[0m  [1mSELECT  "subscription_plans".* FROM "subscription_plans"  WHERE "subscription_plans"."id" = ? LIMIT 1[0m  [["id", 1]]


Started GET "/subdir/payola/subscription_status/s7q3oq" for 127.0.0.1 at 2014-11-25 16:56:11 -0500
Processing by Payola::SubscriptionsController#status as */*
  Parameters: {"guid"=>"s7q3oq"}
  [1m[35mPayola::Affiliate Load (0.4ms)[0m  SELECT  "payola_affiliates".* FROM "payola_affiliates"  WHERE (lower(code) = lower('pa1'))  ORDER BY "payola_affiliates"."id" ASC LIMIT 1
  [1m[36mPayola::Subscription Load (0.2ms)[0m  [1mSELECT  "payola_subscriptions".* FROM "payola_subscriptions"  WHERE "payola_subscriptions"."guid" = 's7q3oq' LIMIT 1[0m
Completed 200 OK in 6ms (Views: 0.3ms | ActiveRecord: 0.9ms)


Started GET "/subdir/payola/subscription_status/s7q3oq" for 127.0.0.1 at 2014-11-25 16:56:12 -0500
Processing by Payola::SubscriptionsController#status as */*
  Parameters: {"guid"=>"s7q3oq"}
  [1m[35mPayola::Affiliate Load (0.2ms)[0m  SELECT  "payola_affiliates".* FROM "payola_affiliates"  WHERE (lower(code) = lower('pa1'))  ORDER BY "payola_affiliates"."id" ASC LIMIT 1
  [1m[36mPayola::Subscription Load (0.2ms)[0m  [1mSELECT  "payola_subscriptions".* FROM "payola_subscriptions"  WHERE "payola_subscriptions"."guid" = 's7q3oq' LIMIT 1[0m
Completed 200 OK in 2ms (Views: 0.2ms | ActiveRecord: 0.3ms)


Started GET "/subdir/payola/subscription_status/s7q3oq" for 127.0.0.1 at 2014-11-25 16:56:12 -0500
Processing by Payola::SubscriptionsController#status as */*
  Parameters: {"guid"=>"s7q3oq"}
  [1m[35mPayola::Affiliate Load (0.2ms)[0m  SELECT  "payola_affiliates".* FROM "payola_affiliates"  WHERE (lower(code) = lower('pa1'))  ORDER BY "payola_affiliates"."id" ASC LIMIT 1
  [1m[36mPayola::Subscription Load (0.5ms)[0m  [1mSELECT  "payola_subscriptions".* FROM "payola_subscriptions"  WHERE "payola_subscriptions"."guid" = 's7q3oq' LIMIT 1[0m
Completed 200 OK in 4ms (Views: 0.3ms | ActiveRecord: 0.7ms)


Started GET "/subdir/payola/subscription_status/s7q3oq" for 127.0.0.1 at 2014-11-25 16:56:13 -0500
Processing by Payola::SubscriptionsController#status as */*
  Parameters: {"guid"=>"s7q3oq"}
  [1m[35mPayola::Affiliate Load (0.3ms)[0m  SELECT  "payola_affiliates".* FROM "payola_affiliates"  WHERE (lower(code) = lower('pa1'))  ORDER BY "payola_affiliates"."id" ASC LIMIT 1
  [1m[36mPayola::Subscription Load (0.3ms)[0m  [1mSELECT  "payola_subscriptions".* FROM "payola_subscriptions"  WHERE "payola_subscriptions"."guid" = 's7q3oq' LIMIT 1[0m
Completed 200 OK in 3ms (Views: 0.3ms | ActiveRecord: 0.6ms)
  [1m[35mPayola::Subscription Exists (0.1ms)[0m  SELECT  1 AS one FROM "payola_subscriptions"  WHERE ("payola_subscriptions"."guid" = 's7q3oq' AND "payola_subscriptions"."id" != 1) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "payola_subscriptions" SET "card_expiration" = ?, "card_last4" = ?, "card_type" = ?, "stripe_customer_id" = ?, "stripe_id" = ?, "updated_at" = ? WHERE "payola_subscriptions"."id" = 1[0m  [["card_expiration", "2034-12-01"], ["card_last4", "4242"], ["card_type", "Visa"], ["stripe_customer_id", "cus_5DHruJR5SzmXz2"], ["stripe_id", "sub_5DHrwQkimHHrJ6"], ["updated_at", "2014-11-25 21:56:13.255229"]]
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.9ms)[0m  [1mUPDATE "payola_subscriptions" SET "state" = 'active' WHERE "payola_subscriptions"."id" = 1[0m
  [1m[35m (0.2ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (1.7ms)[0m  [1mcommit transaction[0m


Started GET "/subdir/payola/subscription_status/s7q3oq" for 127.0.0.1 at 2014-11-25 16:56:13 -0500
Processing by Payola::SubscriptionsController#status as */*
  Parameters: {"guid"=>"s7q3oq"}
  [1m[35mPayola::Affiliate Load (0.2ms)[0m  SELECT  "payola_affiliates".* FROM "payola_affiliates"  WHERE (lower(code) = lower('pa1'))  ORDER BY "payola_affiliates"."id" ASC LIMIT 1
  [1m[36mPayola::Subscription Load (0.2ms)[0m  [1mSELECT  "payola_subscriptions".* FROM "payola_subscriptions"  WHERE "payola_subscriptions"."guid" = 's7q3oq' LIMIT 1[0m
Completed 200 OK in 2ms (Views: 0.2ms | ActiveRecord: 0.4ms)


Started GET "/subdir/payola/confirm_subscription/s7q3oq" for 127.0.0.1 at 2014-11-25 16:56:13 -0500
Processing by Payola::SubscriptionsController#show as HTML
  Parameters: {"guid"=>"s7q3oq"}
  [1m[35mPayola::Affiliate Load (0.2ms)[0m  SELECT  "payola_affiliates".* FROM "payola_affiliates"  WHERE (lower(code) = lower('pa1'))  ORDER BY "payola_affiliates"."id" ASC LIMIT 1
  [1m[36mPayola::Subscription Load (0.4ms)[0m  [1mSELECT  "payola_subscriptions".* FROM "payola_subscriptions"  WHERE "payola_subscriptions"."guid" = 's7q3oq' LIMIT 1[0m
  [1m[35mSubscriptionPlan Load (0.2ms)[0m  SELECT  "subscription_plans".* FROM "subscription_plans"  WHERE "subscription_plans"."id" = ? LIMIT 1  [["id", 1]]
Redirected to http://localhost:3000/
Completed 302 Found in 28ms (ActiveRecord: 0.9ms)


Started GET "/" for 127.0.0.1 at 2014-11-25 16:56:13 -0500
Processing by HomeController#index as HTML
  Rendered home/index.html.erb within layouts/application (0.6ms)
  Rendered /Users/peter/devel/payola/app/views/payola/transactions/_stripe_header.html.erb (0.1ms)
Completed 200 OK in 51ms (Views: 50.7ms | ActiveRecord: 0.0ms)


Started GET "/assets/buy.css?body=1" for 127.0.0.1 at 2014-11-25 16:56:13 -0500


Started GET "/assets/application.css?body=1" for 127.0.0.1 at 2014-11-25 16:56:13 -0500


Started GET "/assets/payola/application.js?body=1" for 127.0.0.1 at 2014-11-25 16:56:14 -0500


Started GET "/assets/payola/form.js?body=1" for 127.0.0.1 at 2014-11-25 16:56:14 -0500


Started GET "/assets/buy.js?body=1" for 127.0.0.1 at 2014-11-25 16:56:14 -0500


Started GET "/assets/payola.js?body=1" for 127.0.0.1 at 2014-11-25 16:56:14 -0500


Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2014-11-25 16:56:14 -0500
Terminating 3 actors...
Terminating task: type=:finalizer, meta={:method_name=>:__shutdown__}, status=:callwait
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Migrating to AddSetupFeeToPayolaSubscriptions (20141122020755)
  [1m[35m (0.2ms)[0m  begin transaction
  [1m[36m (0.5ms)[0m  [1mALTER TABLE "payola_subscriptions" ADD "setup_fee" integer[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "schema_migrations" ("version") VALUES (?)  [["version", "20141122020755"]]
  [1m[36m (1.1ms)[0m  [1mcommit transaction[0m
Migrating to CreateUsers (20141204170622)
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.3ms)[0m  [1mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "created_at" datetime, "updated_at" datetime) [0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO "schema_migrations" ("version") VALUES (?)  [["version", "20141204170622"]]
  [1m[36m (0.8ms)[0m  [1mcommit transaction[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.1ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_owner_id_and_owner_type' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_owner_id_and_owner_type' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_stripe_customer_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_stripe_customer_id' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_product' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_product' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_guid' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_guid' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_email' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_subscriptions_on_guid' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_subscriptions_on_guid' AND type='index'
[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.1ms)[0m  [1mSELECT "schema_migrations".* FROM "schema_migrations"[0m
Migrating to AddActiveToPayolaCoupon (20141213205847)
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (1.0ms)[0m  [1mALTER TABLE "payola_coupons" ADD "active" boolean DEFAULT 't'[0m
  [1m[35mSQL (0.2ms)[0m  INSERT INTO "schema_migrations" ("version") VALUES (?)  [["version", "20141213205847"]]
  [1m[36m (1.4ms)[0m  [1mcommit transaction[0m
  [1m[35mActiveRecord::SchemaMigration Load (0.1ms)[0m  SELECT "schema_migrations".* FROM "schema_migrations"
  [1m[36m (0.2ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_owner_id_and_owner_type' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_owner_id_and_owner_type' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_stripe_customer_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_stripe_customer_id' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_product' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_product' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_guid' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_guid' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_email' AND type='index'
[0m
  [1m[35m (0.1ms)[0m              SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_sales_on_coupon_id' AND type='index'

  [1m[36m (0.1ms)[0m  [1m            SELECT sql
            FROM sqlite_master
            WHERE name='index_payola_subscriptions_on_guid' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_payola_subscriptions_on_guid' AND type='index'
[0m
